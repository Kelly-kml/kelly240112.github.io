<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/kelly240112.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/kelly240112.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/kelly240112.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/kelly240112.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/kelly240112.github.io/css/main.css">


<link rel="stylesheet" href="/kelly240112.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kelly-kml.github.io","root":"/kelly240112.github.io/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="野孩子玩耍的殿堂">
<meta property="og:type" content="website">
<meta property="og:title" content="宫崎骏的捣蛋野孩子">
<meta property="og:url" content="https://kelly-kml.github.io/kelly240112.github.io/index.html">
<meta property="og:site_name" content="宫崎骏的捣蛋野孩子">
<meta property="og:description" content="野孩子玩耍的殿堂">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="kelly">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://kelly-kml.github.io/kelly240112.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>宫崎骏的捣蛋野孩子</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/kelly240112.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">宫崎骏的捣蛋野孩子</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/kelly240112.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/kelly240112.github.io/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/kelly240112.github.io/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">14</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/kelly240112.github.io/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">5</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/kelly240112.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">14</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://kelly-kml.github.io/kelly240112.github.io/" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/06/10/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/06/10/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" class="post-title-link" itemprop="url">动态规划</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-06-10 22:46:35 / 修改时间：23:34:26" itemprop="dateCreated datePublished" datetime="2024-06-10T22:46:35+08:00">2024-06-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="杨辉三角"><a href="#杨辉三角" class="headerlink" title="杨辉三角"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/pascals-triangle/">杨辉三角</a></h1><p>在「杨辉三角」中，每个数是它左上方和右上方的数的和。</p>
<p><img src="https://pic.leetcode-cn.com/1626927345-DZmfxB-PascalTriangleAnimated2.gif"></p>
<p>根据杨辉三角的性质，可以得到动态规划方式为：<code>dp[i][j] = dp[i - 1][j - 1] + dp[i - 1][j]</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">numRows</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number[][]</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> generate = <span class="keyword">function</span> (<span class="params">numRows</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dp = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numRows; i++) &#123;</span><br><span class="line">    dp[i] = <span class="keyword">new</span> <span class="title class_">Array</span>(i + <span class="number">1</span>).<span class="title function_">fill</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j &lt; i; j++) &#123;</span><br><span class="line">      dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + dp[i - <span class="number">1</span>][j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>时间复杂度：O(numRows2)</p>
</li>
<li><p>空间复杂度：O(1)，不考虑返回值的空间占用</p>
</li>
</ul>
<h1 id="爬楼梯"><a href="#爬楼梯" class="headerlink" title="爬楼梯"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/climbing-stairs/">爬楼梯</a></h1><blockquote>
<p>到 0 层：0 种方案<br>到 1 层：1<br>到 2 层：2<br>到 3 层：3<br>到 4 层：5<br>到 5 层：8<br>…..<br>这样子不断递推，就是刚好符合斐波那契数的规律 f(n)&#x3D;f(n-1)+f(n-2),可以使用动态规划的算法</p>
</blockquote>
<p>本问题其实常规解法可以分成多个子问题，爬第 n 阶楼梯的方法数量，等于 2 部分之和：</p>
<ul>
<li><p>爬上 n−1n-1n−1 阶楼梯的方法数量。因为再爬 1 阶就能到第 n 阶</p>
</li>
<li><p>爬上 n−2n-2n−2 阶楼梯的方法数量，因为再爬 2 阶就能到第 n 阶</p>
</li>
</ul>
<p>所以我们得到公式： <code>dp[n]=dp[n−1]+dp[n−2]</code></p>
<p>同时需要初始化 <code>dp[0]=1</code> 和 <code>dp[1]=1</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">n</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> climbStairs = <span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dp = [];</span><br><span class="line">  dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)</li>
<li>空间复杂度：O(n)</li>
</ul>
<h1 id="打家劫舍"><a href="#打家劫舍" class="headerlink" title="打家劫舍"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/house-robber/">打家劫舍</a></h1><p>如果只有一间房屋，则偷窃该房屋，可以偷窃到最高总金额。如果只有两间房屋，则由于两间房屋相邻，不能同时偷窃，只能偷窃其中的一间房屋，因此选择其中金额较高的房屋进行偷窃，可以偷窃到最高总金额。</p>
<p>如果房屋数量大于两间，应该如何计算能够偷窃到的最高总金额呢？对于第 k (k&gt;2) 间房屋，有两个选项：</p>
<p>偷窃第 k 间房屋，那么就不能偷窃第 k−1 间房屋，偷窃总金额为前 k−2 间房屋的最高总金额与第 k 间房屋的金额之和。</p>
<p>不偷窃第 k 间房屋，偷窃总金额为前 k−1 间房屋的最高总金额。</p>
<p>在两个选项中选择偷窃总金额较大的选项，该选项对应的偷窃总金额即为前 kkk 间房屋能偷窃到的最高总金额。</p>
<p>用 dp[i] 表示前 i 间房间能偷窃到的最高金额，那么转移方程为：</p>
<p><code>dp[i]=max(dp[i−2]+nums[i],dp[i−1])</code></p>
<p>初始状态为：</p>
<ul>
<li><p>只有一间房屋，则偷窃该房屋 &#x3D;&gt; dp[0]&#x3D;nums[0]</p>
</li>
<li><p>只有两间房屋，选择其中金额较高的房屋进行偷窃 &#x3D;&gt; dp[1]&#x3D;max(nums[0],nums[1])</p>
</li>
</ul>
<p>最终的答案即为 dp[n−1]，其中 n 是数组的长度。</p>
<p>接下来就是遵循我们的动态规划五部曲解题啦:</p>
<ol>
<li>确定 dp 数组及下标含义：考虑下标 i(包括 i)以内的房屋，最多可以偷窃的金额为 dp[i]。</li>
<li>确定递推公式: dp[i] &#x3D; Math.max(dp[i - 1], dp[i - 2] + nums[i]);</li>
<li>dp 数组如何初始化:dp[0] &#x3D; nums[0]; dp[1] &#x3D; Math.max(nums[0], nums[1]);</li>
<li>确定遍历顺序:从前往后</li>
<li>举例推导</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number[]</span>&#125; <span class="variable">nums</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> rob = <span class="keyword">function</span> (<span class="params">nums</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (nums.<span class="property">length</span> === <span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">const</span> dp = <span class="keyword">new</span> <span class="title class_">Array</span>(nums.<span class="property">length</span>);</span><br><span class="line">  dp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">  dp[<span class="number">1</span>] = <span class="title class_">Math</span>.<span class="title function_">max</span>(nums[<span class="number">0</span>], nums[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    dp[i] = <span class="title class_">Math</span>.<span class="title function_">max</span>(dp[i - <span class="number">1</span>], dp[i - <span class="number">2</span>] + nums[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dp[nums.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)，其中 n 是数组长度。只需要对数组遍历一次</li>
<li>空间复杂度：O(1)，使用滚动数组，可以只存储前两间房屋的最高总金额，而不需要存储整个数组的结果，因此空间复杂度是 O(1)</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/04/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/04/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">浏览器机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-03 15:46:44 / 修改时间：16:50:03" itemprop="dateCreated datePublished" datetime="2024-04-03T15:46:44+08:00">2024-04-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/HTTP/" itemprop="url" rel="index"><span itemprop="name">HTTP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>说到浏览器渲染机制，不外乎两个关键方面需要知道：</p>
<ul>
<li>浏览器如何渲染页面</li>
<li>有哪些提高浏览器渲染性能的方法</li>
</ul>
<h2 id="回答关键词："><a href="#回答关键词：" class="headerlink" title="回答关键词："></a>回答关键词：</h2><p><code>DOM</code> <code>CSSOM</code> <code>脚本执行与界面渲染互斥</code> <code>渲染树</code> <code>Compositing</code> <code>GPU 加速</code></p>
<p>当浏览器进程获取到 HTML 的第一个字节开始，会通知渲染进程开始解析 HTML，将 HTML 转换成 DOM 树，并进入渲染流程。一般所有的浏览器都会经过五大步骤，分别是：</p>
<ol>
<li>PARSE：解析 HTML，构建 DOM 树。</li>
<li>STYLE：为每个节点计算最终的有效样式。</li>
<li>LAYOUT：为每个节点计算位置和大小等布局信息。</li>
<li>PAINT：绘制不同的盒子，为了避免不必要的重绘，将会分成多个层进行处理。</li>
<li>COMPOSITE &amp; RENDER：将上述不同的层合成为一张位图，发送给 GPU，渲染到屏幕上。</li>
</ol>
<p>为了提高浏览器的渲染性能，通常的手段是保证渲染流程不被阻塞，避免不必要的绘制计算和重排重绘，利用 GPU 硬件加速等技术来提高渲染性能。</p>
<h2 id="知识点深入"><a href="#知识点深入" class="headerlink" title="知识点深入"></a>知识点深入</h2><h3 id="浏览器的渲染流程"><a href="#浏览器的渲染流程" class="headerlink" title="浏览器的渲染流程"></a>浏览器的渲染流程</h3><p>Chromium 的渲染流程的主要步骤如下图所示：</p>
<p><img src="https://s2.loli.net/2024/04/03/N6ldeCqJF8MgYHf.png" alt="f65bdaafcc1760fc534b48d4d7c872b.png"></p>
<h4 id="Parse-阶段：解析-HTML"><a href="#Parse-阶段：解析-HTML" class="headerlink" title="Parse 阶段：解析 HTML"></a>Parse 阶段：解析 HTML</h4><p><strong>构建 DOM 树</strong></p>
<p>渲染进程主线程解析 HTML 并构建出结构化的树状数据结构 DOM 树，需要经历以下几个步骤：</p>
<ol>
<li>Conversion（转换）：浏览器从网络或磁盘读取 HTML 文件原始字节，根据指定的文件编码（如 UTF-8）将字节转换成字符。</li>
<li>Tokenizing（分词）：浏览器根据 HTML 规范将字符串转换为不同的标记（如 <html>, <body>）。</li>
<li>Lexing（语法分析）：上一步产生的标记将被转换为对象，这些对象包含了 HTML 语法的各种信息，如属性、属性值、文本等。</li>
<li>DOM construction（DOM 构造）：因为 HTML 标记定义了不同标签之间的关系，上一步产生的对象会链接在一个树状数据结构中，以标识父子、兄弟关系。</li>
</ol>
<p>构建 DOM 的流程如下图所示:</p>
<p><img src="https://s2.loli.net/2024/04/03/jfcAwWeUFSMB1L3.png" alt="e1cc81136cf4ef6b19827d1105f4f30.png"></p>
<p><strong>次级资源加载</strong></p>
<p>一个网页通常会使用多个外部资源，如图片、JavaScript、CSS、字体等。主线程在解析 DOM 的过程中遇到这些资源后会一一请求。为了加速渲染流程，会有一个叫做预加载扫描器（preload scanner）线程并发运行。如果 HTML 中存在 img 或 link 之类的内容，则预加载扫描器会查看 HTML parser 生成的标记，并发送请求到浏览器进程的网络线程获取这些资源。</p>
<p><strong>JavaScript 可能阻塞解析</strong></p>
<p>当 HTML 解析器发现 script 标签时，会暂停 HTML 的解析，转而开始加载、解析和执行 JavaScript。因为 JS 可能会改变 DOM 的结构。如果不想因 JS 阻塞 HTML 的解析，可以为 script 标签添加 defer 属性或将 script 放在 body 结束标签之前，浏览器会在最后执行 JS 代码，避免阻塞 DOM 构建。</p>
<h4 id="Style-阶段：样式计算"><a href="#Style-阶段：样式计算" class="headerlink" title="Style 阶段：样式计算"></a>Style 阶段：样式计算</h4><p>CSS 引擎处理样式的过程分为三个阶段：</p>
<ol>
<li>收集、划分和索引所有样式表中存在的样式规则，CSS 引擎会从 style 标签，css 文件及浏览器代理样式中收集所有的样式规则，并为这些规则建立索引，以方便后续的高效查询。</li>
<li>访问每个元素并找到适用于该元素的所有规则，CSS 引擎遍历 DOM 节点，进行选择器匹配，并为匹配的节点执行样式设置。</li>
<li>结合层叠规则和其他信息为节点生成最终的计算样式，这些样式的值可以通过 window.getComputedStyle() 获取。</li>
</ol>
<p>在大型网站中，会存在大量的 CSS 规则，如果为每个节点都保存一份样式值，会导致内存消耗过大。作为替代，CSS 引擎通常会创建共享的样式结构，计算样式对象一般有指针指向相同的共享结构。</p>
<p>附加了计算样式的 DOM 树，一般被称为 CSSOM（CSS Object Model）：</p>
<p><img src="https://s2.loli.net/2024/04/03/8hVH2oFKJbOqfyt.png" alt="72562309c3225c1f0c0362b7f915421.png"></p>
<p>CSSOM 和 DOM 是并行构建的，构建 CSSOM 不会阻塞 DOM 的构建。但 CSSOM 会阻塞 JS 的执行，因为 JS 可能会操作样式信息。虽然 CSSOM 不会阻塞 DOM 的构建，但在进入下一阶段之前，必须等待 CSSOM 构建完成。这也是通常所说的 CSSOM 会阻塞渲染。</p>
<h4 id="Layout-阶段"><a href="#Layout-阶段" class="headerlink" title="Layout 阶段"></a>Layout 阶段</h4><p><strong>创建 LayoutObject（RenderObject） 树</strong></p>
<p>有了 DOM 树和 DOM 树中元素的计算样式后，浏览器会根据这些信息合并成一个 layout 树，收集所有可见的 DOM 节点，以及每个节点的所有样式信息。</p>
<p>Layout 树和 DOM 树不一定是一一对应的，为了构建 Layout 树，浏览器主要完成了下列工作：</p>
<ol>
<li>从 DOM 树的根节点开始遍历每个可见节点。</li>
</ol>
<ul>
<li>某些不可见节点（例如 script、head、meta 等），它们不会体现在渲染输出中，会被忽略。</li>
<li>某些通过设置 display 为 none 隐藏的节点，在渲染树中也会被忽略。</li>
<li>为伪元素创建 LayoutObject。</li>
<li>为行内元素创建匿名包含块对应的 LayoutObject。</li>
</ul>
<ol start="2">
<li>对于每个可见节点，为其找到适配的 CSSOM 规则并应用它们。</li>
<li>产出可见节点，包含其内容和计算的样式。</li>
</ol>
<p><img src="https://s2.loli.net/2024/04/03/mKC2SsT6LUGxBAq.png" alt="6509bb3ab1f53317bf5c5d92db7720d.png"></p>
<p><strong>布局计算</strong></p>
<p>上一步计算了可见的节点及其样式，接下来需要计算它们在设备视口内的确切位置和大小，这个过程一般被称为自动重排。</p>
<p>浏览器的布局计算工作包含以下内容：</p>
<p>根据 CSS 盒模型及视觉格式化模型，计算每个元素的各种生成盒的大小和位置。</p>
<ol>
<li>计算块级元素、行内元素、浮动元素、各种定位元素的大小和位置。</li>
<li>计算文字，滚动区域的大小和位置。</li>
<li>LayoutObject 有两种类型：</li>
</ol>
<ul>
<li>传统的 LayoutObject 节点，会把布局运算的结果重新写回布局树中。</li>
<li>LayoutNG（Chrome 76 开始启用） 节点的输出是不可变的，会保存在 NGLayoutResult 中，这是一个树状的结构，相比之前的 LayoutObject，少了很大回溯计算，提高了性能。</li>
</ul>
<h4 id="Paint-阶段"><a href="#Paint-阶段" class="headerlink" title="Paint 阶段"></a>Paint 阶段</h4><p>Paint 阶段将 LayoutObject 树转换成供合成器使用的高效渲染格式，包括一个包含 display item 列表的 cc::Layers 列表，与该列表与 cc::PropertyTrees 关联。</p>
<p><strong>构建 PaintLayer（RenderLayer） 树</strong></p>
<p>构建完成的 LayoutObject 树还不能拿去显示，因为它不包含绘制的顺序（z-index）。同时，也为了考虑一些复杂的情况，如 3D 变换、页面滚动等，浏览器会对上一步的节点进行分层处理。这个处理过程被称为建立层叠上下文。</p>
<p>浏览器会根据 CSS 层叠上下文规范，建立层叠上下文，常见情况如下：</p>
<ol>
<li>DOM 树的 Document 节点对应的 RenderView 节点。</li>
<li>DOM 树中 Document 节点的子节点，也就是 HTML 节点对应的 RenderBlock 节点。</li>
<li>显式指定 CSS 位置的节点（position 为 absolute 或者 fixed）。</li>
<li>具有透明效果的节点。</li>
<li>具有 CSS 3D 属性的节点。</li>
<li>使用 Canvas 元素或者 Video 元素的节点。</li>
</ol>
<p>浏览器遍历 LayoutObject 树的时候，建立了 PaintLayer 树，LayoutObject 与 PaintLayer 也不一定是一一对应的。每个 LayoutObject 要么与自己的 PaintLayer 关联，要么与拥有 PaintLayer 的第一个祖先的 PaintLayer 关联。</p>
<p><strong>构建 cc::Layer 与 display items</strong></p>
<p>浏览器会继续根据 PaintLayer 树创建 cc::Layer 列表。cc::Layer 是列表状结构，每个 layer 包含了个 DisplayItem 列表，每个 DisplayItem 包含了实际的 paint op 指令。将页面分层，可以让一个图层独立于其他的图层进行变换和光栅化处理。</p>
<ol>
<li>合成更新（Compositing update）</li>
</ol>
<ul>
<li>依据 PaintLayer 决定分层（GraphicsLayers）</li>
<li>这个策略被称为 CompositeBeforePaint，未来会被 CompositeAfterPaint 替代。</li>
</ul>
<ol start="2">
<li>PrePaint</li>
</ol>
<ul>
<li>PaintInvalidator 进行失效检查，找出需要绘制的 display items。</li>
<li>构建 paint property 树，该树能使动画、页面滚动，clip 等变化仅在合成线程运行，提高性能。</li>
</ul>
<p><img src="https://s2.loli.net/2024/04/03/6osNFymSBMiRVPt.png" alt="6a637407b4bb2ef8f1cf3e958fca473.png"></p>
<ol start="3">
<li>Paint</li>
</ol>
<ul>
<li>遍历 LayoutObject 树并创建 display items 列表。</li>
<li>为共享同样 property tree 状态的 display items 列表创建 paint chunks 分组。</li>
<li>将结果 commit 到 compositor。</li>
<li>CompositeAfterPaint 将在此时决定分层。</li>
<li>将 paint chunks 通过 cc::Layer 列表传递给 compositor。</li>
<li>将 property 树转换为 cc::PropertyTrees。</li>
</ul>
<p>上面的流程中，有两个不同的创建合成层的时机，一个是 paint 之前的 CompositeBeforePaint，该操作在渲染主线程中完成。一个是 paint 之后的 CompositeAfterPaint，后续创建 layer 的操作在 CC（Chromium Compositor）线程中完成。</p>
<h4 id="合成-Compositing"><a href="#合成-Compositing" class="headerlink" title="合成 Compositing"></a>合成 Compositing</h4><p>合成阶段在 CC（Chromium Compositor）线程中进行。</p>
<p><strong>commit</strong></p>
<p>当 Paint 阶段完成后，主线程进入 commit 阶段，将 cc::Layer 中的 layer list 和 property 树更新到 CC 线程的 LayerImpl 中，commit 完成。commit 进行的过程中，主线程被阻塞。</p>
<p><strong>tiling &amp; raster</strong></p>
<p>raster（光栅化）是将 display item 中的绘制操作转换为位图的过程。</p>
<p>光栅化的主要操作流程如下：</p>
<ol>
<li>tiling：将 layer 分成 tiles（图块）。 因为有的 layer 可能很大（如整个文档的滚动根节点），对整层的光栅化操作代价昂贵，且 layer 中有的部分是不可见的，会造成不必要的浪费。</li>
<li>tiles 是光栅化的基本单元。光栅化操作是通过光栅线程池处理的。离视口更近的 tiles 具有更高的优先级，将优先处理。</li>
<li>一个 layer 实际上会生成多种分辨率的 tiles。</li>
<li>raster 同样也会处理页面引用的图片资源，display items 中的 paint ops 引用了这些压缩数据，raster 会调用合适的解码器来解压这些数据。</li>
<li>raster 会通过 Skia 来进行 OpenGL 调用，光栅化数据。</li>
<li>渲染进程是运行在沙箱中的，不能直接进行系统调用。paint ops 通过 IPC（MOJO）传递给 GPU 进程，GPU 进程会执行真实的 OpenGL（为了保证性能，在 Windows 上转为 DirectX）调用。</li>
<li>光栅化的位图结果保存在 GPU 内存中，通常作为 OpenGL 材质对象保存。</li>
<li>双缓冲机制：主线程随时会有 commit 到来，当前的光栅化行为在 pending tree（LayerImpl）上进行，一旦光栅化操作完成，将 pending tree 变为 active tree，后续的 draw 操作在 active tree 上进行。</li>
</ol>
<p><strong>draw</strong></p>
<p>当所有的 tiles 都完成光栅化后，会生成 draw quads（绘制四边形）。每个 draw quads 是包含一个在屏幕特定位置绘制 tile 的命令，该命令同时考虑了所有应用到 layer tree 的变换。每个四边形引用了内存中 tile 的光栅化输出。四边形被包裹在合成帧对象（compositor frame object）中，然后提交（submit）到浏览器进程。</p>
<p><strong>display compositor（viz，visual 的简称）</strong></p>
<p>viz 位于 GPU 进程中，viz 接收来自浏览器的合成帧，合成帧来自多个渲染进程，以及浏览器自身 UI 的 compositor。</p>
<p>合成帧和屏幕上将要绘制的位置关联，该位置叫做 surface。surface 可以嵌套其他 surface，浏览器 UI 的 surface 嵌套了渲染进程的 surface，渲染进程的 surface 嵌套了其他跨域 iframes（同源的 iframe 共享相同的渲染进程） 的 surface。viz 同步传入的帧，并处理嵌套 surfaces 的依赖（surface aggregation）。</p>
<p>最终的显示流程：</p>
<ol>
<li>viz 会发出 OpenGL 调用将合成帧中的 quads 发送到 GPU 线程的 backbuffer 中。</li>
<li>在新的模式中，viz 会使用 Skia 代替原始 OpenGL 调用。</li>
<li>在大部分平台上，viz 的输出也是双缓冲结构，draw 首先到达 backbuffer，通过 swapping 操作转换成 frontbuffer 最终显示在屏幕上。</li>
</ol>
<p><strong>线程对浏览器事件的处理</strong></p>
<p>合成的优点是它在不涉及渲染主线程的情况下完成的。合成器不需要等待样式计算或 JavaScript 执行。只和合成相关的动画被认为是获得流畅性能的最佳选择。同时，合成器还负责处理页面的滚动，滚动的时候，合成器会更新页面的位置，并且更新页面的内容。</p>
<p>当一个没有绑定任何事件的页面发生滚动时，合成器可以独立于渲染主线程之外进行合成帧的的创建，保证页面的流程滚动。当页面中的某一区域绑定了 JS 事件处理程序时，CC 线程会将这一区域标记为 Non-Fast Scrollable Region。如果事件来自于该区域之外，则 CC 线程继续合成新的帧，而无需等待主线程。</p>
<p>在开发中，我们通常会使用事件委托来简化逻辑，但是这会使整个绑定事件的区域变成 Non-Fast Scrollable Region。为了减轻这种情况对滚动造成的影响，你可以传入 passive: true 选项到事件监听器中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&#x27;touchstart&#x27;</span>,</span><br><span class="line">  <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">target</span> === area) &#123;</span><br><span class="line">      event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><strong>浏览器渲染大致过程如图所示：</strong></p>
<p><img src="https://s2.loli.net/2024/04/03/JRLX7AdrfD6IoNt.png" alt=".jpg"></p>
<p><strong>主要有以下步骤:</strong></p>
<ol>
<li><p>首先解析收到的文档，根据文档定义构建一棵 DOM 树，DOM 树是由 DOM 元素及属性节点组成的。</p>
</li>
<li><p>然后对 CSS 进行解析，生成 CSSOM 规则树。</p>
</li>
<li><p>根据 DOM 树和 CSSOM 规则树构建渲染树。渲染树的节点被称为渲染对象，渲染对象是一个包含有颜色和大小等属性的矩形，渲染对象和 DOM 元素相对应，但这种对应关系不是一对一的，不可见的 DOM 元素不会被插入渲染树。还有一些 DOM 元素对应几个可见对象，它们一般是一些具有复杂结构的元素，无法用一个矩形来描述。</p>
</li>
<li><p>当渲染对象被创建并添加到树中，它们并没有位置和大小，所以当浏览器生成渲染树以后，就会根据渲染树来进行布局（也可以叫做回流）。这一阶段浏览器要做的事情是要弄清楚各个节点在页面中的确切位置和大小。通常这一行为也被称为“自动重排”。</p>
</li>
<li><p>布局阶段结束后是绘制阶段，遍历渲染树并调用渲染对象的 paint 方法将它们的内容显示在屏幕上，绘制使用 UI 基础组件。</p>
</li>
</ol>
<p>注意：这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，并不会等到所有的 html 都解析完成之后再去构建和布局 render 树。它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/03/20/%E4%BA%8C%E5%8F%89%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/03/20/%E4%BA%8C%E5%8F%89%E6%A0%91/" class="post-title-link" itemprop="url">二叉树</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-03-20 14:34:40" itemprop="dateCreated datePublished" datetime="2024-03-20T14:34:40+08:00">2024-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-03-26 14:45:11" itemprop="dateModified" datetime="2024-03-26T14:45:11+08:00">2024-03-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="二叉树深度"><a href="#二叉树深度" class="headerlink" title="二叉树深度"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-depth-of-binary-tree/description">二叉树深度</a></h1><p><strong>最大深度</strong>是指从根节点到最远叶子节点的最长路径上的节点数。</p>
<p>基本两种思路：<code>深度优先遍历</code> 和 <code>广度优先遍历</code></p>
<ul>
<li>常见的 DFS：先序遍历、中序遍历、后序遍历</li>
<li>常见的 BFS：层序遍历</li>
</ul>
<h2 id="法一：深度优先遍历"><a href="#法一：深度优先遍历" class="headerlink" title="法一：深度优先遍历"></a>法一：深度优先遍历</h2><p><strong>基本思路：</strong></p>
<ol>
<li>先判空，root 为空，返回深度 0；</li>
<li>递归工作：本质上是后序遍历。</li>
</ol>
<ul>
<li>计算 root 的左子树节点，即递归调用 maxDepth(root.left)</li>
<li>计算 root 的右子树节点，即递归调用 maxDepth(root.right)</li>
</ul>
<ol start="3">
<li>返回此树的深度，即 <code>max(maxDepth(root.left), maxDepth(root.right)) + 1</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * function TreeNode(val, left, right) &#123;</span></span><br><span class="line"><span class="comment"> *     this.val = (val===undefined ? 0 : val)</span></span><br><span class="line"><span class="comment"> *     this.left = (left===undefined ? null : left)</span></span><br><span class="line"><span class="comment"> *     this.right = (right===undefined ? null : right)</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">TreeNode</span>&#125; <span class="variable">root</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> maxDepth = <span class="keyword">function</span> (<span class="params">root</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (root === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> leftHeight = <span class="title function_">maxDepth</span>(root.<span class="property">left</span>);</span><br><span class="line">    <span class="keyword">let</span> rightHeight = <span class="title function_">maxDepth</span>(root.<span class="property">right</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(leftHeight, rightHeight) + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(N)，其中 N 是二叉树节点的个数</li>
<li>空间复杂度：O(height)，其中 height 表示二叉树的高度。递归函数需要栈空间，而栈空间取决于递归的深度，因此，空间复杂度等价于二叉树的高度。</li>
</ul>
<h2 id="法二：广度优先遍历"><a href="#法二：广度优先遍历" class="headerlink" title="法二：广度优先遍历"></a>法二：广度优先遍历</h2><p>树的层序遍历&#x2F; 广度优先遍历是利用了<strong>队列</strong>的思想来实现的。</p>
<p><strong>关键点：</strong>每次遍历一层，则计数器 +1，直到遍历完成，则可得到树的深度。</p>
<p><strong>基本思路：</strong></p>
<ol>
<li>先做个判空处理：当 root 为空，直接返回深度为 0.</li>
<li>初始化队列 queue，计数器 res&#x3D;0</li>
<li>循环遍历：当 queue 为空时，跳出循环</li>
</ol>
<ul>
<li>初始化一个空列表 temp，用于临时存储下一层节点</li>
<li>遍历队列：遍历 queue 中的各个节点 node，并将其左子节点和右子节点加入 temp</li>
<li>更新队列：执行 queue&#x3D;temp，将下一层节点赋值给 queue</li>
<li>统计层数：执行 res +&#x3D; 1，代表层数加 1.</li>
</ul>
<ol start="4">
<li>返回 res 即可</li>
</ol>
<p>简单讲就是：<strong>通过一个 while 循环控制从上向下一层层遍历，for 循环控制每一层从左向右遍历</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * function TreeNode(val, left, right) &#123;</span></span><br><span class="line"><span class="comment"> *     this.val = (val===undefined ? 0 : val)</span></span><br><span class="line"><span class="comment"> *     this.left = (left===undefined ? null : left)</span></span><br><span class="line"><span class="comment"> *     this.right = (right===undefined ? null : right)</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">TreeNode</span>&#125; <span class="variable">root</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> maxDepth = <span class="keyword">function</span> (<span class="params">root</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (root === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> queue = [root];</span><br><span class="line">  <span class="keyword">let</span> depth = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (queue.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="comment">// 当前层的节点个数</span></span><br><span class="line">    <span class="keyword">const</span> levelSize = queue.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 逐个让当前的节点出列</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; levelSize; i++) &#123;</span><br><span class="line">      <span class="comment">// 当前出列的节点个数</span></span><br><span class="line">      <span class="keyword">const</span> cur = queue.<span class="title function_">shift</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 左右子节点入列</span></span><br><span class="line">      <span class="keyword">if</span> (cur.<span class="property">left</span>) queue.<span class="title function_">push</span>(cur.<span class="property">left</span>);</span><br><span class="line">      <span class="keyword">if</span> (cur.<span class="property">right</span>) queue.<span class="title function_">push</span>(cur.<span class="property">right</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前层所有节点已经出列，如果队列不为空，说明有下一层节点，depth+1;</span></span><br><span class="line">    <span class="keyword">if</span> (queue.<span class="property">length</span>) depth++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> depth;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(N)，其中 N 是二叉树节点的个数</li>
<li>空间复杂度：O(N)，此方法空间的消耗取决于队列存储的元素数量，其在最坏的情况下会达到 O(N)</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/02/27/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/02/27/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">异步编程之Promise</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-02-27 15:41:23 / 修改时间：18:27:08" itemprop="dateCreated datePublished" datetime="2024-02-27T15:41:23+08:00">2024-02-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/JS%E9%87%8D%E9%9A%BE%E7%82%B9/" itemprop="url" rel="index"><span itemprop="name">JS重难点</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><h3 id="1-1-区别实例对象与函数对象"><a href="#1-1-区别实例对象与函数对象" class="headerlink" title="1.1.区别实例对象与函数对象"></a>1.1.区别实例对象与函数对象</h3><ol>
<li>实例对象：new 函数产生的对象，成为实例对象，简称对象</li>
<li>函数对象：将函数作为对象使用时，简称为函数对</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>)&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> fn = <span class="keyword">new</span> <span class="title class_">Fn</span>()<span class="comment">//Fn是构造函数 fn是实例对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Fn</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"><span class="title class_">Fn</span>.<span class="title function_">bind</span>(&#123;&#125;)</span><br><span class="line">$(<span class="string">&#x27;#test&#x27;</span>) <span class="comment">//$是jQuery函数</span></span><br><span class="line">$.<span class="title function_">get</span>(./test) <span class="comment">// jQuery函数对象</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-二种类型的回调函数"><a href="#1-2-二种类型的回调函数" class="headerlink" title="1.2.二种类型的回调函数"></a>1.2.二种类型的回调函数</h3><h4 id="1-2-1-同步回调"><a href="#1-2-1-同步回调" class="headerlink" title="1.2.1. 同步回调"></a>1.2.1. <strong>同步</strong>回调</h4><ol>
<li>理解：立即执行，完全执行完了才结束，不会放进回调队列中</li>
<li>例子：数组遍历相关的回调函数（Promise 的 excutor 函数）</li>
</ol>
<h4 id="1-2-2-异步回调"><a href="#1-2-2-异步回调" class="headerlink" title="1.2.2. 异步回调"></a>1.2.2. <strong>异步</strong>回调</h4><ol>
<li>理解：不会立即执行，会放入回调队列中将来执行</li>
<li>例子：定时器回调 &#x2F; ajax 回调 &#x2F; Promise 的成功|失败回调</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步回调</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 遍历回调，同步回调</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;forEach（）之后&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//异步回调</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 异步回调，会放入队列中将来执行</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timeout callback()&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout()之后&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="1-3-JS-的-error-处理"><a href="#1-3-JS-的-error-处理" class="headerlink" title="1.3. JS 的 error 处理"></a>1.3. JS 的 error 处理</h3><h4 id="1-3-1错误处理"><a href="#1-3-1错误处理" class="headerlink" title="1.3.1错误处理"></a>1.3.1<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error">错误处理</a></h4><p>Error：所有错误的父类型</p>
<ol start="2">
<li>ReferenceError：引用的变量不存在</li>
<li>TypeError：数据类型不正确的错误</li>
<li>RangeError：数据值不在其所允许的范围内</li>
<li>SyntaxError：语法错误</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//常见的内置错误</span></span><br><span class="line"><span class="comment">//1. ReferenceError：引用的变量不存在</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)<span class="comment">//Uncaught ReferenceError: a is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2. TypeError：数据类型不正确的错误</span></span><br><span class="line"><span class="keyword">let</span> b =<span class="literal">null</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">xxx</span>)<span class="comment">// Uncaught TypeError: Cannot read properties of null (reading &#x27;xx&#x27;)</span></span><br><span class="line"><span class="keyword">let</span> b =&#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="title function_">xxx</span>())<span class="comment">//Uncaught TypeError: b.xxx is not a function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3. RangeError：数据值不在其所允许的范围内</span></span><br><span class="line"><span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>()<span class="comment">// RangeError: Maximum call stack size exceeded</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4. SyntaxError：语法错误</span></span><br><span class="line"><span class="keyword">const</span> c = <span class="string">&quot;&quot;</span><span class="string">&quot;&quot;</span><span class="comment">//SyntaxError:Unexpected string</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-2-错误处理"><a href="#1-3-2-错误处理" class="headerlink" title="1.3.2.错误处理"></a>1.3.2.错误处理</h4><ol>
<li>捕获错误：try … catch</li>
<li>抛出错误：throw error</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//捕获错误：try ... catch</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> d;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(d.<span class="property">xxx</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  <span class="comment">// console.log(error.message)</span></span><br><span class="line">  <span class="comment">// console.log(error.stack)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//抛出错误：throw error</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">something</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() % <span class="number">2</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;当前时间为奇数，可执行此任务&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果时间为偶数就抛出异常，由调用来处理</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;当前时间为偶数无法执行任务&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 捕获处理异常</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="title function_">something</span>();</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(error.<span class="property">message</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-错误对象"><a href="#1-3-3-错误对象" class="headerlink" title="1.3.3.错误对象"></a>1.3.3.错误对象</h4><ol>
<li>message：错误相关信息</li>
<li>stack：函数调用栈记录信息</li>
</ol>
<h2 id="二、Promise-的理解和使用"><a href="#二、Promise-的理解和使用" class="headerlink" title="二、Promise 的理解和使用"></a>二、Promise 的理解和使用</h2><h3 id="2-1-Promise-是什么？"><a href="#2-1-Promise-是什么？" class="headerlink" title="2.1. Promise 是什么？"></a>2.1. Promise 是什么？</h3><h4 id="2-1-1-理解"><a href="#2-1-1-理解" class="headerlink" title="2.1.1.理解"></a>2.1.1.理解</h4><ol>
<li><p>抽象表达:</p>
<p>Promise 是 JS 中进行异步编程的新的解决方案（旧的是谁？）</p>
</li>
<li><p>具体表达:</p>
<ul>
<li>从语法上来说：Promise 是一个构造函数</li>
<li>从功能上来说：Promise 对象用来封装一个异步操作并可以获取其结果</li>
</ul>
</li>
</ol>
<h4 id="2-1-2-Promise-的状态改变"><a href="#2-1-2-Promise-的状态改变" class="headerlink" title="2.1.2. Promise 的状态改变"></a>2.1.2. Promise 的状态改变</h4><ol>
<li>pending 变为 resolved</li>
<li>pending 变为 rejected</li>
</ol>
<p>说明：</p>
<ul>
<li>只有这 2 种，且一个 Promise 对象只能改变一次</li>
<li>无论变为成功还是失败，都会有一个结果数据</li>
<li>成功的结果数据一般称为 value，失败的结果数据一般称为 reason</li>
</ul>
<h4 id="2-1-3-Promise-的基本流程"><a href="#2-1-3-Promise-的基本流程" class="headerlink" title="2.1.3. Promise 的基本流程"></a>2.1.3. Promise 的基本流程</h4><p><img src="C:\Users\ADMINI~1\AppData\Local\Temp\1701010959146.png" alt="70101095914"></p>
<h4 id="2-1-4-Promise-的基本使用"><a href="#2-1-4-Promise-的基本使用" class="headerlink" title="2.1.4 Promise 的基本使用"></a>2.1.4 Promise 的基本使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建一个新的Promise</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//执行器函数 （同步回调）</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行 excutor&#x27;</span>); <span class="comment">//控制台输出（1）</span></span><br><span class="line">  <span class="comment">// 2.执行异步操作任务</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 假设当前时间为偶数是成功，奇数为失败</span></span><br><span class="line">    <span class="keyword">const</span> time = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="comment">//3.1 如果成功的话，调用resolve(value)</span></span><br><span class="line">    <span class="keyword">if</span> (time % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">&#x27;成功的数据， time=&#x27;</span> + time);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 3.2 如果失败的话。调用reject(reason)</span></span><br><span class="line">      <span class="title function_">reject</span>(<span class="string">&#x27;失败的数据，time=&#x27;</span> + time);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;new Promise（）之后&#x27;</span>); <span class="comment">//控制台输出（2）</span></span><br><span class="line"></span><br><span class="line">p.<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接收得到成功的value数据  onSolved</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功的回调&#x27;</span>, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接收得到失败的reason数据 onRejected</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;失败的回调&#x27;</span>, reason);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-为什么要用-Promise？"><a href="#2-2-为什么要用-Promise？" class="headerlink" title="2.2. 为什么要用 Promise？"></a>2.2. 为什么要用 Promise？</h3><h4 id="2-2-1-指定回调函数的方式更加灵活"><a href="#2-2-1-指定回调函数的方式更加灵活" class="headerlink" title="2.2.1 指定回调函数的方式更加灵活"></a>2.2.1 指定回调函数的方式更加灵活</h4><ol>
<li>没有 Promise 之前：必须在启动异步任务前指定</li>
<li>promise：启动异步任务 &#x3D;&gt; 返回 promise 对象 &#x3D;&gt; 给 promise 对象绑定回调函数（甚至可以在异步任务结束后指定&#x2F;多个）</li>
</ol>
<h4 id="2-2-2-支持链式调用，可以解决回调地狱的问题"><a href="#2-2-2-支持链式调用，可以解决回调地狱的问题" class="headerlink" title="2.2.2.支持链式调用，可以解决回调地狱的问题"></a>2.2.2.支持链式调用，可以解决回调地狱的问题</h4><ol>
<li><p>什么是回调地狱？</p>
<p>回调函数嵌套调用，外部回调函数异步执行的结果是嵌套的回调执行的条件</p>
<p><strong>纯函数的串联</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 每一次失败或者成功的结果都要作为下一次回调的参数传入</span></span><br><span class="line"><span class="title function_">doSomething</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">  <span class="title function_">doSomething</span>(</span><br><span class="line">    result,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">newResult</span>) &#123;</span><br><span class="line">      <span class="title function_">doSomething</span>(</span><br><span class="line">        newResult,</span><br><span class="line">        <span class="keyword">function</span> (<span class="params">finalResult</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Got the final result:&#x27;</span> + finalResult);</span><br><span class="line">        &#125;,</span><br><span class="line">        failureCallback</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    failureCallback</span><br><span class="line">  );</span><br><span class="line">&#125;, failureCallback);</span><br></pre></td></tr></table></figure>
</li>
<li><p>回调地狱的缺点？</p>
<ul>
<li>不便于阅读</li>
<li>不便于异常处理</li>
</ul>
</li>
<li><p>解决方案？</p>
<p>使用<strong>Promise 链式调用</strong>来解决 ⭐⭐</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 得到一个Promise就启动一个异步任务</span></span><br><span class="line"><span class="title function_">doSomething</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">doSomething</span>(result);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">newResult</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">doSomething</span>(newResult);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">finalResult</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Got the final result:&#x27;</span> + finalResult);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(failureCallback); <span class="comment">//异常传透</span></span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
<li><p>终极解决方案？</p>
<p><strong>async&#x2F;await</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">doSomething</span>();</span><br><span class="line">    <span class="keyword">const</span> newResult = <span class="keyword">await</span> <span class="title function_">doSomething</span>(result);</span><br><span class="line">    <span class="keyword">const</span> finalResult = <span class="keyword">await</span> <span class="title function_">doSomething</span>(newResult);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Got the final result:&#x27;</span> + finalResult);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="title function_">failureCallback</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ol>
<h3 id="2-3-如何使用-Promise？"><a href="#2-3-如何使用-Promise？" class="headerlink" title="2.3. 如何使用 Promise？"></a>2.3. 如何使用 Promise？</h3><h4 id="2-3-1-API"><a href="#2-3-1-API" class="headerlink" title="2.3.1. API"></a>2.3.1. API</h4><ol>
<li><p>Promise 构造函数：Promise（excutor){}</p>
<ul>
<li>excutor 函数：执行器（resolve, reject) &#x3D;&gt; {}</li>
<li>resolve 函数：内部定义成功时我们调用的函数 value &#x3D;&gt; {}</li>
<li>reject 函数：内部定义失败时我们调用的函数 reason &#x3D;&gt; {}</li>
</ul>
<p>说明：excutor 会在 Promise 内部立即同步回调，异步操作在执行器中执行</p>
</li>
<li><p>Promise.prototype.then 方法：(onResolved，onRejected) &#x3D;&gt; {}</p>
<ul>
<li><p>onResolved 函数：成功的回调函数 （value） &#x3D;&gt; {}</p>
</li>
<li><p>onRejected 函数：成功的回调函数 （reason） &#x3D;&gt; {}</p>
<p>说明：指定用于得到成功 value 的成功回调和用于得到失败 reason 的失败回调，返回一个新的 promise 对象</p>
</li>
</ul>
</li>
<li><p>Promise.prototype.catch 方法：(onRejected) &#x3D;&gt; {}</p>
<ul>
<li>onRejected 函数：成功的回调函数 （reason） &#x3D;&gt; {}</li>
</ul>
<p>说明：then()的语法糖，相当于 then(undefined, onRejected)</p>
</li>
<li><p>Promise.resolve 方法：（value）&#x3D;&gt; {}</p>
<ul>
<li><p>value：成功数据 &#x2F; promise 对象</p>
<p>说明：返回一个成功 &#x2F; 失败的 promise 对象</p>
</li>
</ul>
</li>
<li><p>Promise.reject 方法：（reason）&#x3D;&gt; {}</p>
<ul>
<li><p>reason：失败原因</p>
<p>说明：返回一个失败的 promise 对象</p>
</li>
</ul>
</li>
<li><p>Promise.all 方法：(promises) &#x3D;&gt; {}</p>
<ul>
<li><p>promises：包含 n 个 promise 对象的数组</p>
<p>说明：返回一个新的 promise，只有所有的 promise 都成功才是成功，只要有一个失败就是失败</p>
</li>
</ul>
</li>
<li><p>Promise.race 方法：(promises) &#x3D;&gt; {}</p>
<ul>
<li><p>promises：包含 n 个 promise 对象的数组</p>
<p>说明：返回一个 promise，第一个完成的 promise 结果状态就是最终的结果状态</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;成功数据&#x27;</span>);</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&#x27;失败数据&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onResolved()1&#x27;</span>, value);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onRejected()1&#x27;</span>, reason);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//产生一个成功值为1的promise对象</span></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> p3 = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="number">3</span>);</span><br><span class="line">p1.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value));</span><br><span class="line">p2.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value));</span><br><span class="line">p3.<span class="title function_">then</span>(<span class="function">(<span class="params">reason</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(reason));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pAll = <span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2, p3]);</span><br><span class="line">pAll.<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;all onResolved()&#x27;</span>, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;all onRejected()&#x27;</span>, reason);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pRace = <span class="title class_">Promise</span>.<span class="title function_">race</span>([p1, p2, p3]);</span><br><span class="line">pRace.<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;race onResolved()&#x27;</span>, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;race onRejected()&#x27;</span>, reason);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-3-2-Promise-的几个关键问题"><a href="#2-3-2-Promise-的几个关键问题" class="headerlink" title="2.3.2. Promise 的几个关键问题"></a>2.3.2. Promise 的几个关键问题</h4><ol>
<li><p>如何改变 promise 的状态？</p>
<ul>
<li>reslove(value)：如果当前是 pedding 就会变成 resolved</li>
<li>reject(reason)：如果当前是 pedding 就会变成 rejected</li>
<li>抛出异常：如果当前是 pedding 就会变成 rejected</li>
</ul>
</li>
<li><p>一个 Promise 指定多个成功&#x2F; 失败的回调函数，都会被调用吗？</p>
<p><strong>当 promise 改变为对应状态时都会被调用</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// resolve(1)// promise 变为resolved成功状态</span></span><br><span class="line">  <span class="comment">// reject(2)// promise 变为rejected失败状态</span></span><br><span class="line">  <span class="comment">// throw new Error(&#x27;出错了&#x27;) // 抛出异常，promise变为rejected失败状态，reason为抛出的error</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="number">3</span>; <span class="comment">//error就为3</span></span><br><span class="line">&#125;);</span><br><span class="line">p.<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">  <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line">p.<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">  <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason2&#x27;</span>, reason);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 同时调用两个p.then()方法，两个都会调用返回</span></span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
<li><p>改变 promise 状态和指定回调函数谁先谁后？</p>
<p>（1）都有可能，正常情况下是先指定回调再改变状态，但也可以先改变状态再指定回调</p>
<p>（2）如何先改变状态再指定回调？</p>
<ul>
<li>在执行器中直接调用 resolve() &#x2F; reject()</li>
<li>延迟更长时间才调用 then()</li>
</ul>
<p>（3）什么时候才能得到数据？</p>
<ul>
<li>如果先指定的回调，那当状态发生改变时，回调函数就会调用，得到数据</li>
<li>如果先改变的状态，那当指定回调时，回调函数就会被调用，得到数据</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常规：先指定回调函数，再改变状态</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">1</span>); <span class="comment">// 后改变的状态（同时指定函数），异步执行回调函数</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(</span><br><span class="line">  <span class="comment">// 先指定回调函数，保存当前指定的回调函数</span></span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;value&#x27;</span>, value);</span><br><span class="line">  &#125;, <span class="comment">//(2)</span></span><br><span class="line">  <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 怎么证明(2)同步还是异步？就看（1）和（2）的打印顺序</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;================================&#x27;</span>); <span class="comment">//(1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如何先改状态，后指定回调函数</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, rejected</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="number">1</span>); <span class="comment">// 先改变的状态（同时指定数据）</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(</span><br><span class="line">  <span class="comment">//后指定回调函数，异步执行回调函数</span></span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;value2&#x27;</span>, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">1</span>); <span class="comment">// 后改变的状态（同时指定函数），异步执行回调函数</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  p.<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;value2&#x27;</span>, value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reason&#x27;</span>, reason);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;, <span class="number">1100</span>);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>Promise.then()返回的新 promise 的结果状态由什么决定？</strong>⭐⭐⭐⭐⭐</li>
</ol>
<ul>
<li>简单表达：由 then() 指定的回调函数执行的结果决定</li>
<li>详细表达：<ul>
<li>如果抛出异常，新的 promise 变为 rejected，reason 为抛出的异常</li>
<li>如果返回的是非 promise 的任意值，新 promise 变为 resolved，value 为返回值</li>
<li>如果返回的是另一个新 promise，此 promise 的结果就会成为新 promise 的结果</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, rejected</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// resolve(1)</span></span><br><span class="line">  <span class="title function_">reject</span>(<span class="number">1</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onResolved1()&#x27;</span>, value);</span><br><span class="line">      <span class="comment">// return 2</span></span><br><span class="line">      <span class="comment">// return Promise.resolve(3)</span></span><br><span class="line">      <span class="comment">// return Promise.reject(4)</span></span><br><span class="line">      <span class="comment">// throw 5</span></span><br><span class="line">      <span class="comment">//掌握这里的不同情况，下面then（）的执行结果情况</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onRejected1()&#x27;</span>, reason);</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onResolved2()&#x27;</span>, value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onRejected2()&#x27;</span>, reason);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>promise 如何串连多个操作任务？<ul>
<li>promise 的 then()返回一个新的 promise，可以开成 then()的链式调用</li>
<li>通过 then 的链式调用串连多个同步&#x2F;异步任务</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, rejected</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行任务1（异步）&#x27;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;任务1的结果&#x27;</span>, value);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行任务2（同步)&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;任务2的结果&#x27;</span>, value);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行任务3（异步）&#x27;</span>);</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;任务3的结果&#x27;</span>, value);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//.html:27 执行任务1（异步）</span></span><br><span class="line"><span class="comment">//.html:32 任务1的结果 1</span></span><br><span class="line"><span class="comment">//.html:33 执行任务2（同步)</span></span><br><span class="line"><span class="comment">//.html:38 任务2的结果 2</span></span><br><span class="line"><span class="comment">//.html:40 执行任务3（异步）</span></span><br><span class="line"><span class="comment">//.html:46 任务3的结果 3</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>promise 异常传透？</p>
<ul>
<li>当使用 promise 的 then 链式调用时，可以在最后指定失败的回调</li>
<li>前面任何操作出了异常，都会传到最后失败的回调中处理</li>
</ul>
</li>
<li><p>中断 Promise 链？</p>
<ul>
<li>当使用 promise 的 then 链式调用时，在中间中断，不再调用后面的回调函数</li>
<li>办法：在回调函数中返回一个 pedding 状态的 promise 对象</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// resolve(1)</span></span><br><span class="line">  <span class="title function_">reject</span>(<span class="number">1</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onResolved1()&#x27;</span>, value);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// reason =&gt; &#123;throw reason&#125; 不写 ，失败回调的话默认是抛出异常</span></span><br><span class="line">  )</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onResolved2()&#x27;</span>, value);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// reason =&gt; &#123;throw reason&#125; 不写 ，失败回调的话默认是抛出异常</span></span><br><span class="line">  )</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onResolved3()&#x27;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// reason =&gt; &#123;throw reason&#125; 不写 ，失败回调的话默认是抛出异常</span></span><br><span class="line">    <span class="comment">// 也可以改为 reason =&gt; Promise.reject(reason)</span></span><br><span class="line">  )</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// onRejected1() 1</span></span><br><span class="line">    <span class="comment">// 并不是直接跳到catch执行，是一步一步回调新的promise失败才最后执行catch</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onRejected1()&#x27;</span>, reason);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123;&#125;); <span class="comment">//返回一个pedding的promise，后面的链式回调都不会执行了,即中断Promise</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onResolved4()&#x27;</span>, value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onRejected2()&#x27;</span>, reason);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<h2 id="三、自定义（手写）Promise"><a href="#三、自定义（手写）Promise" class="headerlink" title="三、自定义（手写）Promise"></a>三、自定义（手写）Promise</h2><h3 id="3-1-定义整体结构"><a href="#3-1-定义整体结构" class="headerlink" title="3.1. 定义整体结构"></a>3.1. 定义整体结构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义Promise函数模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(<span class="keyword">function</span> <span class="title function_">Promise</span> (<span class="variable language_">window</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;pending&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">RESOLVED</span> = <span class="string">&#x27;resolved&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Promise</span> (excutor) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 暴露Promise</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">Promise</span> = <span class="title class_">Promise</span></span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Promise-构造函数的实现"><a href="#3-2-Promise-构造函数的实现" class="headerlink" title="3.2. Promise 构造函数的实现"></a>3.2. Promise 构造函数的实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Promise</span>(<span class="params">excutor</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果当前状态不是pedding，直接结束</span></span><br><span class="line">  <span class="keyword">if</span> (self.<span class="property">status</span> !== <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  self.<span class="property">status</span> = <span class="variable constant_">PENDING</span>; <span class="comment">// 给promise对象指定status属性，初始值为pending</span></span><br><span class="line">  self.<span class="property">data</span> = <span class="literal">undefined</span>; <span class="comment">// 给promise对象指定一个用于存储结果数据的属性</span></span><br><span class="line">  self.<span class="property">callbacks</span> = []; <span class="comment">// 每个元素的结构： &#123;onResolved（）&#123;&#125;，onRejected()&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="comment">// 将状态改为resolved</span></span><br><span class="line">    self.<span class="property">status</span> = <span class="variable constant_">RESOLVED</span>;</span><br><span class="line">    <span class="comment">// 保存value数据</span></span><br><span class="line">    self.<span class="property">data</span> = value;</span><br><span class="line">    <span class="comment">// 如果有待执行callbacks函数，立即异步执行回调函数onResolved</span></span><br><span class="line">    <span class="keyword">if</span> (self.<span class="property">callbacks</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 放入队列中执行所有成功的回调</span></span><br><span class="line">        self.<span class="property">callbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">callbacksObj</span>) =&gt;</span> &#123;</span><br><span class="line">          callbacksObj.<span class="title function_">onResolved</span>(value);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果当前状态不是pedding，直接结束</span></span><br><span class="line">    <span class="keyword">if</span> (self.<span class="property">status</span> !== <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将状态改为rejected</span></span><br><span class="line">    self.<span class="property">status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">    <span class="comment">// 保存reason数据</span></span><br><span class="line">    self.<span class="property">data</span> = reason;</span><br><span class="line">    <span class="comment">// 如果有待执行callbacks函数，立即异步执行回调函数onRejected</span></span><br><span class="line">    <span class="keyword">if</span> (self.<span class="property">callbacks</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 放入队列中执行所有成功的回调</span></span><br><span class="line">        self.<span class="property">callbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">callbacksObj</span>) =&gt;</span> &#123;</span><br><span class="line">          callbacksObj.<span class="title function_">onRejected</span>(reason);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 立即执行excutor</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title function_">excutor</span>(resolve, reject);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// 如果执行器抛出异常，promise对象变为rejected状态</span></span><br><span class="line">    <span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-Promise-then-catch-的实现"><a href="#3-3-Promise-then-catch-的实现" class="headerlink" title="3.3. Promise.then()&#x2F;catch()的实现"></a>3.3. Promise.then()&#x2F;catch()的实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise原型对象的then()</span></span><br><span class="line"><span class="comment"> * 指定成功和失败的回调函数</span></span><br><span class="line"><span class="comment"> * 返回一个新的Promise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span> (<span class="params">onResolved, onRejected</span>) &#123;</span><br><span class="line">  onResolved = <span class="keyword">typeof</span> onResolved === <span class="string">&#x27;function&#x27;</span> ? onRejected : <span class="function">(<span class="params">value</span>) =&gt;</span> value; <span class="comment">// 向后传递成功的value</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指定默认的失败回调（实现错误/异步穿透的关键点）</span></span><br><span class="line">  onRejected =</span><br><span class="line">    <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">      ? onRejected</span><br><span class="line">      : <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> reason;</span><br><span class="line">        &#125;; <span class="comment">//向后传递失败的reason</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> self = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回一个新的promise对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; callback 调用指定的回调函数处理根据执行的结果，改变return的promise的状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handle</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">          1.如果抛出异常，return的promise就会失败，reason就是error</span></span><br><span class="line"><span class="comment">          2.如果回调函数返回不是promise，return的promise就会成功，value就是返回值</span></span><br><span class="line"><span class="comment">          3.如果回调函数返回是promise，return的promise结果就是这个promise的结果</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="title function_">onResolved</span>(self.<span class="property">data</span>);</span><br><span class="line">        <span class="comment">// 3.如果回调函数返回是promise，return的promise结果就是这个promise的结果</span></span><br><span class="line">        <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">          <span class="comment">// result.then(</span></span><br><span class="line">          <span class="comment">//   value =&gt; resolve(value),// 当result成功时，让return的promise也成功</span></span><br><span class="line">          <span class="comment">//   reason =&gt; reject(reason)// 当result失败时，让return的promise也失败</span></span><br><span class="line">          <span class="comment">// )</span></span><br><span class="line">          <span class="comment">//与上面分开写是一样的效果</span></span><br><span class="line">          result.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 如果回调函数返回不是promise，return的promise就会成功，value就是返回值</span></span><br><span class="line">          <span class="title function_">resolve</span>(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// 如果抛出异常，return的promise就会失败，reason就是error</span></span><br><span class="line">        <span class="title function_">reject</span>(error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前状态还是pedding状态，将回调函数保存起来</span></span><br><span class="line">    <span class="keyword">if</span> (self.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">      self.<span class="property">callbacks</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="title function_">onResolved</span>(<span class="params">value</span>) &#123;</span><br><span class="line">          <span class="title function_">handle</span>(onResolved);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">onRejected</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">          <span class="title function_">handle</span>(onRejected);</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.<span class="property">status</span> === <span class="variable constant_">RESOLVED</span>) &#123;</span><br><span class="line">      <span class="comment">//如果当前是resolved状态，异步执行onResolved并改变return的promise状态</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">handle</span>(onResolved);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// //如果当前是resolved状态，异步执行onRejected并改变return的promise状态</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">handle</span>(onRejected);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise原型对象的catch()</span></span><br><span class="line"><span class="comment"> * 指定失败的回调函数</span></span><br><span class="line"><span class="comment"> * 返回一个新的Promise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">catch</span> = <span class="keyword">function</span> (<span class="params">onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">undefined</span>, onRejected);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-Promise-resolve-reject-的实现"><a href="#3-4-Promise-resolve-reject-的实现" class="headerlink" title="3.4. Promise.resolve()&#x2F;reject()的实现"></a>3.4. Promise.resolve()&#x2F;reject()的实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise对象的resolve方法</span></span><br><span class="line"><span class="comment"> * 返回一个指定结果的成功的promise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="comment">//返回一个成功/失败的promise</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//value是promise</span></span><br><span class="line">    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">      <span class="comment">// 使用value的结果作为promise的结果</span></span><br><span class="line">      value.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// value不是promise =&gt; promise 变为成功，数据为value</span></span><br><span class="line">      <span class="title function_">resolve</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">reject</span>(reason);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise对象的reject方法</span></span><br><span class="line"><span class="comment"> * 返回一个指定结果的失败的Promise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">  <span class="comment">//返回一个失败的promise</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(reason);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-Promise-all-race-的实现"><a href="#3-5-Promise-all-race-的实现" class="headerlink" title="3.5. Promise.all()&#x2F;race()的实现"></a>3.5. Promise.all()&#x2F;race()的实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise对象的all方法</span></span><br><span class="line"><span class="comment"> * 返回一个Promise，只有当所有成功时才成功，否则失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">all</span> = <span class="keyword">function</span> (<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="comment">// 用来保存所有成功value的数组</span></span><br><span class="line">  <span class="keyword">const</span> values = <span class="keyword">new</span> <span class="title class_">Array</span>(promises.<span class="property">length</span>);</span><br><span class="line">  <span class="comment">// 用来保存成功的promise数量</span></span><br><span class="line">  <span class="keyword">let</span> resolvedCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 遍历promise</span></span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p, index</span>) =&gt;</span> &#123;</span><br><span class="line">      p.<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">          resolvedCount++; <span class="comment">// 成功的promise数量+1</span></span><br><span class="line">          <span class="comment">// p成功，将成功的value保存到values</span></span><br><span class="line">          <span class="comment">// values.push(value)</span></span><br><span class="line">          values[index] = value;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 如果全部成功了，将return的promise改变成功</span></span><br><span class="line">          <span class="keyword">if</span> (resolvedCount === promises.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(values);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 只要一个失败了，return的promise就失败</span></span><br><span class="line">          <span class="title function_">reject</span>(reason);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise对象的race方法</span></span><br><span class="line"><span class="comment"> * 返回一个Promise，第一个返回的就是结果，不管成功或失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">race</span> = <span class="keyword">function</span> (<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="comment">// 返回一个promise获取每个promise的结果</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p, index</span>) =&gt;</span> &#123;</span><br><span class="line">      p.<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 一旦有成功的，将return变为成功</span></span><br><span class="line">          <span class="title function_">resolve</span>(value);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 一旦有失败了，将return变为失败</span></span><br><span class="line">          <span class="title function_">reject</span>(reason);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-完整版代码"><a href="#3-6-完整版代码" class="headerlink" title="3.6.完整版代码"></a>3.6.完整版代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Description: 自定义Promise</span></span><br><span class="line"><span class="comment"> * @author: kelly</span></span><br><span class="line"><span class="comment"> * @Date: 2023-11-27 14:35:32</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2023-11-28 10:04:08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义Promise函数模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(<span class="keyword">function</span> <span class="title function_">Promise</span>(<span class="params"><span class="variable language_">window</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">RESOLVED</span> = <span class="string">&#x27;resolved&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise构造函数</span></span><br><span class="line"><span class="comment">   * excutor：执行器函数(同步执行)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Promise</span>(<span class="params">excutor</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果当前状态不是pedding，直接结束</span></span><br><span class="line">    <span class="keyword">if</span> (self.<span class="property">status</span> !== <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    self.<span class="property">status</span> = <span class="variable constant_">PENDING</span>; <span class="comment">// 给promise对象指定status属性，初始值为pending</span></span><br><span class="line">    self.<span class="property">data</span> = <span class="literal">undefined</span>; <span class="comment">// 给promise对象指定一个用于存储结果数据的属性</span></span><br><span class="line">    self.<span class="property">callbacks</span> = []; <span class="comment">// 每个元素的结构： &#123;onResolved（）&#123;&#125;，onRejected()&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="comment">// 将状态改为resolved</span></span><br><span class="line">      self.<span class="property">status</span> = <span class="variable constant_">RESOLVED</span>;</span><br><span class="line">      <span class="comment">// 保存value数据</span></span><br><span class="line">      self.<span class="property">data</span> = value;</span><br><span class="line">      <span class="comment">// 如果有待执行callbacks函数，立即异步执行回调函数onResolved</span></span><br><span class="line">      <span class="keyword">if</span> (self.<span class="property">callbacks</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 放入队列中执行所有成功的回调</span></span><br><span class="line">          self.<span class="property">callbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">callbacksObj</span>) =&gt;</span> &#123;</span><br><span class="line">            callbacksObj.<span class="title function_">onResolved</span>(value);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果当前状态不是pedding，直接结束</span></span><br><span class="line">      <span class="keyword">if</span> (self.<span class="property">status</span> !== <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 将状态改为rejected</span></span><br><span class="line">      self.<span class="property">status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">      <span class="comment">// 保存reason数据</span></span><br><span class="line">      self.<span class="property">data</span> = reason;</span><br><span class="line">      <span class="comment">// 如果有待执行callbacks函数，立即异步执行回调函数onRejected</span></span><br><span class="line">      <span class="keyword">if</span> (self.<span class="property">callbacks</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 放入队列中执行所有成功的回调</span></span><br><span class="line">          self.<span class="property">callbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">callbacksObj</span>) =&gt;</span> &#123;</span><br><span class="line">            callbacksObj.<span class="title function_">onRejected</span>(reason);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 立即执行excutor</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="title function_">excutor</span>(resolve, reject);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="comment">// 如果执行器抛出异常，promise对象变为rejected状态</span></span><br><span class="line">      <span class="title function_">reject</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise原型对象的then()</span></span><br><span class="line"><span class="comment">   * 指定成功和失败的回调函数</span></span><br><span class="line"><span class="comment">   * 返回一个新的Promise</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span> (<span class="params">onResolved, onRejected</span>) &#123;</span><br><span class="line">    onResolved =</span><br><span class="line">      <span class="keyword">typeof</span> onResolved === <span class="string">&#x27;function&#x27;</span> ? onRejected : <span class="function">(<span class="params">value</span>) =&gt;</span> value; <span class="comment">// 向后传递成功的value</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定默认的失败回调（实现错误/异步穿透的关键点）</span></span><br><span class="line">    onRejected =</span><br><span class="line">      <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? onRejected</span><br><span class="line">        : <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> reason;</span><br><span class="line">          &#125;; <span class="comment">//向后传递失败的reason</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> self = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回一个新的promise对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; callback 调用指定的回调函数处理根据执行的结果，改变return的promise的状态</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">handle</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          1.如果抛出异常，return的promise就会失败，reason就是error</span></span><br><span class="line"><span class="comment">          2.如果回调函数返回不是promise，return的promise就会成功，value就是返回值</span></span><br><span class="line"><span class="comment">          3.如果回调函数返回是promise，return的promise结果就是这个promise的结果</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> result = <span class="title function_">onResolved</span>(self.<span class="property">data</span>);</span><br><span class="line">          <span class="comment">// 3.如果回调函数返回是promise，return的promise结果就是这个promise的结果</span></span><br><span class="line">          <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="comment">// result.then(</span></span><br><span class="line">            <span class="comment">//   value =&gt; resolve(value),// 当result成功时，让return的promise也成功</span></span><br><span class="line">            <span class="comment">//   reason =&gt; reject(reason)// 当result失败时，让return的promise也失败</span></span><br><span class="line">            <span class="comment">// )</span></span><br><span class="line">            <span class="comment">//与上面分开写是一样的效果</span></span><br><span class="line">            result.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果回调函数返回不是promise，return的promise就会成功，value就是返回值</span></span><br><span class="line">            <span class="title function_">resolve</span>(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="comment">// 如果抛出异常，return的promise就会失败，reason就是error</span></span><br><span class="line">          <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 当前状态还是pedding状态，将回调函数保存起来</span></span><br><span class="line">      <span class="keyword">if</span> (self.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">        self.<span class="property">callbacks</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">          <span class="title function_">onResolved</span>(<span class="params">value</span>) &#123;</span><br><span class="line">            <span class="title function_">handle</span>(onResolved);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="title function_">onRejected</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">            <span class="title function_">handle</span>(onRejected);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.<span class="property">status</span> === <span class="variable constant_">RESOLVED</span>) &#123;</span><br><span class="line">        <span class="comment">//如果当前是resolved状态，异步执行onResolved并改变return的promise状态</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">handle</span>(onResolved);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// //如果当前是resolved状态，异步执行onRejected并改变return的promise状态</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">handle</span>(onRejected);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise原型对象的catch()</span></span><br><span class="line"><span class="comment">   * 指定失败的回调函数</span></span><br><span class="line"><span class="comment">   * 返回一个新的Promise</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">catch</span> = <span class="keyword">function</span> (<span class="params">onRejected</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">undefined</span>, onRejected);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise对象的resolve方法</span></span><br><span class="line"><span class="comment">   * 返回一个指定结果的成功的promise</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="comment">//返回一个成功/失败的promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//value是promise</span></span><br><span class="line">      <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">        <span class="comment">// 使用value的结果作为promise的结果</span></span><br><span class="line">        value.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// value不是promise =&gt; promise 变为成功，数据为value</span></span><br><span class="line">        <span class="title function_">resolve</span>(value);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">reject</span>(reason);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise对象的reject方法</span></span><br><span class="line"><span class="comment">   * 返回一个指定结果的失败的Promise</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">    <span class="comment">//返回一个失败的promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">reject</span>(reason);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise对象的all方法</span></span><br><span class="line"><span class="comment">   * 返回一个Promise，只有当所有成功时才成功，否则失败</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title class_">Promise</span>.<span class="property">all</span> = <span class="keyword">function</span> (<span class="params">promises</span>) &#123;</span><br><span class="line">    <span class="comment">// 用来保存所有成功value的数组</span></span><br><span class="line">    <span class="keyword">const</span> values = <span class="keyword">new</span> <span class="title class_">Array</span>(promises.<span class="property">length</span>);</span><br><span class="line">    <span class="comment">// 用来保存成功的promise数量</span></span><br><span class="line">    <span class="keyword">let</span> resolvedCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 遍历promise</span></span><br><span class="line">      promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p, index</span>) =&gt;</span> &#123;</span><br><span class="line">        p.<span class="title function_">then</span>(</span><br><span class="line">          <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">            resolvedCount++; <span class="comment">// 成功的promise数量+1</span></span><br><span class="line">            <span class="comment">// p成功，将成功的value保存到values</span></span><br><span class="line">            <span class="comment">// values.push(value)</span></span><br><span class="line">            values[index] = value;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果全部成功了，将return的promise改变成功</span></span><br><span class="line">            <span class="keyword">if</span> (resolvedCount === promises.<span class="property">length</span>) &#123;</span><br><span class="line">              <span class="title function_">resolve</span>(values);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 只要一个失败了，return的promise就失败</span></span><br><span class="line">            <span class="title function_">reject</span>(reason);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise对象的race方法</span></span><br><span class="line"><span class="comment">   * 返回一个Promise，第一个返回的就是结果，不管成功或失败</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title class_">Promise</span>.<span class="property">race</span> = <span class="keyword">function</span> (<span class="params">promises</span>) &#123;</span><br><span class="line">    <span class="comment">// 返回一个promise获取每个promise的结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p, index</span>) =&gt;</span> &#123;</span><br><span class="line">        p.<span class="title function_">then</span>(</span><br><span class="line">          <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 一旦有成功的，将return变为成功</span></span><br><span class="line">            <span class="title function_">resolve</span>(value);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 一旦有失败了，将return变为失败</span></span><br><span class="line">            <span class="title function_">reject</span>(reason);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 暴露Promise</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">Promise</span> = <span class="title class_">Promise</span>;</span><br><span class="line">&#125;)(<span class="variable language_">window</span>);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/02/20/%E7%AA%97%E5%8F%A3%E6%BB%91%E5%8A%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/02/20/%E7%AA%97%E5%8F%A3%E6%BB%91%E5%8A%A8/" class="post-title-link" itemprop="url">窗口滑动之经典案例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-02-20 17:01:33" itemprop="dateCreated datePublished" datetime="2024-02-20T17:01:33+08:00">2024-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-03-19 17:25:09" itemprop="dateModified" datetime="2024-03-19T17:25:09+08:00">2024-03-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="长度最小的子数组"><a href="#长度最小的子数组" class="headerlink" title="长度最小的子数组"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-size-subarray-sum/description">长度最小的子数组</a></h1><p>题目要求是要满足连续子数组的<code>sum</code> 值大于等于 <code>target</code> 值，然后返回子数组的最小长度。</p>
<h2 id="法一：二分查找"><a href="#法一：二分查找" class="headerlink" title="法一：二分查找"></a>法一：二分查找</h2><p>解题思路：</p>
<ol>
<li>计算 <code>nums</code> 的前缀和 <code>sums</code>；</li>
<li>寻找：二分查找的结果大于或等于 <code>target + sums[i]</code>，记录下来，最后返回长度最小的结果数组的长度。<br>特别注意：二分查找的条件</li>
</ol>
<p>代码实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> minSubArrayLen = <span class="keyword">function</span> (<span class="params">target, nums</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> n = nums.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> ans = <span class="title class_">Infinity</span>;</span><br><span class="line">  <span class="keyword">const</span> sums = [<span class="number">0</span>]; <span class="comment">// 前缀和</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    sums[i] = sums[i - <span class="number">1</span>] + nums[i - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> endValue = sums[i - <span class="number">1</span>] + target;</span><br><span class="line">    <span class="keyword">let</span> bound = <span class="title function_">binarySearch</span>(sums, i, n, endValue);</span><br><span class="line">    <span class="keyword">if</span> (bound !== -<span class="number">1</span>) &#123;</span><br><span class="line">      ans = <span class="title class_">Math</span>.<span class="title function_">min</span>(ans, bound - (i - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans === <span class="title class_">Infinity</span> ? <span class="number">0</span> : ans;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 二分查找</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">binarySearch</span>(<span class="params">a, l, r, target</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">    <span class="keyword">let</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (a[mid] &lt; target) &#123;</span><br><span class="line">      l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      r = mid;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a[l] &gt;= target ? l : -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)</li>
<li>空间复杂度：O(n)</li>
</ul>
<h2 id="法二：使用队列相加（实际上也类似于一个滑动窗口）"><a href="#法二：使用队列相加（实际上也类似于一个滑动窗口）" class="headerlink" title="法二：使用队列相加（实际上也类似于一个滑动窗口）"></a>法二：使用队列相加（实际上也类似于一个滑动窗口）</h2><p>解题思路：</p>
<ol>
<li>将数组中的元素不停的入队，入队就顺便累加到 <code>sum</code> 中，直到 <code>sum</code>的值大于或等于 <code>target</code> 结束，记录下此时队列的长度；</li>
<li>然后不停的出队，<code>sum</code> 累减出队的元素，重复步骤 1；</li>
<li>不断重复这个队列的操作，直到数组遍历结束时，即没有新的元素可以添加到队列中；</li>
<li>最后返回记录下来的子数组的最小长度。</li>
</ol>
<p>接下来以数组[2,3,1,2,4,3]为例来画图，使得思路更清晰一些：</p>
<p><img src="https://pic.leetcode-cn.com/10ca012c2f0170afcac5e5996add20c32c36a82f4bb4a6187897bb948ace5fe2-image.png"></p>
<p><img src="https://pic.leetcode-cn.com/2da8cf86a2a3df3c95ed7d95add574dca2d8bae8420addd0fa6b8c55fa3db081-image.png"></p>
<p><img src="https://pic.leetcode-cn.com/ca74b1a2ad0eb5a4ebf8647a332161b140c8ebdd71cd5d19bef16e9bf0a43c95-image.png"></p>
<p><img src="https://pic.leetcode-cn.com/72f39b5cd7eb5f866e24d0a31eb3eac7d57cf3ad202ad40d30f103833c1f5a69-image.png"></p>
<p>不过，这里我们不使用队列来书写代码，而是采用双指针的方式来书写代码，两端指针包围的元素就是队列中的元素。</p>
<p>代码实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> minSubArrayLen = <span class="keyword">function</span> (<span class="params">target, nums</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> n = nums.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> start = <span class="number">0</span>,</span><br><span class="line">    end = <span class="number">0</span>,</span><br><span class="line">    sum = <span class="number">0</span>,</span><br><span class="line">    min = <span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span>;</span><br><span class="line">  <span class="keyword">while</span> (end &lt; n) &#123;</span><br><span class="line">    sum += nums[end];</span><br><span class="line">    <span class="comment">// 不断移动左指针，直到不能再缩小为止</span></span><br><span class="line">    <span class="keyword">while</span> (sum &gt;= target) &#123;</span><br><span class="line">      min = <span class="title class_">Math</span>.<span class="title function_">min</span>(min, end - start + <span class="number">1</span>);</span><br><span class="line">      sum -= nums[start++];</span><br><span class="line">    &#125;</span><br><span class="line">    end++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> min === <span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span> ? <span class="number">0</span> : min;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度: O(n)</li>
<li>空间复杂度: O(1)</li>
</ul>
<h1 id="无重复字符的最长子串"><a href="#无重复字符的最长子串" class="headerlink" title="无重复字符的最长子串"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/description">无重复字符的最长子串</a></h1><h2 id="法一：维护数组："><a href="#法一：维护数组：" class="headerlink" title="法一：维护数组："></a>法一：维护数组：</h2><p>解题思路：使用一个数组来维护滑动窗口</p>
<p>遍历字符串，判断字符串是否在滑动窗口数组中：</p>
<ul>
<li>不在则<code>push</code>进数组</li>
<li>存在则删除滑动窗口数组里相同字符以及相同字符当前的字符，然后将当前字符<code>push</code>进数组</li>
<li>然后将<code>maxLen</code>更新为当前最长子串的长度<br>遍历结束后，返回<code>maxLen</code></li>
</ul>
<p>接下来，我们借助画图来进一步理解：</p>
<p><img src="https://pic.leetcode-cn.com/202ea5bd4d4ba4a21afafdf52a9ea2556ba6265c1576840f09ace50aafab095c.png"></p>
<p>代码实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLongestSubstring = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> arr = [],</span><br><span class="line">    maxLen = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; s.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> index = arr.<span class="title function_">indexOf</span>(s[i]);</span><br><span class="line">    <span class="keyword">if</span> (index !== -<span class="number">1</span>) &#123;</span><br><span class="line">      arr.<span class="title function_">splice</span>(<span class="number">0</span>, index + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    arr.<span class="title function_">push</span>(s.<span class="title function_">charAt</span>(i));</span><br><span class="line">    maxLen = <span class="title class_">Math</span>.<span class="title function_">max</span>(arr.<span class="property">length</span>, maxLen);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> maxLen;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n^2)，其中 arr.indexOf()时间复杂度为 O(n)，arr.splice(0,index+1)的时间复杂度为 O(n)</li>
<li>空间复杂度：O(n)</li>
</ul>
<h2 id="法二：维护下标："><a href="#法二：维护下标：" class="headerlink" title="法二：维护下标："></a>法二：维护下标：</h2><p>解题思路：使用下标来维护滑动窗口</p>
<p>与法一思路基本一致。</p>
<p>代码实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLongestSubstring = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>,</span><br><span class="line">    maxLen = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, j = <span class="number">0</span>; j &lt; s.<span class="property">length</span>; j++) &#123;</span><br><span class="line">    index = s.<span class="title function_">substring</span>(i, j).<span class="title function_">indexOf</span>(s[j]);</span><br><span class="line">    <span class="keyword">if</span> (index !== -<span class="number">1</span>) &#123;</span><br><span class="line">      i = i + index + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    maxLen = <span class="title class_">Math</span>.<span class="title function_">max</span>(maxLen, j - i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> maxLen;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n^2)</li>
<li>空间复杂度：O(n)</li>
</ul>
<h2 id="法三：哈希表，优化-Map"><a href="#法三：哈希表，优化-Map" class="headerlink" title="法三：哈希表，优化 Map"></a>法三：哈希表，优化 Map</h2><p>解题思路：</p>
<ol>
<li>建立一个哈希表 <code>map</code>， <code>key</code> 为字符串， <code>value</code> 为下标，设置一个记录最大长度的 <code>maxLen</code>；</li>
<li>使用<code>l</code> 来标记无重复子串开始下标，<code>r</code> 为当前遍历字符的下标；</li>
<li>遍历整个字符串数组，如果当前字符存在于哈希表中，则更新无重复子串开始下标 <code>i</code> 为相同字符的下一位置，此时从<code>l</code> 到 <code>r</code>为最新的无重复子串，更新 <code>maxLen</code>，将当前字符与下标放入<code>map</code> 中；</li>
<li>最后返回最长子串的长度 <code>maxLen</code>。</li>
</ol>
<p>代码实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLongestSubstring = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> maxLen = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> l = <span class="number">0</span>, r = <span class="number">0</span>; r &lt; s.<span class="property">length</span>; r++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (map.<span class="title function_">has</span>(s[r])) &#123;</span><br><span class="line">      l = <span class="title class_">Math</span>.<span class="title function_">max</span>(map.<span class="title function_">get</span>(s[r]) + <span class="number">1</span>, l);</span><br><span class="line">    &#125;</span><br><span class="line">    maxLen = <span class="title class_">Math</span>.<span class="title function_">max</span>(maxLen, r - l + <span class="number">1</span>);</span><br><span class="line">    map.<span class="title function_">set</span>(s[r], r);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> maxLen;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)</li>
<li>空间复杂度：O(n)</li>
</ul>
<h1 id="找到字符串中所有字母异位词"><a href="#找到字符串中所有字母异位词" class="headerlink" title="找到字符串中所有字母异位词"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-all-anagrams-in-a-string/description">找到字符串中所有字母异位词</a></h1><h2 id="方法一：滑动窗口"><a href="#方法一：滑动窗口" class="headerlink" title="方法一：滑动窗口"></a>方法一：滑动窗口</h2><p>基本的思路：</p>
<p>我们需要在字符串 s 寻找字符串 p 的异位符。因为是字符串 p 的异位符，那么她的长度一定与 p 是一样的，因此，我们可以在字符串 s 中构造一个长度为 p 的滑动窗口，并在滑动窗口中维护每种字母的数量；当窗口中每种字母的数量与字符串 p 中每种字母的数量相同时，则说明当前窗口为字符串 p 的异位词。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">s</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">p</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number[]</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> findAnagrams = <span class="keyword">function</span> (<span class="params">s, p</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> sLen = s.<span class="property">length</span>,</span><br><span class="line">    pLen = p.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (sLen &lt; pLen) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ans = [];</span><br><span class="line">  <span class="keyword">const</span> sCount = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">26</span>).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> pCount = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">26</span>).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pLen; i++) &#123;</span><br><span class="line">    ++sCount[s[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()];</span><br><span class="line">    ++pCount[p[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sCount.<span class="title function_">toString</span>() === pCount.<span class="title function_">toString</span>()) &#123;</span><br><span class="line">    ans.<span class="title function_">push</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sLen - pLen; ++i) &#123;</span><br><span class="line">    --sCount[s[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()];</span><br><span class="line">    ++sCount[s[i + pLen].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>(<span class="number">0</span>)];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sCount.<span class="title function_">toString</span>() === pCount.<span class="title function_">toString</span>()) &#123;</span><br><span class="line">      ans.<span class="title function_">push</span>(i + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="方法二：优化滑动窗口"><a href="#方法二：优化滑动窗口" class="headerlink" title="方法二：优化滑动窗口"></a>方法二：优化滑动窗口</h2><p>在方法一的基础上，我们不再分别统计滑动窗口和字符串 p 中每种字母的数量，而是统计滑动窗口和字符串 p 中每种字母数量的差；并引入变量 differ 来记录当前窗口与字符串 p 中数量不同的字母的个数，并在滑动窗口的过程中维护它。</p>
<p>在判断滑动窗口中每种字母的数量与字符串 p 中每种字母的数量是否相同时，只需要判断 differ 是否为零即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">s</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">p</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number[]</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> findAnagrams = <span class="keyword">function</span> (<span class="params">s, p</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> sLen = s.<span class="property">length</span>,</span><br><span class="line">    pLen = p.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (sLen &lt; pLen) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ans = [];</span><br><span class="line">  <span class="keyword">const</span> count = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">26</span>).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pLen; ++i) &#123;</span><br><span class="line">    ++count[s[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()];</span><br><span class="line">    --count[p[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> differ = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">26</span>; ++j) &#123;</span><br><span class="line">    <span class="keyword">if</span> (count[j] !== <span class="number">0</span>) &#123;</span><br><span class="line">      ++differ;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (differ === <span class="number">0</span>) &#123;</span><br><span class="line">    ans.<span class="title function_">push</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; sLen - pLen; ++i) &#123;</span><br><span class="line">    <span class="comment">// 窗口中字母s[i]的数量与字符串p中的数量从不同变得相同</span></span><br><span class="line">    <span class="keyword">if</span> (count[s[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>(<span class="number">0</span>)] === <span class="number">1</span>) &#123;</span><br><span class="line">      --differ;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 窗口中字母s[i]的数量与字符串p中的数量从相同变得不同</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count[s[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()] === <span class="number">0</span>) &#123;</span><br><span class="line">      ++differ;</span><br><span class="line">    &#125;</span><br><span class="line">    --count[s[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 窗口中字母s[i+pLen]的数量与字符串中的数量从不同变得相同</span></span><br><span class="line">    <span class="keyword">if</span> (count[s[i + pLen].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()] === -<span class="number">1</span>) &#123;</span><br><span class="line">      --differ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 窗口中字母s[i+pLen]的数量与字符串p中的数量从相同变得不同</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (count[s[i + pLen].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()] === <span class="number">0</span>) &#123;</span><br><span class="line">      ++differ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ++count[s[i + pLen].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">charCodeAt</span>()];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (differ === <span class="number">0</span>) &#123;</span><br><span class="line">      ans.<span class="title function_">push</span>(i + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>时间复杂度：O(n+m+Σ)，其中 n 是字符串 s 的长度，m 为字符串 p 的长度，其中 Σ 是所有可能的字符数。我们需要 O(m)来统计字符串 p 中每种字母的数量；需要 O(m)来初始化滑动窗口</p>
</li>
<li><p>空间复杂度：O(Σ)。用于存储滑动窗口和字符串 p 中每种字母数量的差。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/02/13/%E6%A0%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/02/13/%E6%A0%88/" class="post-title-link" itemprop="url">栈之经典案例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-02-13 19:49:34" itemprop="dateCreated datePublished" datetime="2024-02-13T19:49:34+08:00">2024-02-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-15 22:03:17" itemprop="dateModified" datetime="2024-02-15T22:03:17+08:00">2024-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="有效的括号"><a href="#有效的括号" class="headerlink" title="有效的括号"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/valid-parentheses/description">有效的括号</a></h2><h3 id="解题思路："><a href="#解题思路：" class="headerlink" title="解题思路："></a>解题思路：</h3><ol>
<li>判断有效括号可以先做一个特殊判断，因为括号都是成双成对的，因此，我们可以先判断括号字符串的长度，如果是基数，那么一定不是有效括号；</li>
<li>为了快速判断括号的类型，我可以先建立一个哈希表，哈希表的键为右括号，值为相同类型的左括号。</li>
<li>遍历给定的字符串，当我们遇到一个左括号，我们会希望在后续的遍历中遇到一个相同类型的右括号将其闭合。后面遇到的左括号需要先闭合，因此我们可以利用栈（先进后出），将这个左括号放入栈顶。</li>
<li>当我们遇到右括号，这时可以取出栈顶的左括号并判断是否是相同类型的，如果没有符合的左括号，说明是无效括号，返回 false。</li>
<li>在遍历结束后，如果栈中没有左括号了，说明我们将字符串 s 中的所有括号左括号都闭合了，返回 true，否则就返回 false。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isValid = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> n = s.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (n % <span class="number">2</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> pairs = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;(&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;[&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>],</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stk = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> ch <span class="keyword">of</span> s) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pairs.<span class="title function_">has</span>(ch)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!stk.<span class="property">length</span> || stk[stk.<span class="property">length</span> - <span class="number">1</span>] !== pairs.<span class="title function_">get</span>(ch)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(stk, <span class="string">&#x27;pppp&#x27;</span>);</span><br><span class="line">      stk.<span class="title function_">pop</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(stk, <span class="string">&#x27;0000&#x27;</span>);</span><br><span class="line">      stk.<span class="title function_">push</span>(ch);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> !stk.<span class="property">length</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)</li>
<li>空间复杂度： O(n)</li>
</ul>
<h2 id="最小栈"><a href="#最小栈" class="headerlink" title="最小栈"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/min-stack/description">最小栈</a></h2><h3 id="解题思路：-1"><a href="#解题思路：-1" class="headerlink" title="解题思路："></a>解题思路：</h3><p><strong>栈</strong>的特性是：只能对栈顶元素进行操作，因此我们需要创建两个栈：一个主栈（x_stack），一个辅助栈（min_stack），在每次查找时也顺便把目前栈中最小的元素记录，存放在辅助栈中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">MinStack</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x_stack</span> = [];</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">min_stack</span> = [<span class="title class_">Infinity</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">void</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">MinStack</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span> = <span class="keyword">function</span> (<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x_stack</span>.<span class="title function_">push</span>(val);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">min_stack</span>.<span class="title function_">push</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">this</span>.<span class="property">min_stack</span>[<span class="variable language_">this</span>.<span class="property">min_stack</span>.<span class="property">length</span> - <span class="number">1</span>], val));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">void</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">MinStack</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pop</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x_stack</span>.<span class="title function_">pop</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">min_stack</span>.<span class="title function_">pop</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">MinStack</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">top</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">x_stack</span>[<span class="variable language_">this</span>.<span class="property">x_stack</span>.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">MinStack</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getMin</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">min_stack</span>[<span class="variable language_">this</span>.<span class="property">min_stack</span>.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MinStack object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * var obj = new MinStack()</span></span><br><span class="line"><span class="comment"> * obj.push(val)</span></span><br><span class="line"><span class="comment"> * obj.pop()</span></span><br><span class="line"><span class="comment"> * var param_3 = obj.top()</span></span><br><span class="line"><span class="comment"> * var param_4 = obj.getMin()</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(1)</li>
<li>空间复杂度： O(n)</li>
</ul>
<h2 id="简化路径"><a href="#简化路径" class="headerlink" title="简化路径"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/simplify-path/description">简化路径</a></h2><p>此题要求简化路径的格式要遵循的原则：</p>
<blockquote>
<p>始终以斜杠 ‘&#x2F;‘ 开头。<br>两个目录名之间必须只有一个斜杠 ‘&#x2F;‘ 。<br>最后一个目录名（如果存在）不能 以 ‘&#x2F;‘ 结尾。<br>此外，路径仅包含从根目录到目标文件或目录的路径上的目录（即，不含 ‘.’ 或 ‘..’）。<br>返回简化后得到的 规范路径 。</p>
</blockquote>
<h3 id="解题思路：-2"><a href="#解题思路：-2" class="headerlink" title="解题思路："></a>解题思路：</h3><ol>
<li>利用 split 方法根据 “&#x2F;“ 将指定的字符串分割，转为数组字符串，该字符串可能含有”..”， “.”，正常的字符串；</li>
<li>如果遇到的字符串是”..”，那么我们需要先看看 stack 是否为空（pop 弹出栈），如果不空就先清空，因为”..”之前的字符都不需要计入规范路径中；</li>
<li>如果遇到的字符串不为”.”，那么我们需要将 name 压入栈中（push）；</li>
<li>最后遍历结束后，返回”&#x2F;“ + stack.join(“&#x2F;“)</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> simplifyPath = <span class="keyword">function</span> (<span class="params">path</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> names = path.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(names);</span><br><span class="line">  <span class="keyword">const</span> stack = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">of</span> names) &#123;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="string">&#x27;..&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (stack.<span class="property">length</span>) &#123;</span><br><span class="line">        stack.<span class="title function_">pop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.<span class="property">length</span> &amp;&amp; name !== <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">      stack.<span class="title function_">push</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;/&#x27;</span> + stack.<span class="title function_">join</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)</li>
<li>空间复杂度： O(n)</li>
</ul>
<h2 id="逆波兰表达式求值"><a href="#逆波兰表达式求值" class="headerlink" title="逆波兰表达式求值"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/evaluate-reverse-polish-notation/description">逆波兰表达式求值</a></h2><p>逆波兰表达式由波兰的逻辑学家路卡西维兹提出。<strong>逆波兰表达式的特点：</strong>没有括号，运算符总是放在和它相关的操作数之后。因此，逆波兰表达式也称为<strong>后缀表达式</strong>。</p>
<p>逆波兰表达式严格遵循「从左到右」的运算。刚好可以使用一个栈存储操作数，从左到右遍历逆波兰表达式，进行操作：</p>
<ul>
<li>如果遇到操作数，则将其入栈；</li>
<li>如果遇到运算符，则将两个操作数出栈，其中先出栈的是右操作数，后出栈的是左操作数，使用运算符对两个操作数进行运算，将运算得到的新操作数入栈。</li>
</ul>
<p>整个逆波兰表达式遍历结束后，栈内就只有一个元素，该元素就是逆波兰表达式的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> evalRPN = <span class="keyword">function</span> (<span class="params">tokens</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> stack = [];</span><br><span class="line">  <span class="keyword">const</span> n = tokens.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> token = tokens[i];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isNumber</span>(token)) &#123;</span><br><span class="line">      stack.<span class="title function_">push</span>(<span class="built_in">parseInt</span>(token));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> num2 = stack.<span class="title function_">pop</span>();</span><br><span class="line">      <span class="keyword">const</span> num1 = stack.<span class="title function_">pop</span>();</span><br><span class="line">      <span class="keyword">if</span> (token === <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">        stack.<span class="title function_">push</span>(num1 + num2);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (token === <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">        stack.<span class="title function_">push</span>(num1 - num2);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (token === <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">        stack.<span class="title function_">push</span>(num1 * num2);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (token === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        stack.<span class="title function_">push</span>(</span><br><span class="line">          num1 / num2 &gt; <span class="number">0</span> ? <span class="title class_">Math</span>.<span class="title function_">floor</span>(num1 / num2) : <span class="title class_">Math</span>.<span class="title function_">ceil</span>(num1 / num2)</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> stack.<span class="title function_">pop</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isNumber</span> = (<span class="params">token</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !(<span class="string">&#x27;+&#x27;</span> === token || <span class="string">&#x27;-&#x27;</span> === token || <span class="string">&#x27;*&#x27;</span> === token || <span class="string">&#x27;/&#x27;</span> === token);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)，其中 n 是数组 tokens 的长度。需要遍历数组 tokens 一次，计算逆波兰表达式的值。</li>
<li>空间复杂度：O(n)，其中 n 是数组 tokens 的长度，使用栈存储计算过程中的数，栈内元素个数不会超过逆波兰表达式的长度。</li>
</ul>
<h2 id="基本计算器"><a href="#基本计算器" class="headerlink" title="基本计算器"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/basic-calculator/description">基本计算器</a></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> calculate = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ops = [<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">let</span> sign = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> ret = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> n = s.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; n) &#123;</span><br><span class="line">    <span class="keyword">if</span> (s[i] === <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] === <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">      sign = ops[ops.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] === <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">      sign = -ops[ops.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] === <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">      ops.<span class="title function_">push</span>(sign);</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[i] === <span class="string">&#x27;)&#x27;</span>) &#123;</span><br><span class="line">      ops.<span class="title function_">pop</span>();</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (i &lt; n &amp;&amp; !<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(s[i])) &amp;&amp; s[i] !== <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">        num = num * <span class="number">10</span> + s[i].<span class="title function_">charCodeAt</span>() - <span class="string">&#x27;0&#x27;</span>.<span class="title function_">charCodeAt</span>();</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">      ret += sign * num;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)</li>
<li>空间复杂度： O(n)</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/01/30/webpack%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E8%BF%9B%E9%98%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/01/30/webpack%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E8%BF%9B%E9%98%B6/" class="post-title-link" itemprop="url">webpack原理以及进阶</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-30 22:08:23" itemprop="dateCreated datePublished" datetime="2024-01-30T22:08:23+08:00">2024-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-28 16:06:29" itemprop="dateModified" datetime="2024-02-28T16:06:29+08:00">2024-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/Webpack%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">Webpack源码</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>本文的项目链接： <a target="_blank" rel="noopener" href="https://github.com/Kelly-kml/kelly-webpack-test">https://github.com/Kelly-kml/kelly-webpack-test</a></strong></p>
<p>本文我们通过自己搭建一个测试 <code>demo</code> 来实现对 <code>webpack</code> 一些基本配置以及进阶优化功能的练手以及测试,建议读者跟着文章自己手操作一遍，并且要保持版本的一致。</p>
<h2 id="1-初始化项目："><a href="#1-初始化项目：" class="headerlink" title="1. 初始化项目："></a>1. 初始化项目：</h2><p>使用 <code>npm init -y</code> 进行初始化</p>
<p>要使用 webpack，那么就得安装 webpack、webpacl-cli</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli -D</span><br></pre></td></tr></table></figure>

<p>本文使用的版本号为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├── webpack@<span class="number">5.89</span><span class="number">.0</span></span><br><span class="line">└── webpack-cli@<span class="number">5.1</span><span class="number">.4</span></span><br><span class="line">└── node@v18<span class="number">.16</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

<p>从 webpack V4.0 开始，webpack 就是开箱机用的，因此，接下来我们可以直接利用一个入口文件来尝试一下。</p>
<p>新建 src&#x2F;index.js 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getString</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">helloWorld</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> str = <span class="keyword">await</span> <span class="title function_">getString</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> helloWorld;</span><br></pre></td></tr></table></figure>

<p>使用 <code>npx webpack --mode=development</code> 进行构建，默认是 <code>production</code> 模式，我们为了更清楚得查看打包后的代码，使用 <code>development</code> 模式。</p>
<p>构建完成之后，会在项目下产生一个 <code>disk</code> 目录，里面有一个打包文件：main.js</p>
<p>查看 <code>main.js</code> 文件，可以看到：<code>index.js</code> 并没有被转义为低版本的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// webpackBootstrap</span></span><br><span class="line">  <span class="comment">/******/</span> <span class="keyword">var</span> __webpack_modules__ = &#123;</span><br><span class="line">    <span class="comment">/***/</span> <span class="string">&#x27;./src/index.js&#x27;</span>:</span><br><span class="line">      <span class="comment">/*!**********************!*\</span></span><br><span class="line"><span class="comment">  !*** ./src/index.js ***!</span></span><br><span class="line"><span class="comment">  \**********************/</span></span><br><span class="line">      <span class="comment">/***/</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">eval</span>(</span><br><span class="line">          <span class="string">&quot;/*\r\n * @Description: \r\n * @author: kelly\r\n * @Date: 2024-01-18 23:38:32\r\n * @LastEditTime: 2024-01-19 10:13:51\r\n */\r\n//index.js\r\nclass Person &#123;\r\n  constructor(name) &#123;\r\n    this.name = name;\r\n  &#125;\r\n  getName () &#123;\r\n    return this.name;\r\n  &#125;\r\n&#125;\r\n\r\nconst student = new Person(&#x27;kelly&#x27;);\r\n\r\n\n\n//# sourceURL=webpack://webpack_basic/./src/index.js?&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/***/</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/******/</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">/******/</span> <span class="keyword">var</span> __webpack_exports__ = &#123;&#125;;</span><br><span class="line">  <span class="comment">/******/</span> __webpack_modules__[<span class="string">&#x27;./src/index.js&#x27;</span>]();</span><br><span class="line">  <span class="comment">/******/</span></span><br><span class="line">  <span class="comment">/******/</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h2 id="2-将-JS-转义为低版本"><a href="#2-将-JS-转义为低版本" class="headerlink" title="2. 将 JS 转义为低版本"></a>2. 将 JS 转义为低版本</h2><p>这时，我们前面讲的 webpack 的核心 <code>loader</code> 就得派上场啦</p>
<p>我们可以利用 <code>babel-loader</code> 来实现将 JS 转义为低版本。</p>
<p>首先我先安装 <code>babel-loader</code></p>
<ul>
<li><code>babel-loader</code> 在 webpack 用来解析 ES6</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader -D</span><br></pre></td></tr></table></figure>

<p>此外，我们还需要配置 babel 的依赖包：</p>
<ul>
<li><code>@babel/core</code> babel 核心模块</li>
<li><code>@babel/preset-env</code> babel 预设 一组 babel 插件的集合</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel/core @babel/preset-env -D</span><br></pre></td></tr></table></figure>

<p>接下来在 <code>webpack.config.js</code> 配置 rules:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="comment">//设置模块</span></span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    <span class="comment">//设置loader</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="comment">//已作为js扩展名这样类型的文件</span></span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">//排除node_modules文件夹</span></span><br><span class="line">      <span class="attr">use</span>: &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>, <span class="comment">//转换成es5</span></span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>], <span class="comment">//设置编译的规则</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这样子直接打包会失败，因为目前解析不了 ES6 中的 async&#x2F; await 语法。</p>
<p>我们需要给安装插件 <code>regeneratorRuntime</code></p>
<ul>
<li><code>regeneratorRuntime</code> 是 webpack 打包生成的全局辅助函数</li>
<li>由 babel 生成 用于兼容 <code>async/await</code> 的语法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel/runtime -D <span class="comment">// 包含了regeneratorRuntime运行时候需要的内容</span></span><br><span class="line">npm i @babel/plugin-transform-runtime <span class="comment">// 这个插件在需要regeneratorRuntime的地方自动导入包 就是在需要的时候会自动运行他</span></span><br></pre></td></tr></table></figure>

<p>响应地，在 babel 中 的 rules 也新增 plugin 的配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">test</span>:<span class="regexp">/\.js$/</span>, <span class="comment">//已作为js扩展名这样类型的文件</span></span><br><span class="line">   <span class="attr">exclude</span>:<span class="regexp">/node_modules/</span>, <span class="comment">//排除node_modules文件夹</span></span><br><span class="line">   <span class="attr">use</span>:&#123;</span><br><span class="line">     <span class="attr">loader</span>:<span class="string">&#x27;babel-loader&#x27;</span>, <span class="comment">//转换成es5</span></span><br><span class="line">     <span class="attr">options</span>:&#123;</span><br><span class="line">       <span class="attr">presets</span>:[<span class="string">&#x27;@babel/preset-env&#x27;</span>], <span class="comment">//设置编译的规则</span></span><br><span class="line">       <span class="attr">plugins</span>:[ <span class="comment">// 设置编译的插件</span></span><br><span class="line">         [<span class="string">&#x27;@babel/plugin-transform-runtime&#x27;</span>] <span class="comment">//设置编译的规则</span></span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-构建打包"><a href="#3-构建打包" class="headerlink" title="3. 构建打包"></a>3. 构建打包</h2><p>此时，运行 <code>npx webpack </code> 构建就可以成功完成打包了。</p>
<p><img src="https://s2.loli.net/2024/02/01/kft523UESrOncMZ.png" alt="19a05ae4124d4691027172239364d88.png"></p>
<p>紧接着，可以在 dist&#x2F;bundle.js 可以看到：src&#x2F;index.js 中的代码成功地转为 ES5。</p>
<p><img src="https://s2.loli.net/2024/02/01/aJrnz9UPlxehcg3.png" alt="c701a0a0d10ad03b69ea77eeafd3c8b.png"></p>
<p>项目进行到目前为止，我们就搭建好了 webpack 基本的构建打包配置了。</p>
<p>接下来，我们就可以根据项目开发中的情况来进行某些特定场景的配置啦 ！</p>
<h2 id="4-管理输出："><a href="#4-管理输出：" class="headerlink" title="4.管理输出："></a>4.管理输出：</h2><h3 id="（1）多入口设置："><a href="#（1）多入口设置：" class="headerlink" title="（1）多入口设置："></a>（1）多入口设置：</h3><p>我们知道 webpack 可以利用 <code>entry</code> 设置多入口起点，那么具体是怎么设置的呢？</p>
<ul>
<li>先在 src 文件夹下新建一个新的文件 <code>print.js</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">printMe</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I get called from print.js!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>并在 <code>src/index.js</code> 文件中使用这个函数：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> printMe <span class="keyword">from</span> <span class="string">&#x27;./print&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getString</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">helloWorld</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  btn.<span class="property">innerHTML</span> = <span class="string">&#x27;Click me and check the console!&#x27;</span>;</span><br><span class="line">  btn.<span class="property">onclick</span> = printMe;</span><br><span class="line">  element.<span class="title function_">appendChild</span>(btn);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> str = <span class="keyword">await</span> <span class="title function_">getString</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> helloWorld;</span><br></pre></td></tr></table></figure>

<ul>
<li>更新 <code>dist/index.html</code> 文件，为 webpack 分离入口文件做好准备：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>资源管理<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./print.bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>调整 <code>entry</code> 配置：在 entry 添加 <code>src/print.js</code> 作为新的入口起点（命名为 <code>print</code>），然后修改 output 使得能够根据入口起点定义的名称动态生成 bundle 名称。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">index</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">print</span>: <span class="string">&#x27;./src/print.js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>重新构建，会看到在 <code>dist</code> 文件夹下生成两个新的 bundle.js 文件。</li>
</ul>
<h3 id="（2）HtmlWebpackPlugin"><a href="#（2）HtmlWebpackPlugin" class="headerlink" title="（2）HtmlWebpackPlugin"></a>（2）<code>HtmlWebpackPlugin</code></h3><p>不过这也产生了新的问题，如果我们更改起点的名称，在构建时就会出现新的 bundle，而 index.html 仍然在引用旧的名称，这导致了 dist 文件夹下生成非常多 bundle，乍一看就很乱。</p>
<p>后来，我们可以使用 <code>HtmlWebpackPlugin</code> 插件解决这个问题。</p>
<p><code>HtmlWebpackPlugin</code> 可以简化 HTML 文件的创建，每次 webpack 进行构建可以整合全部的 bundle 文件存于 index.html，每个 bundle 用 Hash 值形成一个映射关系，而且每次构建生成的 index.html 会替换旧 index.html。</p>
<p><em>插件细节可以查看相关<a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin">源码</a>。</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>

<p>重新构建后，会发现：<strong>代码编辑器中打开 <code>index.html</code> 会发现 <code>HtmlWebpackPlugin</code> 创建了一个全新的文件，而所有的 bundle 都已自动添加到其中</strong>。</p>
<p>相应地，在 <code>webpack.config.js</code> 中配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;管理输出&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>需要注意，在执行构建之前，虽然在 <code>dist/</code> 文件夹已经有了自定义的 <code>index.html</code> 文件，但是 <code>HtmlWebpackPlugin</code> 插件仍然会默认生成 <code>index.html</code> 文件，即使用新生成的 <code>index.html</code> 文件替换原有文件。</p>
<p>不知道你有没有注意到： dist&#x2F; 文件夹下的文件就会很多，新旧产生的都混在一起，我们无法清晰知道最近一次构建的情况，因此，我们可以利用 <code>clean: true,</code> 这个 <code>output</code> 配置来清楚旧 bundle 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="（3）webpack-manifest-plugin"><a href="#（3）webpack-manifest-plugin" class="headerlink" title="（3）webpack-manifest-plugin"></a>（3）<code>webpack-manifest-plugin</code></h3><p>这是一个用于生成 webpack 构建资产清单的插件，webpack 通过 manifest 追踪所有模块到输出的 bundle 之间的映射。**详细配置细节可查看<a target="_blank" rel="noopener" href="https://github.com/shellscape/webpack-manifest-plugin">源码</a>**。</p>
<ul>
<li>安装：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-manifest-plugin --save-dev</span><br></pre></td></tr></table></figure>

<ul>
<li>在 <code>webpack.config.js</code> 中配置：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">WebpackManifestPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;webpack-manifest-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">WebpackManifestPlugin</span>(), <span class="comment">// 可以接受一个options 参数，默认在dist目录下生成 manifest.json</span></span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>重新打包，可以看见 dist 目录新生成了一个 manifest.json。</p>
<h2 id="5-开发环境设置"><a href="#5-开发环境设置" class="headerlink" title="5. 开发环境设置"></a>5. 开发环境设置</h2><h3 id="（1）Source-map："><a href="#（1）Source-map：" class="headerlink" title="（1）Source map："></a>（1）Source map：</h3><p>Source map 本质上是一个信息文件，记录了转换压缩后的代码所对应的转换前的源码位置，是源代码和生产代码的映射。Source map 解决了在打包过程中，代码经过压缩，去空格以及 babel 编译转化后，由于代码之间差异性过大，造成无法 debug 的问题。</p>
<p>Source map 的作用就是能够让浏览器的调试面版将生成后的代码映射到源码文件当中，开发者可以在源码文件中 debug，这样就会让程序员调试轻松、简单很多。</p>
<p>options 种类很多<a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/devtool">【点击查看更多】</a>，在生产环境下可以用 <code> peocess.env</code> 判断一下。webpack 中可以在 devtool 中设置，</p>
<ul>
<li>在开发环境中可以配置 <code>devtool: cheap-module-source-map</code> ，方便调试。</li>
<li>生产环境下建议采用<code>devtool: none</code> 或者 <code>devtool: nosources-source-map</code> ，这样子既可以定位源码位置，又可以不暴露源码。</li>
</ul>
<h3 id="（2）服务启动工具："><a href="#（2）服务启动工具：" class="headerlink" title="（2）服务启动工具："></a>（2）服务启动工具：</h3><ul>
<li><h3 id="使用-webpack-dev-server"><a href="#使用-webpack-dev-server" class="headerlink" title="使用 webpack-dev-server"></a>使用 webpack-dev-server</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-dev-server</span><br></pre></td></tr></table></figure>

<p>接下来修改配置文件 <code>webpack.config.js</code> ，告诉 dev server 应从什么位置开始查找文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">+	<span class="attr">devServer</span>: &#123;</span><br><span class="line">+   	<span class="attr">static</span>: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">+  	&#125;,</span><br><span class="line">+    <span class="attr">optimization</span>: &#123;</span><br><span class="line">+        <span class="attr">runtimeChunk</span>: <span class="string">&#x27;single&#x27;</span>,</span><br><span class="line">+    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上配置告知 <code>webpack-dev-server</code> 将 <code>dist</code> 目录下的文件作为可访问资源部署在 <code>localhost:8080</code></p>
</li>
<li><h4 id="使用-webpack-dev-middleware：模块热替换"><a href="#使用-webpack-dev-middleware：模块热替换" class="headerlink" title="使用 webpack-dev-middleware：模块热替换"></a>使用 webpack-dev-middleware：模块热替换</h4><p>webapck-dev-middleware 是一个包装器，它可以把 webpack 处理过的文件发送到 server。这是 webpack-dev-server 内部的原理，但是它也可以作为一个单独的包使用，以便根据需求进行更多自定义设置。下面是一个 webpack-dev-middleware 配合 express server 的示例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev express webpack-dev-middleware</span><br></pre></td></tr></table></figure>

<p>现在调整 webpack 配置文件，以确保能够正确启用中间件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">   <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">   <span class="attr">entry</span>: &#123;</span><br><span class="line">     <span class="attr">index</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">     <span class="attr">print</span>: <span class="string">&#x27;./src/print.js&#x27;</span>,</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">devtool</span>: <span class="string">&#x27;inline-source-map&#x27;</span>,</span><br><span class="line">   <span class="attr">devServer</span>: &#123;</span><br><span class="line">     <span class="attr">static</span>: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">plugins</span>: [</span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">       <span class="attr">title</span>: <span class="string">&#x27;Development&#x27;</span>,</span><br><span class="line">     &#125;),</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">output</span>: &#123;</span><br><span class="line">     <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">     <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">     <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line"> +   <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>

<p>在 server 脚本使用 publicPath，以确保文件资源能够作为可访问资源正确部署在 <code>http://localhost:3000</code>， 接下来设置自定义 <code>express</code> server：</p>
<p><strong>project</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">webpack-demo</span><br><span class="line">  |- package.json</span><br><span class="line">  |- package-lock.json</span><br><span class="line">  |- webpack.config.js</span><br><span class="line">  |- server.js(++++)</span><br><span class="line">  |- /dist</span><br><span class="line">  |- /src</span><br><span class="line">    |- index.js</span><br><span class="line">    |- print.js</span><br><span class="line">  |- /node_modules</span><br></pre></td></tr></table></figure>

<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">&#x27;webpack-dev-middleware&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> compiler = <span class="title function_">webpack</span>(config);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 告知 express 使用 webpack-dev-middleware，</span></span><br><span class="line"><span class="comment">// 以及将 webpack.config.js 配置文件作为基础配置。</span></span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="title function_">webpackDevMiddleware</span>(compiler, &#123;</span><br><span class="line">    <span class="attr">publicPath</span>: config.<span class="property">output</span>.<span class="property">publicPath</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将文件 serve 到 port 3000。</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Example app listening on port 3000!\n&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>package.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack5_demo&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;watch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack serve --open&quot;</span><span class="punctuation">,</span></span><br><span class="line">+   <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node server.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@babel/core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.23.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@babel/preset-env&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.23.8&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@babel/runtime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.23.8&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;babel-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^9.1.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;css-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.9.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;express&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.18.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;html-webpack-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.5.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;style-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.3.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webpack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.89.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webpack-cli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.1.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webpack-dev-middleware&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webpack-dev-server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.15.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;webpack-manifest-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;xml-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.2.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@babel/plugin-transform-runtime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.23.7&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lodash&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.17.21&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>打开浏览器，访问 <code>http://localhost:3000</code>，应该看到 webpack 应用程序已经运行！</p>
</li>
</ul>
<h2 id="6-代码分离："><a href="#6-代码分离：" class="headerlink" title="6. 代码分离："></a>6. 代码分离：</h2><h3 id="（1）SplitChunksPlugin-：防止重复"><a href="#（1）SplitChunksPlugin-：防止重复" class="headerlink" title="（1）SplitChunksPlugin ：防止重复"></a>（1）<code>SplitChunksPlugin </code>：防止重复</h3><p><code>SplitChunkPlugin</code> 插件可以将公共的依赖模块提取到已有的入口 chunk 中，或者提取到一个新生成的 chunk。</p>
<p>使用这个插件去除之前示例中重复的 <code>lodash</code> 模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">      <span class="attr">index</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">      <span class="attr">another</span>: <span class="string">&#x27;./src/another-module.js&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">      <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">+   <span class="attr">optimization</span>: &#123;</span><br><span class="line">+     <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">+       <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">+     &#125;,</span><br><span class="line">+   &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>使用 <a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/split-chunks-plugin/#optimizationsplitchunks"><code>optimization.splitChunks</code></a> 配置选项后构建，将会发现 <code>index.bundle.js</code> 和 <code>print.bundle.js</code> 已经移除了重复的依赖模块。从插件将 <code>lodash</code> 分离到单独的 chunk，并且将其从 main bundle 中移除，减轻了 bundle 大小。</p>
<h3 id="（2）mini-css-extract-plugin：用于将-CSS-从主应用程序中分离"><a href="#（2）mini-css-extract-plugin：用于将-CSS-从主应用程序中分离" class="headerlink" title="（2）mini-css-extract-plugin：用于将 CSS 从主应用程序中分离"></a>（2）<a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/mini-css-extract-plugin"><code>mini-css-extract-plugin</code></a>：用于将 CSS 从主应用程序中分离</h3><h3 id="（3）分析-bundle："><a href="#（3）分析-bundle：" class="headerlink" title="（3）分析 bundle："></a>（3）分析 bundle：</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://alexkuz.github.io/webpack-chart/">webpack-chart</a>：webpack stats 可交互饼图。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://chrisbateman.github.io/webpack-visualizer/">webpack-visualizer</a>：分析并可视化 bundle，检查哪些模块占用空间，哪些可能是重复使用的。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/webpack-bundle-analyzer">webpack-bundle-analyzer</a>：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式，实现可视化 webpack 输出文件的大小。</p>
<p>修改 webpack 配置文件，可以生成一个 bundle 模块大小分析的 html 页面：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">BundleAnalyzerPlugin</span> =</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>).<span class="property">BundleAnalyzerPlugin</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugin</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">BundleAnalyzerPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">analyzerMode</span>: <span class="string">&#x27;server&#x27;</span>,</span><br><span class="line">      <span class="attr">analyzerHost</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">      <span class="attr">analyzerPort</span>: <span class="number">3001</span>,</span><br><span class="line">      <span class="attr">reportFilename</span>: <span class="string">&#x27;report.html&#x27;</span>,</span><br><span class="line">      <span class="attr">defaultSizes</span>: <span class="string">&#x27;parsed&#x27;</span>,</span><br><span class="line">      <span class="attr">openAnalyzer</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">generateStatsFile</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">statsFilename</span>: <span class="string">&#x27;stats.json&#x27;</span>,</span><br><span class="line">      <span class="attr">statsOptions</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">logLevel</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\ADMINI~1\AppData\Local\Temp\1705829404271.png" alt="70582940427"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://webpack.jakoblind.no/optimize">webpack bundle optimize helper</a>：这个工具会分析 bundle，并提供可操作的改进措施，以减少 bundle 的大小。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/bundle-stats/bundle-stats">bundle-stats</a>：生成一个 bundle 报告（bundle 大小、资源、模块），并比较不同构建之间的结果。</p>
</li>
</ul>
<h2 id="7-模块热替换（Hot-module-replacement）"><a href="#7-模块热替换（Hot-module-replacement）" class="headerlink" title="7. 模块热替换（Hot module replacement）"></a>7. 模块热替换（Hot module replacement）</h2><p>模块热替换（HMR）功能会在应用程序运行过程中，替换、添加或者删除模块，而无需重新加载整个页面。</p>
<p>在 <code>webpack</code> 中配置开启模块也非常简单那，如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// HMR</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// hotOnly: true</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>通过上面的这种配置，如果我们修改并保存 CSS 文件，确实能够与以不刷新的形式更新到页面中。但是，当我们修改并保存 JS 文件之后，页面依旧自动刷新，这里并没有触发热模块。所以，<code>HMR</code> 并不像 <code>webpack</code> 的其他特性一样开箱即用，需要有一些额外地制定和某些模块发生更新时进行<code>HMR</code>，如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">hot</span>) &#123;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&#x27;./util.js&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;util.js更新了&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>警告：HMR 绝对不能被用在生产环境。</em></strong></p>
<p>主要是通过以下几种方式，来提高开发速度：</p>
<ul>
<li>保留在完全重新加载页面期间丢失的应用程序状态</li>
<li>只更新变更的内容，以节省宝贵的开发时间</li>
<li>在源代码中 CSS&#x2F;JS 产生修改时，会立刻在浏览器中进行更新，这几乎相当于在浏览器 devtools 直接更改样式</li>
</ul>
<p><strong>这一切是怎么运行的呢？或者说ＨＭＲ的工作原理是什么样子？</strong></p>
<p>（１）在应用程序中通过<strong>置换模块</strong>实现：</p>
<p>ａ．应用程序要求 HMR runtime 检查更新</p>
<p>b . HMR runtime 异步下载更新，然后通知应用程序</p>
<p>c . 应用程序要求 HMR runtime 应该更新</p>
<p>d . HMR runtime 同步应用更新</p>
<p>这里我们可以设置 HMR ，以使此进程自动触发更新，或者你可以选择要求在用户交互时进行更新。</p>
<p>（2）在 compiler 中：</p>
<p>除了普通资源，compiler 需要发出“update”，将之前的版本更新到最新的版本。”update”由 2 部分组成：</p>
<p>a . 更新后的 manifest（JSON）【manifest 跟踪所有模块与打包 bundle 之间的一种 hash 映射】</p>
<p>b . 一个或者多个 update chunk（JS）</p>
<p><strong>manifest</strong> 包括新的 compilation hash 和所有的 updated chunk 列表。每个 chunk 都包含着全部更新模块的最新代码（或一个 flag 用于表明此模块需要被移除）。</p>
<p><strong>compiler</strong> 会确保在这些构建之间的模块 ID 和 chunk ID 保持一致。通常将这些 ID 存储在内存中（例如，使用 <a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server/">webpack-dev-server</a> 时），但是也可能会将它们存储在一个 JSON 文件中。</p>
<p>（3）在模块中：</p>
<p>HMR 是可选功能，只会影响包含 HMR 代码的模块。举个例子，通过 <a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/style-loader"><code>style-loader</code></a> 为 style 追加补丁。为了运行追加补丁，<code>style-loader</code> 实现了 HMR 接口；当它通过 HMR 接收到更新，它会使用新的样式替换旧的样式。</p>
<p>类似的，当在一个模块中实现了 HMR 接口，你可以描述出当模块被更新后发生了什么。然而在多数情况下，不需要在每个模块中强行写入 HMR 代码。如果一个模块没有 HMR 处理函数，更新就会冒泡(bubble up)。这意味着某个单独处理函数能够更新整个模块树。如果在模块树的一个单独模块被更新，那么整组依赖模块都会被重新加载。</p>
<p>（4）在 runtime 中：</p>
<p>对于模块系统运行时(module system runtime)，会发出额外代码，来跟踪模块 <code>parents</code> 和 <code>children</code> 关系。在管理方面，runtime 支持两个方法 <code>check</code> 和 <code>apply</code>。</p>
<p><strong><code>check</code> 方法， 用来下载最新模块代码。</strong></p>
<p>具体步骤：</p>
<p>发送一个 Http 请求来更新 manifest 。如果请求失败，说明没有可用更新。如果请求成功，那么会将 updateed chunk 列表与当前的 loaded chunk 列表进行比较。每个 loaded chunk 都会下载响应的 updated chunk。当所有更新 chunk 完成下载，runtime 就会切换到 ready 状态。</p>
<p><strong><code>apply</code> 方法， 用于更新模块，主要将要更新的模块打上 tag，然后调用模块的（也有可能是父模块）的更新 handler 执行更新。</strong></p>
<p>具体步骤：</p>
<ol>
<li>将所有 updated modules 标记为 无效。对于每个无效 module，都需要在模块中有一个 update handler ，或者在此模块的父级模块中有 update handler。否则，会进行无效标记冒泡，并且父级也会被标记为无效。继续每个冒泡，直到到达应用程序入口起点，或者到达带有 update handler 的 module（以最先到达为准，冒泡停止）。如果它从入口起点开始冒泡，则此过程失败。</li>
<li>所有无效 module 都会被（通过 dispose handler）处理和解除加载。然后更新当前 hash，并且调用所有 <code>accept</code> handler。runtime 切换回 <code>idle</code> 状态，一切照常继续。</li>
</ol>
<p><strong>HRM 更新的总结：</strong></p>
<ul>
<li>通过<code>webpack-dev-server</code>创建两个服务器：提供静态资源的服务（express）和 Socket 服务</li>
<li>express server 负责直接提供静态资源的服务（打包后的资源直接被浏览器请求和解析）</li>
<li>socket server 是一个 websocket 的长连接，双方可以通信</li>
<li>当 socket server 监听到对应的模块发生变化时，会生成两个文件<code>.json</code>(manifest 文件)和<code>.js</code>文件(update chunk)</li>
<li>通过长连接，socket server 可以直接将这两个文件主动发送给客户端（浏览器）</li>
<li>浏览器拿到两个新文件后，通过 HMR runtime 机制，加载这两个文件，并且针对修改的模块进行更新</li>
</ul>
<h2 id="8-Tree-shaking："><a href="#8-Tree-shaking：" class="headerlink" title="8. Tree-shaking："></a>8. <a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/tree-shaking/">Tree-shaking</a>：</h2><h3 id="（1）对于-Tree-shaking-是怎么理解的？"><a href="#（1）对于-Tree-shaking-是怎么理解的？" class="headerlink" title="（1）对于 Tree-shaking 是怎么理解的？"></a>（1）对于 Tree-shaking 是怎么理解的？</h3><p><strong>tree shaking</strong> 是一种基于 ES Module 规范的 Dead Code Elimination 技术，通常用于描述移除 JavaScript 上下文中的死代码（不使用的代码）。具体是通过在运行过程中静态分析模块之间的导入导出，确定 ESM 模块中哪些导出值未曾被其他模块使用过，并将其删除，以此实现打包产物的优化。</p>
<p>我们打一个形象的比方：将应用程序想象成一棵树。绿色表示实际用到的源码和库，是树上活的树叶。灰色表示未引用代码，是秋天树上枯萎的树叶。为了除去死去的树叶，你必须摇动（shake）这棵树，使它们落下。</p>
<h3 id="（2）实现原理："><a href="#（2）实现原理：" class="headerlink" title="（2）实现原理："></a>（2）实现原理：</h3><p>Webapck 中， Tree-shaking 的实现的关键是：</p>
<ul>
<li>标记出模块导出值中哪些没有被用过；</li>
<li>使用 Terser 删掉这些没有被用过的导出语句。</li>
</ul>
<p>Tree-shaking 过程大致分为四步：</p>
<blockquote>
<p>标记功能需要配置 <code>optimization.usedExports = true</code> 开启</p>
</blockquote>
<p>1）Make 阶段：在 <code>FlagDependencyExportsPlugin</code> 插件中根据模块的 <code>dependencies</code> 列表，收集模块导出变量并记录到模块依赖关系图 ModuleGraph 体系的 exportsInfo 变量中</p>
<p>2）Seal 阶段： 利用 <code>FlagDependencyUsagePlugin</code> 插件，遍历 ModuleGraph 标记模块导出变量，然后收集模块的导出值的使用情况，并记录到 <code>exportInfo._usedInRuntime</code> 集合中</p>
<p>3）生成产物阶段：在 <code>HarmonyExportXXXDependency.Template.apply</code> 方法中根据导出值的使用情况生成不同的导出语句，若变量没有被其它模块使用过则删除对应的导出语句</p>
<p>4）删除阶段：使用 DCE 工具删除 Dead Code，实现完整的树摇效果</p>
<h2 id="9-Plugin"><a href="#9-Plugin" class="headerlink" title="9.Plugin"></a>9.Plugin</h2><h3 id="9-1-常见的-Plugin："><a href="#9-1-常见的-Plugin：" class="headerlink" title="9.1. 常见的 Plugin："></a>9.1. 常见的 Plugin：</h3><table>
<thead>
<tr>
<th>plugin 名称</th>
<th>功能特性</th>
</tr>
</thead>
<tbody><tr>
<td>AggressiveSplittingPlugin</td>
<td>将原来的 chunk 分为更小的 chunk</td>
</tr>
<tr>
<td>BabelMinifyWebpackPlugin</td>
<td>使用 babel-minify 进行压缩</td>
</tr>
<tr>
<td>BannerPlugin</td>
<td>在每个生成的 chunk 顶部添加 banner</td>
</tr>
<tr>
<td>CommonsChunkPlugin</td>
<td>提取 chunks 之间共享的通用模块</td>
</tr>
<tr>
<td>CompressionWebpackPlugin</td>
<td>预先准备的资源压缩版本，使用 Content-EnCoding 提供访问的服务</td>
</tr>
<tr>
<td>CleanWebpackPlugin</td>
<td>删除（清理）构建目录</td>
</tr>
<tr>
<td>ContextReplacementPlugin</td>
<td>重写 require 表达式的推断上下文</td>
</tr>
<tr>
<td>CopyWebpackPlugin</td>
<td>将单个文件或者整个目录复制到构建目录</td>
</tr>
<tr>
<td>DefinePlugin</td>
<td>允许在编译时（compiler time）配置的全局常量</td>
</tr>
<tr>
<td>DLLPlugin</td>
<td>为了极大减少构建时间，进行分离打包</td>
</tr>
<tr>
<td>EnvironmentPlugin</td>
<td>DefinePlugin 中 process.env 键的简写方式</td>
</tr>
<tr>
<td>ExtractTextWebpackPlugin</td>
<td>从 bundle 中提取文本（CSS）到单独的文件中</td>
</tr>
<tr>
<td>HotModuleReplacementPlugin</td>
<td>启动模块热替换（HMR）</td>
</tr>
<tr>
<td>HtmlWebpackPlugin</td>
<td>简单创建 HTML 文件，用于服务器访问</td>
</tr>
<tr>
<td>IgnorePlugin</td>
<td>从 bundle 中排除某些板块</td>
</tr>
<tr>
<td>LimitChunkCountPlugin</td>
<td>设置 chunk 的最小、最大限制，以微调和控制 chunk</td>
</tr>
<tr>
<td>MiniChunkSizePlugin</td>
<td>确保 chunk 大小不超过指定限制</td>
</tr>
<tr>
<td>MiniCssExtractPlugin</td>
<td>提取 CSS 到一个单独文件中</td>
</tr>
<tr>
<td>NoEmitOnErrorsPlugin</td>
<td>在输出阶段时，遇到编译错误跳过</td>
</tr>
<tr>
<td>NormalModuleReplacePlugin</td>
<td>替换与正则表达式匹配的资源</td>
</tr>
</tbody></table>
<h3 id="9-2-手写一个-plugin"><a href="#9-2-手写一个-plugin" class="headerlink" title="9.2. 手写一个 plugin:"></a>9.2. 手写一个 plugin:</h3><h4 id="9-2-1-从-html-webpack-plugin-源码中了解一个-plugin-的基本结构："><a href="#9-2-1-从-html-webpack-plugin-源码中了解一个-plugin-的基本结构：" class="headerlink" title="9.2.1. 从 html-webpack-plugin 源码中了解一个 plugin 的基本结构："></a>9.2.1. 从 html-webpack-plugin 源码中了解一个 plugin 的基本结构：</h4><p><img src="https://s2.loli.net/2024/02/01/Ecjmr4ANixML6wK.png" alt="a4fd0df4f28ef2849cd232f511013fb.png"></p>
<p><img src="https://s2.loli.net/2024/02/01/5gyhrTGeKCajDXd.png" alt="cb711427a9240e1c21cb8de26ba875a.png"></p>
<p>源码中，使用的是 Class 类的方式来书写插件 <code>html-webpack-plugin</code> ，我们将一个功能性的函数缩起来，可以清晰得看到，其实，插件就是一个 apply() 的 Javascript 代码，在 apply() 中传入参数 compiler，然后我们可以在 compiler 对象上绑定一些 hooks 实现订阅，当监听到响应的 hooks 时，就会执行相应的插件来干预 webpack 的执行结果，达到实现某种特定功能的拓展效果。</p>
<h4 id="9-2-2-如何编写一个自己的-Plugin："><a href="#9-2-2-如何编写一个自己的-Plugin：" class="headerlink" title="9.2.2. 如何编写一个自己的 Plugin："></a>9.2.2. 如何编写一个自己的 Plugin：</h4><p>由于<code>webpack</code>基于发布订阅模式，在运行的生命周期中会广播出许多事件，插件通过简听这些事件，就可以在特定阶段执行自己的插件任务。</p>
<p>在这之前，我们也了解过，<code>webpack</code>编译会创建 2 个核心对象：</p>
<ul>
<li><p><code>compiler</code>：包含了<code>webpack</code>环境的所有的配置信息，包含<code>options</code>,<code>loader</code>,<code>plugin</code>和 webpack 整个生命周期中相关的钩子。</p>
</li>
<li><p><code>compilation</code>：作为<code>plugin</code>内置事件回调函数的参数，包含了当前的模块资源、变化的文件以及被跟踪依赖的状态信息。当检测到一个文件变化，一次新的 Compilation 将被创建。</p>
</li>
</ul>
<p>如果要自己手写<code>plugin</code>，也需要遵循一定的规范：</p>
<ul>
<li><p>插件必须是一个函数或者是一个包含着<code>apply</code>方法的对象，这样才能访问<code>compiler</code>实例；</p>
</li>
<li><p>传给每个插件的 compiler 和 compilation 对象都是同一个引用，因此不建议修改</p>
</li>
<li><p>异步的事件需要在插件处理完任务时调用回调函数通知<code>webpack</code>进入下一个流程，不然会卡住</p>
</li>
</ul>
<p>实现 Plugin 的模板如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPlugin</span> &#123;</span><br><span class="line">  <span class="comment">// webpack会调用MyPlugin实例的apply方法给插件传入compiler对象</span></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="comment">// 找到合适的事件钩子，实现自己的插件功能</span></span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tap</span>(<span class="string">&#x27;MyPlugin&#x27;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// compilation:当前打包构建流程的上下文</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(compilation);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// do something</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>emit</code>事件发生时，代表源文件的转换和组装已经完成，可以读取到最终将输出的资源、代码块、模块以及依赖，并且可以修改输出资源的内容。</p>
<h3 id="3-手写的插件并且测试有没有成功引入："><a href="#3-手写的插件并且测试有没有成功引入：" class="headerlink" title="3. 手写的插件并且测试有没有成功引入："></a>3. 手写的插件并且测试有没有成功引入：</h3><p>接下来我们来启动一个 demo 来测试手写的 plugin 是否能顺利被引入。</p>
<p>(1)先在插件文件的 <code>index.js</code> 中书写插件的功能；</p>
<p><img src="https://s2.loli.net/2024/02/01/a2DyIS1V54zC9F8.png" alt="2a0a7b00f01bbd72c225f7974e86e3f.png"></p>
<p>(2)然后在 <code>webpack.config.js</code> 中引入自己书写的 plugin，如果已经上传上 <code>npm</code> 上的插件，那就可以和其他插件一样引入，不然就引入本地文件；</p>
<p><img src="https://s2.loli.net/2024/02/01/mTi35OjzHAMuKay.png" alt="bf059714495b16b1ccea62f65796509.png"></p>
<p>(3)通过 <code>npx webpack build </code> 构建测试是否成功引入。</p>
<p><img src="https://s2.loli.net/2024/02/01/bOEwHCpZvc867IK.png" alt="0fc851173a4f7a89e31e106ac1ec649.png"></p>
<h2 id="10-了解-Webpack-proxy-的工作原理？为什么能实现跨域？"><a href="#10-了解-Webpack-proxy-的工作原理？为什么能实现跨域？" class="headerlink" title="10. 了解 Webpack proxy 的工作原理？为什么能实现跨域？"></a>10. 了解 <code>Webpack proxy</code> 的工作原理？为什么能实现跨域？</h2><h3 id="10-1-具体的配置的代码如下：在webpack-配置对象属性中通过-DevServer-属性提供"><a href="#10-1-具体的配置的代码如下：在webpack-配置对象属性中通过-DevServer-属性提供" class="headerlink" title="10.1. 具体的配置的代码如下：在webpack 配置对象属性中通过 DevServer 属性提供"></a>10.1. 具体的配置的代码如下：在<code>webpack</code> 配置对象属性中通过 <code>DevServer</code> 属性提供</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;https://api.github.com&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>devServer</code> 里面的<code>proxy</code>则是关于代理的配置，该属性为对象的形式，对象中每个属性就是一个代理的规则匹配。</p>
<p>对应如下：</p>
<ul>
<li><code>target</code>：表示的是代理到的目标地址</li>
<li><code>pathRewrite</code>：默认情况下，我们的 <code>api-hy</code> 也会被写入到<code>url</code>中，如果希望删除，可以使用<code>pathRewrite</code></li>
<li><code>secure</code>：默认情况下不接收转发到<code>https</code>的服务器上，如果希望支持，可设置为<code>false</code></li>
<li><code>changeOrigin</code>：表示是否更新代理后请求的 <code>headers</code>中的<code>host</code>地址</li>
</ul>
<h3 id="10-2-工作原理："><a href="#10-2-工作原理：" class="headerlink" title="10.2. 工作原理："></a>10.2. 工作原理：</h3><p><code>proxy</code>工作原理实质上是利用<code>http-proxy-middleware</code> 这个<code>http</code>代理中间件，实现请求转发给其他服务器。</p>
<p>举个 🌰：</p>
<p>在开发阶段，本地地址为 <code>http://localhost:3000</code>，该浏览器发送一个前缀带有<code>/api</code>标识的请求到服务端获取数据，但是响应这个请求的服务器只是将请求转发到另一台服务器中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="string">&#x27;/api&#x27;</span>,</span><br><span class="line">  <span class="title function_">proxy</span>(&#123;</span><br><span class="line">    <span class="attr">target</span>: <span class="string">&#x27;http://www.example.org&#x27;</span>,</span><br><span class="line">    <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http://localhost:3000/api/foo/bar</span></span><br><span class="line"><span class="comment">// -&gt;</span></span><br><span class="line"><span class="comment">// http://www.example.org/api/foo/bar</span></span><br></pre></td></tr></table></figure>

<h3 id="10-3-跨域："><a href="#10-3-跨域：" class="headerlink" title="10.3. 跨域："></a>10.3. 跨域：</h3><p>在开发阶段， <code>webpack-dev-server</code>会启动一个本地开发服务器，所以我们的应用在开发阶段是独立运行在 <code>localhost</code>上的一个端口，而后端又是运行在另外一个服务器上的。</p>
<p>所以在开发阶段中，由于浏览器同源策略的原因，当本地访问后端就会出现跨域请求的问题。</p>
<ul>
<li><p>通过设置<code>webpack proxy</code>实现代理请求后，相当于浏览器与服务器端添加一个代理者；</p>
</li>
<li><p>当本地发送请求的同时，代理服务器响应请求，并将请求转发到目标服务器，目标服务器响应数据后再将数据返回给代理服务器，最终再由代理服务器将数据响应给本地。</p>
</li>
<li><p>在代理服务器传递数据给本地浏览器的过程中，两者同源，并不存在跨域问题，这个时候浏览器就能正常接收数据。</p>
</li>
</ul>
<p><strong>注意</strong>：服务器与服务器之间请求数据并不会存在跨域行为，跨域行为是浏览器安全策略的限制。</p>
<h2 id="11-Loader"><a href="#11-Loader" class="headerlink" title="11. Loader"></a>11. <code>Loader</code></h2><p><code>Loader</code>是一个文件加载器，加载资源文件，并对这些文件进行一些处理，如：编译、压缩等，最终打包到指定文件中。</p>
<h3 id="11-1-配置方式："><a href="#11-1-配置方式：" class="headerlink" title="11.1. 配置方式："></a>11.1. 配置方式：</h3><p>一般我们是写在<code>module.rules</code>属性中：</p>
<ul>
<li><code>rules</code>是一个数组的形式，因此，我们可以配置很多个<code>loader</code>；</li>
<li>每个<code>loader</code>对应一个对象的形式，对象属性<code>test</code>为匹配的规则，一般情况下为正则表达式；</li>
<li>属性<code>use</code>针对匹配到文件类型，调用对应的<code>loader</code>进行处理。</li>
</ul>
<p><strong>特性：</strong></p>
<ul>
<li><code>loader</code>支持<code>链式调用</code>，链中的每个 loader 会处理之前已处理过的资源，最终转为 JS 代码，顺序为相反的顺序执行</li>
<li>loader 可以是同步的，也可以是异步的</li>
<li>loader 运行在 nodeJS 中，并且能够执行任何操作</li>
<li>除了常见的通过<code>package.json</code>的<code>main</code>来将一个 npm 模块导出为 loader，还可以在<code>module.rules</code>中使用 loader 字段来直接引用</li>
<li>还可以通过 loader 的预处理函数，为 JS 生态系统提供更多能力。用户可以更加灵活的引入细粒度逻辑，例如：压缩、打包、语言和其他更多特性</li>
</ul>
<h3 id="11-2-常见的-Loader："><a href="#11-2-常见的-Loader：" class="headerlink" title="11.2. 常见的 Loader："></a>11.2. 常见的 Loader：</h3><h4 id="style-loader"><a href="#style-loader" class="headerlink" title="style-loader"></a><code>style-loader</code></h4><p>将 css 添加到 DOM 的内联样式标签 style 里</p>
<h4 id="css-loader"><a href="#css-loader" class="headerlink" title="css-loader"></a><code>css-loader</code></h4><p>允许将 css 文件通过 require 的方式引入，并返回 css 代码</p>
<h4 id="less-loader"><a href="#less-loader" class="headerlink" title="less-loader"></a><code>less-loader</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>同一个任务的 loader 可以同时挂载多个，处理顺序：<code>从右到左，从下到上</code>。</p>
<p><strong>问题</strong>：如果只使用 css-loader 加载文件，则页面样式不会生效，为什么呢？</p>
<p><strong>原因</strong>：</p>
<p>css-loader 只负责将.css 文件进行解析，而不会将解析后的 css 插入到页面中；如果我们希望完成插入 style 的操作，需要引入 style-loader</p>
<h4 id="sass-loader"><a href="#sass-loader" class="headerlink" title="sass-loader"></a><code>sass-loader</code></h4><h4 id="raw-loader"><a href="#raw-loader" class="headerlink" title="raw-loader"></a><code>raw-loader</code></h4><p>在<code>webpack</code>中设置项目通过<code>import</code>方式导入文件内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"> ...,</span><br><span class="line"> <span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(txt|md)$/</span>,</span><br><span class="line">    <span class="attr">use</span>: <span class="string">&#x27;raw-loader&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="file-loader"><a href="#file-loader" class="headerlink" title="file-loader"></a><code>file-loader</code></h4><p>把识别出的资源模块，移动到制定和的输出目录，并且返回这个资源在输出目录的地址（字符串）</p>
<h4 id="url-loader"><a href="#url-loader" class="headerlink" title="url-loader"></a><code>url-loader</code></h4><p>处理 file-loader 所有的事情，但是遇到图片格式的模块，可以选择地把图片转为 base 64 格式的字符串，并打包到 js 中，对小体积的图片比较适合，大图片不合适。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>:[</span><br><span class="line">  ...,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif)$/</span>,</span><br><span class="line">    <span class="attr">use</span>: &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="comment">// placeholder 占位符[name]资源模块的名字</span></span><br><span class="line">        <span class="comment">// [ext]资源模块的后缀</span></span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;[name]_[hash].[ext]&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打包后存放的位置</span></span><br><span class="line">        <span class="attr">outputPath</span>:<span class="string">&quot;./images&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打包后文件的url</span></span><br><span class="line">        <span class="attr">publicPath</span>: <span class="string">&#x27;./images&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 小于100字节转为base64格式</span></span><br><span class="line">        <span class="attr">limit</span>: <span class="number">100</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="11-3-手写Loader"><a href="#11-3-手写Loader" class="headerlink" title="11.3. 手写Loader"></a>11.3. 手写<code>Loader</code></h3><p>在编写<code>Loader</code>之前，我们需要先了解<code>loader</code>的本质，</p>
<p>其本质为 <code>函数</code>，函数中的<code>this</code>作为上下文会被<code>webpack</code>填充，因此，我们不能将<code>loader</code>设为一个箭头函数。</p>
<p>函数接收一个参数，为<code>webpack</code>传递给<code>loader</code>的文件源内容；</p>
<p>函数中的<code>this</code>是由<code>webpack</code>提供的对象，能够获取当前<code>loader</code>所需的各种信息；</p>
<p>函数中有异步操作或同步操作，异步操作通过<code>this.callback</code>返回，返回值要求为<code>string</code>或<code>Buffer</code>。</p>
<p>代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出一个函数，source为webpack传递给loader的文件源内容</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="title function_">doSomeThing2JsString</span>(source);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果loader配置了options对象，那么this.query将指向options</span></span><br><span class="line">  <span class="keyword">const</span> options = <span class="variable language_">this</span>.<span class="property">query</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 可以用作解析其他模块路径的上下文</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this options&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * this.callback 参数：</span></span><br><span class="line"><span class="comment">   * error：Error | null，当loader出错时向外抛出一个error</span></span><br><span class="line"><span class="comment">   * content: String | Buffer ，经过loader编译后需要导出的内容</span></span><br><span class="line"><span class="comment">   * sourceMap： 为方便调试生成的编译后的内容的 source map</span></span><br><span class="line"><span class="comment">   * ast；本次编译生成的AST静态语法树，之后执行的loader可以直接使用这个AST，进而省去重复生成AST的过程</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">callback</span>(<span class="literal">null</span>, content); <span class="comment">// 异步</span></span><br><span class="line">  <span class="keyword">return</span> content; <span class="comment">// t同步</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>一般在编写 loader 的过程中，要尽量保持功能单一，避免做多种功能；</p>
<p>比如：less 文件转为 css 文件也不是一步到位的，而是<code>less-loader</code>、<code>css-loader</code>、<code>style-loader</code>几个 loader 的链式调用才完成转化的。</p>
<h2 id="12-如何提高webpack的构建速度？"><a href="#12-如何提高webpack的构建速度？" class="headerlink" title="12. 如何提高webpack的构建速度？"></a>12. 如何提高<code>webpack</code>的构建速度？</h2><p>优化<code>webpack</code>构建速度可以从<code>优化搜索时间</code>、<code>缩小文件搜索范围</code>、<code>减少不必要的编译</code> 等方面入手分析：</p>
<h3 id="12-1-如何优化"><a href="#12-1-如何优化" class="headerlink" title="12.1. 如何优化"></a>12.1. 如何优化</h3><ul>
<li>优化 loader 配置</li>
<li>合理使用 resolve.extensions</li>
<li>优化 resolve.modules</li>
<li>优化 resolve.alias</li>
<li>使用 DLLPlugin 插件</li>
<li>使用 Cache-loader</li>
<li>terser 启动多线程</li>
<li>合理使用 sourceMap</li>
</ul>
<h4 id="12-1-1-优化-loader-配置"><a href="#12-1-1-优化-loader-配置" class="headerlink" title="12.1.1. 优化 loader 配置"></a>12.1.1. 优化 <code>loader</code> 配置</h4><p>使用<code>loader</code>时，可通过配置<code>include</code>、<code>exclude</code>、<code>test</code>属性来匹配文件，接触<code>include</code>、<code>exclude</code>规定哪些匹配应用的<code>loader</code></p>
<p>如采用 ES6 的项目为例，在配置 <code>babel-loader</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 如果项目源码中只有js文件就不要写成/\.jsx?$/，提升正则表达式性能</span></span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// babel-loader支持缓存转换出的结果，通过CacheDirectory选项开启</span></span><br><span class="line">      <span class="attr">use</span>: [<span class="string">&#x27;babel-loader?cacheDirectory&#x27;</span>],</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 只对项目根目录下的src目录下的文件采用babel-loader</span></span><br><span class="line">      <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="12-1-2-合理使用resolve-extensions"><a href="#12-1-2-合理使用resolve-extensions" class="headerlink" title="12.1.2. 合理使用resolve.extensions"></a>12.1.2. 合理使用<code>resolve.extensions</code></h4><p>在开发过程中会有各种各样的模块，这些模块可能来自于自己编写的代码，也可能是来自于第三方库， <code>resolve</code>可以帮助<code>webpack</code>从每个<code>require/import</code>语句中，找到需要引入到合适的模块代码中</p>
<p>通过 <code>resolve.extensions</code> 是解析到文件时自动添加扩展名，默认情况如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> =&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">extensions</span>: [<span class="string">&#x27;.warn&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;..mjs&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们引入文件的时候，若没有文件后缀名，则会根据数组内的值<code>依次</code>查找；</p>
<p>当我们配置时，不要随便把所有的后缀名都写在数组里，这样子会增加查找的次数，使得打包速度也变慢了。</p>
<h4 id="12-1-3-优化-resolve-modules"><a href="#12-1-3-优化-resolve-modules" class="headerlink" title="12.1.3. 优化 resolve.modules"></a>12.1.3. 优化 <code>resolve.modules</code></h4><p><code>resolve.modules</code>用于配置<code>webpack</code>去哪些文件目录下寻找第三方模块。默认值为[‘node_modules’]，所以默认会从<code>node_modules</code>中查找文件</p>
<p>当安装的第三方模块都放在项目根目录下的<code>./node_modules</code>目录下时，因此可以指明存放第三方库的绝对路径，以减少寻找的过程，配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="comment">// 使用绝对路径指明第三方模块存放的位置，以减少搜索的步骤</span></span><br><span class="line">    <span class="comment">// 其中 __dirname表示当前工作目录，也就是项目根目录</span></span><br><span class="line">    <span class="attr">modules</span>: [path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;node_modules&#x27;</span>)],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="12-1-4-优化-resolve-alias"><a href="#12-1-4-优化-resolve-alias" class="headerlink" title="12.1.4. 优化 resolve.alias"></a>12.1.4. 优化 <code>resolve.alias</code></h4><p><code>alias</code>给一些常用的路径起一个别名，特别当我们的项目目录结构比较深的时候，一个文件路径可能是<code>../../../</code>的形式</p>
<p>通过配置<code>alias</code>减少查找的过程：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="12-1-5-使用-DLLPlugin-插件"><a href="#12-1-5-使用-DLLPlugin-插件" class="headerlink" title="12.1.5. 使用 DLLPlugin 插件"></a>12.1.5. 使用 <code>DLLPlugin</code> 插件</h4><p><code>DDL</code>(动态链接库)，是为软件在 window 这种实现共享函数库的一种实现方式，而<code>webpack</code>也内置了 DLL 的功能，为的就是能实现共享，将不经常改变的代码抽成一个共享库，这个库在之后的编译过程中，会被引入到其他项目的代码中</p>
<p>主要分为两个步骤：</p>
<ul>
<li>打包一个<code>DLL</code>库</li>
<li>引入<code>DLL</code>库</li>
</ul>
<ol>
<li>打包一个<code>DLL</code>库</li>
</ol>
<p>webpack 内置了一个<code>DLLPlugin</code>可以帮助我们打包一个<code>Dll</code>的库文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DLLPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;dll_[name]&#x27;</span>,</span><br><span class="line">      <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./dll/[name].manifest.json&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>引入<code>DLL</code>库</li>
</ol>
<p>使用<code>webpack</code>自带的<code>DLLReferencePlugin</code>插件对<code>manifest.json</code>映射文件进行分析，获取要使用的<code>DLL库</code>;</p>
<p>然后再通过<code>AddAssetHtmlPlugin</code>插件，将我们打包的<code>DLL</code>库引入到<code>html</code>模块中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">    <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;./dll/dll_react.js&#x27;</span>),</span><br><span class="line">    <span class="attr">manifest</span>: path.<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;./dll/react_manifest.json&#x27;</span>),</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">AddAssetHtmlPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">outputPath</span>: <span class="string">&quot;./auto&quot;</span>,</span><br><span class="line">    <span class="attr">filepath</span>: path.<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;./dll/dll_react.js&#x27;</span>),</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-1-6-使用-Cache-loader"><a href="#12-1-6-使用-Cache-loader" class="headerlink" title="12.1.6. 使用 Cache-loader"></a>12.1.6. 使用 <code>Cache-loader</code></h4><p>对于一些性能开销较大的<code>loader</code>之前添加<code>cache-loader</code>，实现将结果缓存到磁盘里，显著提升二次构建速度，不过也需要慎用，不然可能导致首次加载非常慢</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ext$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&#x27;cache-loader&#x27;</span>, ...loaders],</span><br><span class="line">        <span class="attr">include</span>: path.<span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="12-1-7-terser-启动多线程"><a href="#12-1-7-terser-启动多线程" class="headerlink" title="12.1.7. terser 启动多线程"></a>12.1.7. <code>terser</code> 启动多线程</h4><p>可以使用<code>多线程</code>来提高构建速度</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: [</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-1-8-合理使用-sourceMap"><a href="#12-1-8-合理使用-sourceMap" class="headerlink" title="12.1.8. 合理使用 sourceMap"></a>12.1.8. 合理使用 <code>sourceMap</code></h4><p>sourceMap 本质上是一个信息文件，记录了转换压缩后的代码所对应的转换前的源码位置，是源代码和生产代码的映射。</p>
<p>打包生成 <code>sourceMap</code>的时候，如果信息越详细，打包速度就会越慢，对应的属性如下图：</p>
<table>
<thead>
<tr>
<th>devtool</th>
<th>构建速度</th>
<th>重新构建速度</th>
<th>生产环境</th>
<th>品质</th>
</tr>
</thead>
<tbody><tr>
<td><code>none</code></td>
<td>+++</td>
<td>+++</td>
<td>yes</td>
<td>打包后的代码</td>
</tr>
<tr>
<td><code>eval</code></td>
<td>+++</td>
<td>+++</td>
<td>no</td>
<td>生成后的代码</td>
</tr>
<tr>
<td><code>cheap-eval-source-map</code></td>
<td>+</td>
<td>++</td>
<td>no</td>
<td>转换过的代码（仅限行）</td>
</tr>
<tr>
<td><code>cheap-module-source-map</code></td>
<td>○</td>
<td>++</td>
<td>no</td>
<td>源代码（仅限行）</td>
</tr>
<tr>
<td><code>eval-source-map</code></td>
<td>–</td>
<td>+</td>
<td>no</td>
<td>源代码</td>
</tr>
<tr>
<td><code>cheap-source-map</code></td>
<td>+</td>
<td>○</td>
<td>yes</td>
<td>转换过的代码（仅限行）</td>
</tr>
<tr>
<td><code>cheap-module-source-map</code></td>
<td>○</td>
<td>-</td>
<td>yes</td>
<td>源代码（仅限行）</td>
</tr>
<tr>
<td><code>inline-cheap-source-map</code></td>
<td>+</td>
<td>○</td>
<td>no</td>
<td>转换过的代码（仅限行）</td>
</tr>
<tr>
<td><code>inline-cheap-module-source-map</code></td>
<td>○</td>
<td>-</td>
<td>no</td>
<td>源代码（仅限行）</td>
</tr>
<tr>
<td><code>source-map</code></td>
<td>–</td>
<td>–</td>
<td>yes</td>
<td>源代码</td>
</tr>
<tr>
<td><code>inline-source-map</code></td>
<td>–</td>
<td>–</td>
<td>no</td>
<td>源代码</td>
</tr>
<tr>
<td><code>hidden-source-map</code></td>
<td>–</td>
<td>–</td>
<td>no</td>
<td>源代码</td>
</tr>
<tr>
<td><code>nosources-source-map</code></td>
<td>–</td>
<td>–</td>
<td>yes</td>
<td>无源代码内容</td>
</tr>
</tbody></table>
<p><code>+++</code> 非常快 <code>++</code> 快 <code>+</code> 比较快 <code>○</code> 中等 <code>-</code> 比较慢 <code>--</code> 慢</p>
<h2 id="13-如何从-webpack-角度优化前端性能？"><a href="#13-如何从-webpack-角度优化前端性能？" class="headerlink" title="13. 如何从 webpack 角度优化前端性能？"></a>13. 如何从 webpack 角度优化前端性能？</h2><p>可以从<code>文件体积的大小</code>、<code>分包的形式</code>、<code>减少http请求次数</code>等方式入手</p>
<h3 id="13-1-优化的手段有："><a href="#13-1-优化的手段有：" class="headerlink" title="13.1. 优化的手段有："></a>13.1. 优化的手段有：</h3><ul>
<li>JS 代码压缩</li>
<li>CSS 代码压缩</li>
<li>HTML 代码压缩</li>
<li>文件大小压缩</li>
<li>图片压缩</li>
<li>Tree Shaking</li>
<li>代码分离</li>
<li>内联 chunk</li>
</ul>
<h4 id="13-1-1-JS-代码压缩"><a href="#13-1-1-JS-代码压缩" class="headerlink" title="13.1.1. JS 代码压缩"></a>13.1.1. JS 代码压缩</h4><p><code>terser</code> 是一个 Javascript 的解释、绞肉机、压缩器的工具集，可以帮助我们压缩、简化我们的代码，让<code>bundle</code>更小</p>
<p>在<code>production</code>模式下， <code>webpack</code>默认就是使用 <code>TreserPlugin</code>来处理的，如果想要自定义配置，也是可以的</p>
<p>举个 🌰：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: <span class="literal">true</span>, <span class="comment">// 电脑cpu核数 -1</span></span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>属性如下：</p>
<ul>
<li><p><code>extractComments</code>:默认为 true，表示会将注释抽取到一个单独的文件中，开发阶段，我们可设置为 false，不保留注释</p>
</li>
<li><p><code>parallel</code>:使用多进程并发运行提高构建的速度，默认为 true，并发运行的默认数量:os.cpus().length -1</p>
</li>
<li><p><code>terserOptions</code>:设置我们的<code>terser</code>相关配置</p>
</li>
<li><p><code>compress</code>:设置压缩相关的选项，</p>
</li>
<li><p><code>mangle</code>：设置简化的相关选项，可以设置为 true</p>
</li>
<li><p><code>toplevel</code>:设置底层变量是否进行转化</p>
</li>
<li><p><code>keep_classnames</code>:保留类的名称</p>
</li>
<li><p><code>keep_fnames</code>:保留函数的名称</p>
</li>
</ul>
<h4 id="13-1-2-CSS-代码压缩"><a href="#13-1-2-CSS-代码压缩" class="headerlink" title="13.1.2. CSS 代码压缩"></a>13.1.2. CSS 代码压缩</h4><p>CSS 压缩通常是去除无用的空格等。</p>
<p>CSS 压缩我们也可以使用插件：<code>css-minimizer-webpack-plugin</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="13-1-3-HTML-代码压缩"><a href="#13-1-3-HTML-代码压缩" class="headerlink" title="13.1.3. HTML 代码压缩"></a>13.1.3. HTML 代码压缩</h4><p>使用<code>HtmlWebpackPlugin</code>插件来生成 HTML 的模板的时候，通过配置属性<code>minify</code>进行 html 优化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">plugin</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlwebpackPlugin</span>(&#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="attr">minify</span>: &#123;</span><br><span class="line">        <span class="attr">minifyCSS</span>: <span class="literal">false</span>, <span class="comment">// 是否压缩css</span></span><br><span class="line">        <span class="attr">collapseWhitespace</span>: <span class="literal">false</span>, <span class="comment">//是否折叠空格</span></span><br><span class="line">        <span class="attr">removeComments</span>: <span class="literal">true</span>, <span class="comment">//是否移除注释</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>设置了 minify，实际上会使用另一个插件 html-minifier-terser</p>
<h4 id="13-1-4-文件大小压缩"><a href="#13-1-4-文件大小压缩" class="headerlink" title="13.1.4. 文件大小压缩"></a>13.1.4. 文件大小压缩</h4><p>对文件大小压缩，减少<code>http</code>传输过程中宽带的损耗</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ComepressionPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(css|js)$/</span>, <span class="comment">//哪些文件需要压缩</span></span><br><span class="line">  <span class="attr">threshold</span>: <span class="number">500</span>, <span class="comment">// 设置文件多大开始压缩</span></span><br><span class="line">  <span class="attr">minRatio</span>: <span class="number">0.7</span>, <span class="comment">// 至少压缩的比例</span></span><br><span class="line">  <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span>, <span class="comment">// 采用的压缩算法</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="13-1-5-图片压缩"><a href="#13-1-5-图片压缩" class="headerlink" title="13.1.5. 图片压缩"></a>13.1.5. 图片压缩</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;[name]_[hash].[ext]&#x27;</span>,</span><br><span class="line">            <span class="attr">outputPath</span>: <span class="string">&#x27;images/&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;image-webpack-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="comment">// 压缩jpeg的配置</span></span><br><span class="line">            <span class="attr">mozjpeg</span>: &#123;</span><br><span class="line">              <span class="attr">progressive</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">quality</span>: <span class="number">65</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 使用imagemin**-optipng 压缩 png， enable: false为关闭</span></span><br><span class="line">            <span class="attr">optipng</span>: &#123;</span><br><span class="line">              <span class="attr">enabled</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 使用imagemin-pngquant 压缩 png</span></span><br><span class="line">            <span class="attr">pngquant</span>: &#123;</span><br><span class="line">              <span class="attr">quality</span>: <span class="string">&#x27;65-90&#x27;</span>,</span><br><span class="line">              <span class="attr">speed</span>: <span class="number">4</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 压缩gif</span></span><br><span class="line">            <span class="attr">gifsicle</span>: &#123;</span><br><span class="line">              <span class="attr">interlaced</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 开启webp，会把 jpg 和 png 图片压缩为 webp格式</span></span><br><span class="line">            <span class="attr">webp</span>: &#123;</span><br><span class="line">              <span class="attr">quality</span>: <span class="number">75</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="13-1-6-Tree-Shaking"><a href="#13-1-6-Tree-Shaking" class="headerlink" title="13.1.6. Tree Shaking"></a>13.1.6. Tree Shaking</h4><p><code>Tree shaking</code> 依赖于 ES module 的静态语法分析。</p>
<p>在<code>webpack</code>实现<code>Tree shaking</code>有两种方案：</p>
<ul>
<li><p><code>usedExports</code>: 通过标记某些函数是否被使用过，之后通过<code>terser</code>进行优化</p>
</li>
<li><p><code>sideEffects</code>: 跳过某些文件、模块，直接查看该文件、模块是否有副作用</p>
</li>
</ul>
<ol>
<li>usedExports</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    usedExports,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>使用之后，没被用上的代码在 webpack 打包中会加上<code>unused harmony export mul</code>注释，用来告知 <code>Terser</code>在优化时，可以将这段代码删除。</p>
<ol start="2">
<li>sideEffects</li>
</ol>
<p><code>sideEffects</code>用来告知 webpack compiler 哪些模块有副作用</p>
<p>如果 sideEffects 设置为 false，就是告知 webpack 可以安全删除未用到的 exports</p>
<p>如果有些文件需要保留，可以设置为数组的形式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;sideEffects&quot;</span>:[</span><br><span class="line"> <span class="string">&quot;./src/util/format.js&quot;</span>,</span><br><span class="line"> <span class="string">&quot;*.css&quot;</span> <span class="comment">// css</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>不仅仅 JS 有 Tree shaking，css 也有。</p>
<p>CSS 可以使用<code>purgecss-plugin-webpack</code>插件实现:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">PurgeCssPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;purgecss-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"> <span class="attr">plugins</span>:[</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">PurgeCssPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">path</span>:glob.<span class="title function_">sync</span>(<span class="string">`<span class="subst">$&#123;path.resolve(<span class="string">&#x27;./src&#x27;</span>)&#125;</span>/**/*`</span>), &#123;<span class="attr">nodir</span>:<span class="literal">true</span>&#125;</span><br><span class="line">  <span class="comment">// src里面的所有文件</span></span><br><span class="line">    <span class="attr">satelist</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">standard</span>:[<span class="string">&quot;html&quot;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>path：表示要检测哪些目录下的内容需要被分析，配合使用 glob</li>
<li>默认情况，Purgecss 会将我们的 html 标签的样式移除，如果我们希望保留，可以添加一个<code>safelist</code>属性</li>
</ul>
<h4 id="13-1-7-代码分离"><a href="#13-1-7-代码分离" class="headerlink" title="13.1.7. 代码分离"></a>13.1.7. 代码分离</h4><p>将代码分离到不同的 bundle 中，之后可以按需加载，或者并行加载这些文件</p>
<p>默认情况，所有 JS 文件会在首页全部加载，影响首屏速度。</p>
<p>代码分离为更小的 bundle，以及控制资源加载的优先级，可以提高代码的加载性能。</p>
<p>这里可以通过<code>splitChunksPlugin</code>插件来实现，该插件默认安装和集成，只需要配置即可。</p>
<p>但是在默认设置中，chunks 仅仅针对异步（async）请求，我们可以设置为 initial &#x2F;all</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>splitChunks 主要属性：</p>
<ul>
<li>Chunks:对同步代码还是异步代码进行处理</li>
<li>minSize:拆分包的大小，至少为 minSize，如果这个包大小不超过 minSize，那么不拆包</li>
<li>maxSize:将大于 maxSize 的包拆分为不小于 minSize 的包</li>
<li>minChunks:被引入的次数，默认 1</li>
</ul>
<h4 id="13-1-8-内联-chunk"><a href="#13-1-8-内联-chunk" class="headerlink" title="13.1.8. 内联 chunk"></a>13.1.8. 内联 chunk</h4><p>可以通过 InlineChunkHtmlPlugin 插件将一个 chunk 的模块内联到 html，如 runtime 的代码（对模块进行解析、加载、模块信息相关的代码），代码量并不大，但是必须加载的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">InlineChunkHtmlPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;react-dev-utils/InlineChunkHtmlPlugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line"> <span class="attr">plugin</span>:[</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">InlineChunkHtmlPlugin</span>(<span class="title class_">HtmlWebpackPlugin</span>,[<span class="regexp">/runtime.+\.js/</span>]</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="14-优秀参考文档："><a href="#14-优秀参考文档：" class="headerlink" title="14. 优秀参考文档："></a>14. 优秀参考文档：</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/tree/main">webpack 源码</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/410749514">手写 plugin</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gweid/webpack-source-code?tab=readme-ov-file">webpack 源码阅读方法</a></li>
</ul>
<h2 id="「❤️-感谢大家」"><a href="#「❤️-感谢大家」" class="headerlink" title="「❤️ 感谢大家」"></a>「❤️ 感谢大家」</h2><p>本文只是自己学习 webpack 过程中整理的思路和梳理，希望后学者提供一点帮助。其实也是抛砖引玉啦，欢迎大家评论区讨论，留下自己的想法 ❤️</p>
<p>如果觉得不错，麻烦大家帮忙点个赞，关注一下吖</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/01/27/%E5%93%88%E5%B8%8C%E8%A1%A8%E4%B9%8B%E5%85%B8%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/01/27/%E5%93%88%E5%B8%8C%E8%A1%A8%E4%B9%8B%E5%85%B8%E4%BE%8B/" class="post-title-link" itemprop="url">哈希表之典例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-27 21:33:46" itemprop="dateCreated datePublished" datetime="2024-01-27T21:33:46+08:00">2024-01-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-13 19:50:29" itemprop="dateModified" datetime="2024-02-13T19:50:29+08:00">2024-02-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="赎金信"><a href="#赎金信" class="headerlink" title="赎金信"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/ransom-note/description">赎金信</a></h2><p>本题可以采用哈希表的方式来解决，基本的解题思路：</p>
<ol>
<li>首先需要先来一个特殊判断，如果子串的长度大于母串的长度，那么直接返回 false，不需要性能去遍历了；</li>
<li>因为字符串的字母一定是存在 26 字母表中的，因此，我们可以先建立一个由 26 字母组成的哈希表；</li>
<li>遍历母串，记录每个字母出现的频次；</li>
<li>遍历子串，也记录每个字母出现的频次；</li>
<li>如果发现子串中存在某个字母 c 的统计次数 &gt; 该字母在母串中出现的次数，那么肯定不存在子串的，直接返回 false。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canConstruct = <span class="keyword">function</span> (<span class="params">ransomNote, magazine</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (ransomNote.<span class="property">length</span> &gt; magazine.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> cnt = <span class="title class_">Array</span>(<span class="number">26</span>).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> c <span class="keyword">of</span> magazine) &#123;</span><br><span class="line">    ++cnt[c.<span class="title function_">charCodeAt</span>(<span class="number">0</span>) - <span class="number">97</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> c <span class="keyword">of</span> ransomNote) &#123;</span><br><span class="line">    <span class="keyword">if</span> (--cnt[c.<span class="title function_">charCodeAt</span>(<span class="number">0</span>) - <span class="number">97</span>] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>时间复杂度：O(m+n)，m 是母串长度，n 是子串长度。</p>
</li>
<li><p>空间复杂度：O(|S|)，S 是字符串，这题中 S 为全部的小写英文字母，因此，|S| &#x3D; 26。</p>
<p>​</p>
</li>
</ul>
<h2 id="同构字符串"><a href="#同构字符串" class="headerlink" title="同构字符串"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/isomorphic-strings/description/?envType=study-plan-v2&envId=top-interview-150">同构字符串</a></h2><p>这道题可以利用两个哈希表来配合解决</p>
<p><strong>解图思路：</strong></p>
<ol>
<li><p>首先做个特殊判断：如果两个字符串长度不相同，那么就不可能形成同构，直接返回 false。</p>
</li>
<li><p>建立两个哈希表来配合解决。</p>
</li>
</ol>
<p>第一张哈希表 s2t 中以 s 中字符为键，映射到 t 的字符为值；<br>第二张哈希表 t2s 中以 t 中字符为键，映射到 s 的字符为值。</p>
<ol start="3">
<li>从左到右遍历两个字符串的字符，不断更新两张哈希表，如果出现冲突，说明不可能形成同构；如果全部遍历完都不会出现冲突，说明就是形成同构。</li>
</ol>
<p><strong>这道题最大的难度就是何为冲突呢？</strong><br>冲突可能有两种情况：</p>
<ul>
<li>当前下标 index 对应的字符 s[index] 已经存在映射且不为 t[index]</li>
<li>当前下标 index 对应的字符 t[index] 已经存在映射且不为 s[index]</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isIsomorphic = <span class="keyword">function</span> (<span class="params">s, t</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (s.<span class="property">length</span> !== t.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> s2t = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> t2s = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> len = s.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> x = s[i],</span><br><span class="line">      y = t[i];</span><br><span class="line">    <span class="keyword">if</span> ((s2t[x] &amp;&amp; s2t[x] !== y) || (t2s[y] &amp;&amp; t2s[y] !== x)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    s2t[x] = y;</span><br><span class="line">    t2s[y] = x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)，n 为字符串的长度，我们只需要同时遍历一遍字符串 s 和 t 即可</li>
<li>空间复杂度： O(∣Σ∣)，其中 Σ 是字符串的字符集。哈希表存储字符的空间取决于字符串的字符集的大小，最坏的情况下每个字符均不相同，此时需要 O(∣Σ∣) 的空间。</li>
</ul>
<h2 id="单词规律"><a href="#单词规律" class="headerlink" title="单词规律"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/word-pattern/">单词规律</a></h2><p>这道题其实是上题 <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/isomorphic-strings/description/?envType=study-plan-v2&envId=top-interview-150">同构字符串</a> 的一个进阶版本，这里是要求判断单词的同构与否。基本的截图思路如下：</p>
<ol>
<li>将字符串 s 以 <code>&#39; &#39;</code> 为界，分隔为数组形式；</li>
<li>先做特殊判断，如果 pattern 和 words 的长度不一样，那么就不可能形成同构的，直接返回 false</li>
<li>建立两个哈希表 word2ch 和 ch2word，</li>
</ol>
<ul>
<li>第一张哈希表以 word2ch 的字符串为键，在 pattern 映射的字符为值</li>
<li>第二张哈希表以 pattern 的字符串为键，在 Word2ch 映射的字符为值</li>
</ul>
<ol start="4">
<li>遍历字符串，匹配字符串，如果发生冲突就返回 false，否则遍历结束还没有冲突就返回 true</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wordPattern = <span class="keyword">function</span> (<span class="params">pattern, s</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> words = s.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (pattern.<span class="property">length</span> !== words.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> word2ch = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">const</span> ch2word = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [i, word] <span class="keyword">of</span> words.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="keyword">const</span> ch = pattern[i];</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      (word2ch.<span class="title function_">has</span>(word) &amp;&amp; word2ch.<span class="title function_">get</span>(word) != ch) ||</span><br><span class="line">      (ch2word.<span class="title function_">has</span>(ch) &amp;&amp; ch2word.<span class="title function_">get</span>(ch) !== word)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    word2ch.<span class="title function_">set</span>(word, ch);</span><br><span class="line">    ch2word.<span class="title function_">set</span>(ch, word);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(m+n)</li>
<li>空间复杂度： O(m+n)</li>
</ul>
<h2 id="有效的字母异位词"><a href="#有效的字母异位词" class="headerlink" title="有效的字母异位词"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/valid-anagram/description">有效的字母异位词</a></h2><h3 id="利用数组的方法："><a href="#利用数组的方法：" class="headerlink" title="利用数组的方法："></a>利用数组的方法：</h3><p>解题思路：</p>
<ol>
<li>先特殊判断，如果符合字母异位词，那么长度一定是一样的；</li>
<li>先对字符串进行排序，符合字母异位词，那么排序后的字符串一定是完全等于的（&#x3D;&#x3D;&#x3D;）。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isAnagram = <span class="keyword">function</span> (<span class="params">s, t</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    s.<span class="property">length</span> == t.<span class="property">length</span> &amp;&amp; [...s].<span class="title function_">sort</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>) === [...t].<span class="title function_">sort</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(nlogn)，其中 n 是 s 的长度。排序的时间复杂度为 O(nlogn)，比较两个字符是否相等的时间复杂度为 O(n)，因此总体时间的复杂度为 O(nlogn + n) &#x3D; O(nlogn + n)。</li>
<li>空间复杂度： O(logn)，只需要排序的空间复杂度 O(logn)。</li>
</ul>
<h3 id="哈希表法："><a href="#哈希表法：" class="headerlink" title="哈希表法："></a>哈希表法：</h3><p>解题思路：</p>
<ol>
<li>先建立一个哈希表，存放 26 个字母；</li>
<li>遍历字符串，记录每个字母出现的频次；</li>
<li>如果出现 table[t.codePointAt(i) - ‘a’.codePointAt(0)]&lt;0，即与字母异位词冲突，返回 false。否则返回 true。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isAnagram = <span class="keyword">function</span> (<span class="params">s, t</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (s.<span class="property">length</span> !== t.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> table = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">26</span>).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; s.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    table[s.<span class="title function_">codePointAt</span>(i) - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">codePointAt</span>(<span class="number">0</span>)]++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; t.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    table[t.<span class="title function_">codePointAt</span>(i) - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">codePointAt</span>(<span class="number">0</span>)]--;</span><br><span class="line">    <span class="keyword">if</span> (table[t.<span class="title function_">codePointAt</span>(i) - <span class="string">&#x27;a&#x27;</span>.<span class="title function_">codePointAt</span>(<span class="number">0</span>)] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)，n 为 s 的长度。</li>
<li>空间复杂度： O(S)，其中 S 为字符集的大小，此处 S&#x3D;26。</li>
</ul>
<h2 id="两数之和"><a href="#两数之和" class="headerlink" title="两数之和"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/two-sum/description">两数之和</a></h2><p>解题思路：</p>
<p>这道题直接的方法可以使用暴力枚举的方式找到 target - x ，只是时间复杂度很高 O(n)，因此，我们可以使用哈希表法的方式要来使得时间复杂度从 O(n) 降低到 O(1)。</p>
<p>这样子，我们创建一个哈希表，i 代表每一个 x,然后我们查询哈希表中是否存在 target - x，如果存在就返回 x 和 target - x 的对应索引数组；如果不存在，那么我们就将 x 存入哈希表中，这样子保证不会让 x 与自己匹配，即保证两数一定是不重合的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">twoSum</span>(<span class="params">nums, target</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (map.<span class="title function_">has</span>(nums[i])) &#123;</span><br><span class="line">      <span class="keyword">return</span> [map.<span class="title function_">get</span>(nums[i]), i];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      map.<span class="title function_">set</span>(target - nums[i], i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)</li>
<li>空间复杂度： O(n)</li>
</ul>
<h2 id="字母异位词分组"><a href="#字母异位词分组" class="headerlink" title="字母异位词分组"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/group-anagrams/description">字母异位词分组</a></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> groupAnagrams = <span class="keyword">function</span> (<span class="params">strs</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> str <span class="keyword">of</span> strs) &#123;</span><br><span class="line">    <span class="keyword">let</span> array = <span class="title class_">Array</span>.<span class="title function_">from</span>(str);</span><br><span class="line">    array.<span class="title function_">sort</span>();</span><br><span class="line">    <span class="keyword">let</span> key = array.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">let</span> list = map.<span class="title function_">get</span>(key) ? map.<span class="title function_">get</span>(key) : <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line">    list.<span class="title function_">push</span>(str);</span><br><span class="line">    map.<span class="title function_">set</span>(key, list);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(map.<span class="title function_">values</span>());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="存在重复元素-II"><a href="#存在重复元素-II" class="headerlink" title="存在重复元素 II"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/contains-duplicate-ii/description">存在重复元素 II</a></h2><h3 id="哈希表法：-1"><a href="#哈希表法：-1" class="headerlink" title="哈希表法："></a>哈希表法：</h3><p>解题思路：</p>
<ol>
<li>先建立一个哈希表；</li>
<li>先确定一个索引为 i 的值，然后遍历数组寻找符合条件的另一个不同于 i 的元素，一定要判断保证 abs(i-j) &lt;&#x3D; k。存在符合条件的就返回 true，没有就返回 false。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> containsNearbyDuplicate = <span class="keyword">function</span> (<span class="params">nums, k</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (map.<span class="title function_">has</span>(nums[i]) &amp;&amp; i - map.<span class="title function_">get</span>(nums[i]) &lt;= k) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    map.<span class="title function_">set</span>(nums[i], i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)</li>
<li>空间复杂度： O(n)</li>
</ul>
<h3 id="滑动窗口法："><a href="#滑动窗口法：" class="headerlink" title="滑动窗口法："></a>滑动窗口法：</h3><p>解题思路：</p>
<p>使用<strong>滑动窗口</strong>，如果其中存在重复元素，则存在两个不同的下标 i 和 j 满足：nums[i] &#x3D;&#x3D;&#x3D;nums[j] 并且 |i-j| &lt;&#x3D; k。如果所有滑动窗口都没有重复元素，则不存在符合要求的下标，因此，只要遍历每个滑动窗口，判断滑动窗口中是否有重复元素即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> containsNearbyDuplicate = <span class="keyword">function</span> (<span class="params">nums, k</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  <span class="keyword">const</span> length = nums.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; k) &#123;</span><br><span class="line">      set.<span class="title function_">delete</span>(nums[i - k - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (set.<span class="title function_">has</span>(nums[i])) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    set.<span class="title function_">add</span>(nums[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)</li>
<li>空间复杂度： O(k)，其中 k 是判断重复元素时允许的下标差的绝对值的最大值。需要使用哈希集合存储滑动窗口中的元素，任意时刻滑动窗口中的元素个数最多为 k+1 个。</li>
</ul>
<h2 id="最长连续序列"><a href="#最长连续序列" class="headerlink" title="最长连续序列"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/longest-consecutive-sequence/description">最长连续序列</a></h2><p><strong>示例：</strong></p>
<p>输入：nums &#x3D; [100,4,200,1,3,2]<br>输出：4<br>解释：最长数字连续序列是 [1, 2, 3, 4]。它的长度为 4。</p>
<p>基本的解题思路：</p>
<ol>
<li>先建立一个哈希表 Set，将原本的所有数据存入到哈希表中</li>
<li>遍历数组，然后判断当前 num - 1 这个值是不是存在于哈希表中，如果存在就当前值 -1，那么将当前值 +1 ，并且将记录序列的长度也 + 1；如果不存在则将当前值还是设置为当前遍历到的值，并且将记录当前序列设置为 1 。</li>
<li>使用 Math.max 方法求得最长的序列长度，将其返回。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> longestConsecutive = <span class="keyword">function</span> (<span class="params">nums</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> num_set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> num <span class="keyword">of</span> nums) &#123;</span><br><span class="line">    num_set.<span class="title function_">add</span>(num);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> longestStreak = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> num <span class="keyword">of</span> num_set) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!num_set.<span class="title function_">has</span>(num - <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">let</span> currentNum = num;</span><br><span class="line">      <span class="keyword">let</span> currentStreak = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (num_set.<span class="title function_">has</span>(currentNum + <span class="number">1</span>)) &#123;</span><br><span class="line">        currentNum += <span class="number">1</span>;</span><br><span class="line">        currentStreak += <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      longestStreak = <span class="title class_">Math</span>.<span class="title function_">max</span>(longestStreak, currentStreak);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> longestStreak;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度： O(n)</li>
<li>空间复杂度： O(n)，哈希表中存储数组中所有元素需要的 n 个空间。</li>
</ul>
<h2 id="快乐数"><a href="#快乐数" class="headerlink" title="快乐数"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/happy-number/description">快乐数</a></h2><blockquote>
<p>「快乐数」 定义为：</p>
</blockquote>
<blockquote>
<p>对于一个正整数，每一次将该数替换为它每个位置上的数字的平方和。<br>然后重复这个过程直到这个数变为 1，也可能是 无限循环 但始终变不到 1。<br>如果这个过程 结果为 1，那么这个数就是快乐数。</p>
</blockquote>
<p>**getNext()**是计算一个多位数的每一位数字的和累加的结果，并且返回</p>
<ul>
<li>第一种是采用数学求余的方式实现的</li>
<li>第二种是采用字符串数组的方法来实现的</li>
</ul>
<p>**isHappy()**方法是为了判断是否为 happy 数，可以采用哈希表和快慢双指针的方式来实现。</p>
<h3 id="哈希表法"><a href="#哈希表法" class="headerlink" title="哈希表法"></a>哈希表法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getNext = <span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">0</span>) <span class="keyword">return</span> n;</span><br><span class="line">  <span class="keyword">let</span> totalSum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (n) &#123;</span><br><span class="line">    <span class="keyword">let</span> d = n % <span class="number">10</span>;</span><br><span class="line">    n = <span class="built_in">parseInt</span>(n / <span class="number">10</span>);</span><br><span class="line">    totalSum += d * d;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> totalSum;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> isHappy = <span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  <span class="keyword">while</span> (n != <span class="number">1</span> &amp;&amp; !set.<span class="title function_">has</span>(n)) &#123;</span><br><span class="line">    set.<span class="title function_">add</span>(n);</span><br><span class="line">    n = <span class="title function_">getNext</span>(n);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> n == <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="快慢双指针法"><a href="#快慢双指针法" class="headerlink" title="快慢双指针法"></a>快慢双指针法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getNext = <span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n</span><br><span class="line">    .<span class="title function_">toString</span>()</span><br><span class="line">    .<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> i ** <span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> isHappy = <span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> slow = n;</span><br><span class="line">  <span class="keyword">let</span> fast = <span class="title function_">getNext</span>(n);</span><br><span class="line">  <span class="keyword">while</span> (fast !== <span class="number">1</span> &amp;&amp; fast !== slow) &#123;</span><br><span class="line">    slow = <span class="title function_">getNext</span>(slow);</span><br><span class="line">    fast = <span class="title function_">getNext</span>(<span class="title function_">getNext</span>(fast));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fast === <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/01/22/%E5%8F%8C%E6%8C%87%E9%92%88%E4%B9%8B%E5%85%B8%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/01/22/%E5%8F%8C%E6%8C%87%E9%92%88%E4%B9%8B%E5%85%B8%E4%BE%8B/" class="post-title-link" itemprop="url">双指针之典例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-22 23:23:08" itemprop="dateCreated datePublished" datetime="2024-01-22T23:23:08+08:00">2024-01-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-03-17 17:25:09" itemprop="dateModified" datetime="2024-03-17T17:25:09+08:00">2024-03-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="验证回文串"><a href="#验证回文串" class="headerlink" title="验证回文串"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/valid-palindrome/description">验证回文串</a></h2><h3 id="1-双指针法："><a href="#1-双指针法：" class="headerlink" title="1. 双指针法："></a>1. 双指针法：</h3><p>解题思路：</p>
<ol>
<li><p>先使用正则处理字符串 s，只保留数字和字母，处理后得到的字符记录在字符串 sStrings 中；</p>
</li>
<li><p>将 sStrings 全部转为小写；</p>
</li>
<li><p>通过双指针，分别指向左右两侧的字符，进行比对，返回 true 或 false。</p>
<p>​</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isPalindrome = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="comment">// 先正则只保留字母数字，toLowerCase转为小写</span></span><br><span class="line">  <span class="keyword">let</span> sStrings = s.<span class="title function_">replace</span>(<span class="regexp">/[^0-9a-zA-Z]/g</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 双指针验证</span></span><br><span class="line">  <span class="keyword">let</span> left = <span class="number">0</span>,</span><br><span class="line">    right = sStrings.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sStrings.<span class="title function_">charAt</span>(left) !== sStrings.<span class="title function_">charAt</span>(right)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    left++;</span><br><span class="line">    right--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>时间复杂度：O(∣s∣)，其中 ∣s∣ 是字符串 s 的长度。</p>
</li>
<li><p>空间复杂度：O(∣s∣)，最坏情况下，新字符串 sStrings 和 s 长度一样。</p>
<p>​</p>
</li>
</ul>
<h3 id="2-直接利用数组的方法解："><a href="#2-直接利用数组的方法解：" class="headerlink" title="2. 直接利用数组的方法解："></a>2. 直接利用数组的方法解：</h3><p>解题思路：</p>
<ol>
<li>先使用正则处理字符串 s，只保留数字和字母，处理后得到的字符记录在字符串 sStrings 中；</li>
<li>将 sStrings 全部转为小写；</li>
<li>直接利用数组的 reverse() 方法，翻转的字符串还是一样的，返回 true，否则返回 false。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isPalindrome = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="comment">// 先正则只保留字母数字，toLowerCase转为小写</span></span><br><span class="line">  <span class="keyword">let</span> sStrings = s.<span class="title function_">replace</span>(<span class="regexp">/[^0-9a-zA-Z]/g</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line">  <span class="comment">// 直接利用 reverse()</span></span><br><span class="line">  <span class="keyword">if</span> (sStrings == [...sStrings].<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(∣s∣)，其中 ∣s∣ 是字符串 s 的长度。</li>
<li>空间复杂度：O(∣s∣)，最坏情况下，新字符串 sStrings 和 s 长度一样。</li>
</ul>
<hr>
<h2 id="判断子序列"><a href="#判断子序列" class="headerlink" title="判断子序列"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/is-subsequence/description">判断子序列</a></h2><h3 id="1-双指针法：-1"><a href="#1-双指针法：-1" class="headerlink" title="1. 双指针法："></a>1. 双指针法：</h3><p>解题思路：</p>
<p>可以直接设置两个指针 i, j，然后不断同时移动两个指针，进行比对。当比对循环结束时，t 的对应指针的 i 值等于 t 字符串的长度，那么说明 t 就是 s 的子序列。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isSubsequence = <span class="keyword">function</span> (<span class="params">s, t</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> n = s.<span class="property">length</span>,</span><br><span class="line">    m = t.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>,</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; n &amp;&amp; j &lt; m) &#123;</span><br><span class="line">    <span class="keyword">if</span> (s.<span class="title function_">charAt</span>(i) === t.<span class="title function_">charAt</span>(j)) &#123;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">    j++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i == n;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>时间复杂度：O(n+m)，其中 nnn 为 s 的长度，m 为 ttt 的长度。每次无论是匹配成功还是失败，都有至少一个指针发生右移，两指针能够位移的总距离为 n+m。</p>
</li>
<li><p>空间复杂度：O(1)</p>
</li>
</ul>
<hr>
<h2 id="两数之和-输入有序数组"><a href="#两数之和-输入有序数组" class="headerlink" title="两数之和|| - 输入有序数组"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/two-sum-ii-input-array-is-sorted/description">两数之和|| - 输入有序数组</a></h2><h3 id="1-二分查找法："><a href="#1-二分查找法：" class="headerlink" title="1. 二分查找法："></a>1. 二分查找法：</h3><p>基于本题是有序数组，因此我们很自然可以考虑 <code>二分查找</code> 法来解决。</p>
<p>基本思路为：</p>
<p>我们先用 for 循环来设置一个变量 i ，用来记录数组中的其中一个值，然后利用二分查找的方式来寻找合适下标为 mid 的值，使得 numbers[mid] &#x3D; target - numbers[i] ，此时返回 [i, mid] 就是我们所求的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> twoSum = <span class="keyword">function</span> (<span class="params">numbers, target</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numbers.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> left = i + <span class="number">1</span>,</span><br><span class="line">      right = numbers.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">      <span class="keyword">let</span> mid = <span class="title class_">Math</span>.<span class="title function_">floor</span>((left + right) / <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">if</span> (numbers[mid] + numbers[i] === target) &#123;</span><br><span class="line">        <span class="keyword">return</span> [i + <span class="number">1</span>, mid + <span class="number">1</span>];</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numbers[mid] + numbers[i] &gt; target) &#123;</span><br><span class="line">        right = mid - <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        left = mid + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [-<span class="number">1</span>, -<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>注意：这道题的下标是为 1 开始计数的，因此 [i, mid] 都需要加上 1。</p>
<ul>
<li>时间复杂度：O(nlogn)。需要遍历数组一次确定第一个数，时间复杂度是 O(n)，寻找第二个数使用二分查找，时间复杂度为 O(logn)，因此总的时间复杂度为 O(nlogn)。</li>
<li>空间复杂度：O(1)。</li>
</ul>
<h3 id="2-双指针法："><a href="#2-双指针法：" class="headerlink" title="2. 双指针法："></a>2. 双指针法：</h3><p>使用双指针法，左右两个指针分别指向两个目标元素，通过移动指针，找到两个目标元素之和为 target，就返回对应的下标组合。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> twoSum = <span class="keyword">function</span> (<span class="params">numbers, target</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> left = <span class="number">0</span>,</span><br><span class="line">    right = numbers.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">    <span class="keyword">if</span> (numbers[left] + numbers[right] === target) &#123;</span><br><span class="line">      <span class="keyword">return</span> [left + <span class="number">1</span>, right + <span class="number">1</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numbers[left] + numbers[right] &lt; target) &#123;</span><br><span class="line">      left++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      right--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [-<span class="number">1</span>, -<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)。两个指针总移动的次数最多为 n 次。</li>
<li>空间复杂度：O(1)</li>
</ul>
<hr>
<h2 id="三数之和"><a href="#三数之和" class="headerlink" title="三数之和"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/3sum/description">三数之和</a></h2><h3 id="排序-双指针"><a href="#排序-双指针" class="headerlink" title="排序 + 双指针"></a>排序 + 双指针</h3><p>求三元组，三数之和为 0，且三数不能重复。</p>
<p>我们可以利用排序配合双指针的方式来解决。</p>
<p>（1）首先，我们需要做一个特殊判断，三元组很明显就是三个数组成的，因此，我们可以先通过判断数组的长度，如果长度 &lt; 3，那么直接返回 [] 即可，节省算法跑空时间；</p>
<p>（2）我们可以利用一个 for 循环跟踪 nums[i]，利用双指针 left 和 right 来跟踪 nums[left] 和 nums[right]，因此，我们需要满足：nums[i] + nums[left] + nums[right] &#x3D; 0。</p>
<p>（3）这道题最大的关键就是需要<strong>保证三元组的三数不重复，而且三元组的元素是无序的，我们需要排除重复解</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> threeSum = <span class="keyword">function</span> (<span class="params">nums</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (nums === <span class="literal">null</span> || nums.<span class="property">length</span> &lt; <span class="number">3</span>) <span class="keyword">return</span> [];</span><br><span class="line">  <span class="keyword">let</span> numsArr = nums.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br><span class="line">  <span class="keyword">const</span> ansArr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numsArr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &gt; <span class="number">0</span>) <span class="keyword">return</span> ansArr;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] === nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> left = i + <span class="number">1</span>,</span><br><span class="line">      right = numsArr.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">      <span class="keyword">if</span> (numsArr[i] + numsArr[left] + numsArr[right] === <span class="number">0</span>) &#123;</span><br><span class="line">        ansArr.<span class="title function_">push</span>([numsArr[i], numsArr[left], numsArr[right]]);</span><br><span class="line">        <span class="comment">// 判断左界和右界是否和下一位重复，去除重复解。并且同时将left和right移到下一位，寻找新解。</span></span><br><span class="line">        <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[left] === nums[left + <span class="number">1</span>]) &#123;</span><br><span class="line">          left++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right &amp;&amp; nums[right] === nums[right - <span class="number">1</span>]) &#123;</span><br><span class="line">          right--;</span><br><span class="line">        &#125;</span><br><span class="line">        left++;</span><br><span class="line">        right--;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numsArr[i] + numsArr[left] + numsArr[right] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        left++;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        right--;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ansArr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n^2)。</li>
<li>空间复杂度：O(n)。使用了一个额外的数组存储了 nums 的副本并进行排序。</li>
</ul>
<hr>
<h2 id="盛最多水的容器"><a href="#盛最多水的容器" class="headerlink" title="盛最多水的容器"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/container-with-most-water/description">盛最多水的容器</a></h2><p>可以使用双指针的方法解决这个问题，两个指针分别指向容器的左右两端，通过移动两端的边界，使得容器的容水量最大。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maxArea = <span class="keyword">function</span> (<span class="params">height</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> left = <span class="number">0</span>,</span><br><span class="line">    right = height.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">    <span class="keyword">let</span> area = <span class="title class_">Math</span>.<span class="title function_">min</span>(height[left], height[right]) * (right - left);</span><br><span class="line">    ans = <span class="title class_">Math</span>.<span class="title function_">max</span>(ans, area);</span><br><span class="line">    <span class="keyword">if</span> (height[left] &lt; height[right]) &#123;</span><br><span class="line">      left++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      right--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)。双指针最多遍历完整个数组一次。</li>
<li>空间复杂度：O(1)。只需要额外的常数级别来存储指针的空间。</li>
</ul>
<h2 id="移动零"><a href="#移动零" class="headerlink" title="移动零"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/move-zeroes/description">移动零</a></h2><p>解题思路：</p>
<p>使用双指针，左指针指向当前已经处理好的序列的尾部，右指针指向待处理序列的头部。</p>
<p>右指针不断向右移动，每次右指针指向非零数，则将左右指针指向对应的数交换，同时左指针右移。</p>
<p>⚠️ 注意：</p>
<ul>
<li>左指针左边均为非零数；</li>
<li>右指针左边直到左指针处均为 0</li>
</ul>
<p>因此，每次交换，都是将左指针的零与右指针的非零数交换，且非零数的相对顺序并未改变</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number[]</span>&#125; <span class="variable">nums</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">void</span>&#125; Do not return anything, modify nums in-place instead.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> moveZeroes = <span class="keyword">function</span> (<span class="params">nums</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> n = nums.<span class="property">length</span>,</span><br><span class="line">    left = <span class="number">0</span>,</span><br><span class="line">    right = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (right &lt; n) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[right] != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_">swap</span>(nums, left, right);</span><br><span class="line">      left++;</span><br><span class="line">    &#125;</span><br><span class="line">    right++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">swap</span> = (<span class="params">nums, left, right</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> temp = nums[left];</span><br><span class="line">  nums[left] = nums[right];</span><br><span class="line">  nums[right] = temp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)，其中<code>n</code> 为序列长度，每个位置至多被遍历两次。</li>
<li>空间复杂度：O(1)，只需要常数的空 间存放若干位置。</li>
</ul>
<h2 id="接雨水"><a href="#接雨水" class="headerlink" title="接雨水"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/trapping-rain-water/description">接雨水</a></h2><p>方法一：动态规划</p>
<p>使用动态规划的方法，可以在 O(n)O(n)O(n) 的时间内预处理得到每个位置两边的最大高度。</p>
<p>创建两个长度为 n 的数组 leftMax 和 rightMax。对于 0 &lt;&#x3D; i &lt; n ，leftMax[i]表示下标 i 以及其左边的位置中，height 的最大高度，rightMax[i]表示下标 i 以及其右边的位置中，height 的最大高度。</p>
<p>创建两个长度为<code>n</code>的数组<code>leftMax</code> 和 <code>rightMax</code>。对于 0&lt;&#x3D;i&lt; n ,leftMax[i]表示下标 i 及其左边的位置，height 的最大高度，rightMax[i]表示下标 i 及其右边的位置，height 的最大高度。</p>
<p>显然，leftMax[0]&#x3D;height[0]，rightMax[n-1]&#x3D;height[n-1]。两个数组的其余元素的计算如下：</p>
<ul>
<li>当 1 &lt;&#x3D; i &lt;&#x3D; n-1 时，leftMax[i] &#x3D; max(leftMax[i-1],height[i]);</li>
<li>当 0 &lt;&#x3D; i &lt;&#x3D; n-2 时，rightMax[i] &#x3D;max(rightMax[i+1],height[i]);</li>
</ul>
<p>因此可以正向遍历数组 height 得到数组 leftMax 的每个元素值，反向遍历数组 height 得到数组 rightMax 的每个元素值。</p>
<p>在得到数组 leftMax 和 rightMax 的每个元素值之后，对于 0 &lt;&#x3D; i &lt; n，下标 i 处能接的雨水量等于 min(leftMax[i], rightMax[i])-height[i]。遍历每个下标位置即可得到能接的雨水总量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number[]</span>&#125; <span class="variable">height</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> trap = <span class="keyword">function</span> (<span class="params">height</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> n = height.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> leftMax = <span class="keyword">new</span> <span class="title class_">Array</span>(n).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">  leftMax[<span class="number">0</span>] = height[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">    leftMax[i] = <span class="title class_">Math</span>.<span class="title function_">max</span>(leftMax[i - <span class="number">1</span>], height[i]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> rightMax = <span class="keyword">new</span> <span class="title class_">Array</span>(n).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">  rightMax[n - <span class="number">1</span>] = height[n - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = n - <span class="number">2</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">    rightMax[i] = <span class="title class_">Math</span>.<span class="title function_">max</span>(rightMax[i + <span class="number">1</span>], height[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    ans += <span class="title class_">Math</span>.<span class="title function_">min</span>(leftMax[i], rightMax[i]) - height[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)</li>
<li>空间复杂度：O(n)</li>
</ul>
<p>这种方式需要维护两个数组 leftMax 和 rightMax，因此空间复杂度是 O(n)。是否可以将空间复杂度降到 O(1)？</p>
<p>方法二：双指针</p>
<p>我们可以注意到下标<code>i</code>处能接的雨水量由<code>leftMax</code>和<code>rightMax</code>中的最小值决定。因此，我们可以使用双指针和两个变量代替两个数组。</p>
<p>维护两个指针 left 和 right，以及两个变量 leftMax 和 rightMax，初始时：<code>left =0</code>，<code>right = height.length -1</code>，<code>leftMax=0</code>，<code>rightMax=0</code>。</p>
<p>当两个指针还没有相遇时：</p>
<ul>
<li>使用 height[left]和 height[right]的值更新 leftMax 和 rightMax 的值；</li>
<li>如果 height[left]&lt; height[right]，则必有 leftMax&lt; rightMax，下标 left 处能接的雨水量等于 leftMax-height[left]，将下标 left 处能接的雨水量加到能接的雨水总量，然后将 left 加 1；</li>
<li>如果 height[left]&gt;&#x3D; height[right]，则必有 leftMax&gt;&#x3D;rightMax，下标 right 处能接的雨水量等于 rightMax-height[right]，将下标 right 处能接的水量加上，然后左移（right -1）</li>
</ul>
<p>一直重复以上循环，直到两个指针相遇时，即可得到能接的雨水总量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number[]</span>&#125; <span class="variable">height</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> trap = <span class="keyword">function</span> (<span class="params">height</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> left = <span class="number">0</span>,</span><br><span class="line">    right = height.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> leftMax = <span class="number">0</span>,</span><br><span class="line">    rightMax = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">    leftMax = <span class="title class_">Math</span>.<span class="title function_">max</span>(leftMax, height[left]);</span><br><span class="line">    rightMax = <span class="title class_">Math</span>.<span class="title function_">max</span>(rightMax, height[right]);</span><br><span class="line">    <span class="keyword">if</span> (height[left] &lt; height[right]) &#123;</span><br><span class="line">      ans += leftMax - height[left];</span><br><span class="line">      ++left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ans += rightMax - height[right];</span><br><span class="line">      --right;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)</li>
<li>空间复杂度：O(1)</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kelly-kml.github.io/kelly240112.github.io/articles/2024/01/21/%E6%95%B4%E6%95%B0%E4%B8%8E%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97%E4%BA%92%E8%BD%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/kelly240112.github.io/images/avatar.jpg">
      <meta itemprop="name" content="kelly">
      <meta itemprop="description" content="野孩子玩耍的殿堂">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宫崎骏的捣蛋野孩子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kelly240112.github.io/articles/2024/01/21/%E6%95%B4%E6%95%B0%E4%B8%8E%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97%E4%BA%92%E8%BD%AC/" class="post-title-link" itemprop="url">整数与罗马数字互转</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-01-21 23:21:09" itemprop="dateCreated datePublished" datetime="2024-01-21T23:21:09+08:00">2024-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-22 00:20:19" itemprop="dateModified" datetime="2024-01-22T00:20:19+08:00">2024-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/kelly240112.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、整数转罗马数字"><a href="#一、整数转罗马数字" class="headerlink" title="一、整数转罗马数字"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/integer-to-roman/description">一、整数转罗马数字</a></h2><p>罗马数字包含以下七种字符： I， V， X， L，C，D 和 M。</p>
<p>字符 -&gt; 数值<br>I -&gt; 1<br>V -&gt; 5<br>X -&gt; 10<br>L -&gt; 50<br>C -&gt; 100<br>D -&gt; 500<br>M -&gt; 1000</p>
<p>例如， 罗马数字 2 写做 II ，即为两个并列的 1。12 写做 XII ，即为 X + II 。 27 写做 XXVII, 即为 XX + V + II 。</p>
<p><strong>示例：</strong></p>
<p>输入: num &#x3D; 1994</p>
<p>输出: “MCMXCIV”</p>
<p>解释: M &#x3D; 1000, CM &#x3D; 900, XC &#x3D; 90, IV &#x3D; 4.</p>
<p><strong>解题思路：</strong></p>
<ol>
<li>首先可以先将可能出现的罗马数字特殊组合表示为一个键值对 [value, symbol] 存放于数组中；</li>
<li>然后将 num 与 value 比较，如果出现 num &gt; value，那么将 value 对应的 symbol 执行 <code>roman.push(symbol)</code> ，知道 num &#x3D;&#x3D;&#x3D;0 终止循环</li>
<li>返回 roman.join(‘’) 就是我们要的 num 对应的罗马数字</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> intToRoman = <span class="keyword">function</span> (<span class="params">num</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> roman = [];</span><br><span class="line">  <span class="keyword">const</span> valueSymbol = [</span><br><span class="line">    [<span class="number">1000</span>, <span class="string">&#x27;M&#x27;</span>],</span><br><span class="line">    [<span class="number">900</span>, <span class="string">&#x27;CM&#x27;</span>],</span><br><span class="line">    [<span class="number">500</span>, <span class="string">&#x27;D&#x27;</span>],</span><br><span class="line">    [<span class="number">400</span>, <span class="string">&#x27;CD&#x27;</span>],</span><br><span class="line">    [<span class="number">100</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">    [<span class="number">90</span>, <span class="string">&#x27;XC&#x27;</span>],</span><br><span class="line">    [<span class="number">50</span>, <span class="string">&#x27;L&#x27;</span>],</span><br><span class="line">    [<span class="number">40</span>, <span class="string">&#x27;XL&#x27;</span>],</span><br><span class="line">    [<span class="number">10</span>, <span class="string">&#x27;X&#x27;</span>],</span><br><span class="line">    [<span class="number">9</span>, <span class="string">&#x27;IX&#x27;</span>],</span><br><span class="line">    [<span class="number">5</span>, <span class="string">&#x27;V&#x27;</span>],</span><br><span class="line">    [<span class="number">4</span>, <span class="string">&#x27;IV&#x27;</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="string">&#x27;I&#x27;</span>],</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [value, symbol] <span class="keyword">of</span> valueSymbol) &#123;</span><br><span class="line">    <span class="keyword">while</span> (num &gt;= value) &#123;</span><br><span class="line">      roman.<span class="title function_">push</span>(symbol);</span><br><span class="line">      num -= value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (num === <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> roman.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(1)。由于 valueSymbols 长度是固定的，且这 131313 字符中的每个字符的出现次数均不会超过 3，因此循环次数有一个确定的上限。对于本题给出的数据范围，循环次数不会超过 15 次。</li>
<li>空间复杂度：O(1)。</li>
</ul>
<h2 id="二、罗马数字转整数"><a href="#二、罗马数字转整数" class="headerlink" title="二、罗马数字转整数"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/roman-to-integer/description">二、罗马数字转整数</a></h2><p><strong>示例：</strong></p>
<p>输入: s &#x3D; “LVIII”<br>输出: 58<br>解释: L &#x3D; 50, V&#x3D; 5, III &#x3D; 3.</p>
<p><strong>解题思路：</strong></p>
<ol>
<li><p>首先根据罗马数字的符号先建立一个哈希表 symbolValues，键值对为 [symbol, value]</p>
</li>
<li><p>用 for 遍历 s 罗马数字，将每一次循环转换好的罗马数字对应的整数累加 ans</p>
</li>
<li><p>如果 s[i] &lt; s[i+1]， 那么 <code>value = s[i+1]-s[i]</code> 即<code>ans -= value</code>，否则 <code>ans += value</code></p>
<p>简单来说，比如：IX 中 I 对应的值 1 小于 X 对应的值 10， 那么 IX 表示的整数为 10-1 &#x3D; 9</p>
<p>XI 中 I 对应的值 1 大于 X 对应的值 10， 那么 IX 表示的整数为 10+1&#x3D;11</p>
</li>
<li><p>最后将 ans 返回就是我们所求罗马数字对应的整数</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> romanToInt = <span class="keyword">function</span> (<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> symbolValues = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="string">&#x27;I&#x27;</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="string">&#x27;V&#x27;</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="string">&#x27;X&#x27;</span>, <span class="number">10</span>],</span><br><span class="line">    [<span class="string">&#x27;L&#x27;</span>, <span class="number">50</span>],</span><br><span class="line">    [<span class="string">&#x27;C&#x27;</span>, <span class="number">100</span>],</span><br><span class="line">    [<span class="string">&#x27;D&#x27;</span>, <span class="number">500</span>],</span><br><span class="line">    [<span class="string">&#x27;M&#x27;</span>, <span class="number">1000</span>],</span><br><span class="line">  ]);</span><br><span class="line">  <span class="keyword">let</span> ans = <span class="number">0</span>,</span><br><span class="line">    n = s.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = symbolValues.<span class="title function_">get</span>(s[i]);</span><br><span class="line">    <span class="keyword">if</span> (i &lt; n - <span class="number">1</span> &amp;&amp; value &lt; symbolValues.<span class="title function_">get</span>(s[i + <span class="number">1</span>])) &#123;</span><br><span class="line">      ans -= value;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ans += value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：O(n)，其中 n 是字符串 s 的长度。</li>
<li>空间复杂度：O(1)。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/kelly240112.github.io/page/2/">2</a><a class="extend next" rel="next" href="/kelly240112.github.io/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kelly"
      src="/kelly240112.github.io/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">kelly</p>
  <div class="site-description" itemprop="description">野孩子玩耍的殿堂</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/kelly240112.github.io/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/kelly240112.github.io/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/kelly240112.github.io/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kelly</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/kelly240112.github.io/lib/anime.min.js"></script>
  <script src="/kelly240112.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/kelly240112.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/kelly240112.github.io/js/utils.js"></script>

<script src="/kelly240112.github.io/js/motion.js"></script>


<script src="/kelly240112.github.io/js/schemes/pisces.js"></script>


<script src="/kelly240112.github.io/js/next-boot.js"></script>




  




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/kelly240112.github.io/js/algolia-search.js"></script>














  

  

</body>
</html>
